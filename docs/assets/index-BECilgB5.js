(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))i(u);new MutationObserver(u=>{for(const m of u)if(m.type==="childList")for(const S of m.addedNodes)S.tagName==="LINK"&&S.rel==="modulepreload"&&i(S)}).observe(document,{childList:!0,subtree:!0});function a(u){const m={};return u.integrity&&(m.integrity=u.integrity),u.referrerPolicy&&(m.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?m.credentials="include":u.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function i(u){if(u.ep)return;u.ep=!0;const m=a(u);fetch(u.href,m)}})();var An=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function En(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}function _n(s){if(s.__esModule)return s;var n=s.default;if(typeof n=="function"){var a=function i(){return this instanceof i?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};a.prototype=n.prototype}else a={};return Object.defineProperty(a,"__esModule",{value:!0}),Object.keys(s).forEach(function(i){var u=Object.getOwnPropertyDescriptor(s,i);Object.defineProperty(a,i,u.get?u:{enumerable:!0,get:function(){return s[i]}})}),a}function Cn(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var an={exports:{}};const In={},Bn=Object.freeze(Object.defineProperty({__proto__:null,default:In},Symbol.toStringTag,{value:"Module"})),Mn=_n(Bn);(function(s){(function(n){var a=function(t){var f,r=new Float64Array(16);if(t)for(f=0;f<t.length;f++)r[f]=t[f];return r},i=function(){throw new Error("no PRNG")},u=new Uint8Array(16),m=new Uint8Array(32);m[0]=9;var S=a(),I=a([1]),M=a([56129,1]),L=a([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),G=a([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),Q=a([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),ne=a([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),ae=a([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function re(t,f,r,e){t[f]=r>>24&255,t[f+1]=r>>16&255,t[f+2]=r>>8&255,t[f+3]=r&255,t[f+4]=e>>24&255,t[f+5]=e>>16&255,t[f+6]=e>>8&255,t[f+7]=e&255}function fe(t,f,r,e,o){var l,d=0;for(l=0;l<o;l++)d|=t[f+l]^r[e+l];return(1&d-1>>>8)-1}function ce(t,f,r,e){return fe(t,f,r,e,16)}function he(t,f,r,e){return fe(t,f,r,e,32)}function ue(t,f,r,e){for(var o=e[0]&255|(e[1]&255)<<8|(e[2]&255)<<16|(e[3]&255)<<24,l=r[0]&255|(r[1]&255)<<8|(r[2]&255)<<16|(r[3]&255)<<24,d=r[4]&255|(r[5]&255)<<8|(r[6]&255)<<16|(r[7]&255)<<24,y=r[8]&255|(r[9]&255)<<8|(r[10]&255)<<16|(r[11]&255)<<24,w=r[12]&255|(r[13]&255)<<8|(r[14]&255)<<16|(r[15]&255)<<24,K=e[4]&255|(e[5]&255)<<8|(e[6]&255)<<16|(e[7]&255)<<24,E=f[0]&255|(f[1]&255)<<8|(f[2]&255)<<16|(f[3]&255)<<24,k=f[4]&255|(f[5]&255)<<8|(f[6]&255)<<16|(f[7]&255)<<24,C=f[8]&255|(f[9]&255)<<8|(f[10]&255)<<16|(f[11]&255)<<24,O=f[12]&255|(f[13]&255)<<8|(f[14]&255)<<16|(f[15]&255)<<24,j=e[8]&255|(e[9]&255)<<8|(e[10]&255)<<16|(e[11]&255)<<24,F=r[16]&255|(r[17]&255)<<8|(r[18]&255)<<16|(r[19]&255)<<24,R=r[20]&255|(r[21]&255)<<8|(r[22]&255)<<16|(r[23]&255)<<24,q=r[24]&255|(r[25]&255)<<8|(r[26]&255)<<16|(r[27]&255)<<24,D=r[28]&255|(r[29]&255)<<8|(r[30]&255)<<16|(r[31]&255)<<24,Y=e[12]&255|(e[13]&255)<<8|(e[14]&255)<<16|(e[15]&255)<<24,B=o,P=l,_=d,N=y,T=w,A=K,x=E,h=k,g=C,p=O,b=j,v=F,U=R,$=q,V=D,z=Y,c,J=0;J<20;J+=2)c=B+U|0,T^=c<<7|c>>>25,c=T+B|0,g^=c<<9|c>>>23,c=g+T|0,U^=c<<13|c>>>19,c=U+g|0,B^=c<<18|c>>>14,c=A+P|0,p^=c<<7|c>>>25,c=p+A|0,$^=c<<9|c>>>23,c=$+p|0,P^=c<<13|c>>>19,c=P+$|0,A^=c<<18|c>>>14,c=b+x|0,V^=c<<7|c>>>25,c=V+b|0,_^=c<<9|c>>>23,c=_+V|0,x^=c<<13|c>>>19,c=x+_|0,b^=c<<18|c>>>14,c=z+v|0,N^=c<<7|c>>>25,c=N+z|0,h^=c<<9|c>>>23,c=h+N|0,v^=c<<13|c>>>19,c=v+h|0,z^=c<<18|c>>>14,c=B+N|0,P^=c<<7|c>>>25,c=P+B|0,_^=c<<9|c>>>23,c=_+P|0,N^=c<<13|c>>>19,c=N+_|0,B^=c<<18|c>>>14,c=A+T|0,x^=c<<7|c>>>25,c=x+A|0,h^=c<<9|c>>>23,c=h+x|0,T^=c<<13|c>>>19,c=T+h|0,A^=c<<18|c>>>14,c=b+p|0,v^=c<<7|c>>>25,c=v+b|0,g^=c<<9|c>>>23,c=g+v|0,p^=c<<13|c>>>19,c=p+g|0,b^=c<<18|c>>>14,c=z+V|0,U^=c<<7|c>>>25,c=U+z|0,$^=c<<9|c>>>23,c=$+U|0,V^=c<<13|c>>>19,c=V+$|0,z^=c<<18|c>>>14;B=B+o|0,P=P+l|0,_=_+d|0,N=N+y|0,T=T+w|0,A=A+K|0,x=x+E|0,h=h+k|0,g=g+C|0,p=p+O|0,b=b+j|0,v=v+F|0,U=U+R|0,$=$+q|0,V=V+D|0,z=z+Y|0,t[0]=B>>>0&255,t[1]=B>>>8&255,t[2]=B>>>16&255,t[3]=B>>>24&255,t[4]=P>>>0&255,t[5]=P>>>8&255,t[6]=P>>>16&255,t[7]=P>>>24&255,t[8]=_>>>0&255,t[9]=_>>>8&255,t[10]=_>>>16&255,t[11]=_>>>24&255,t[12]=N>>>0&255,t[13]=N>>>8&255,t[14]=N>>>16&255,t[15]=N>>>24&255,t[16]=T>>>0&255,t[17]=T>>>8&255,t[18]=T>>>16&255,t[19]=T>>>24&255,t[20]=A>>>0&255,t[21]=A>>>8&255,t[22]=A>>>16&255,t[23]=A>>>24&255,t[24]=x>>>0&255,t[25]=x>>>8&255,t[26]=x>>>16&255,t[27]=x>>>24&255,t[28]=h>>>0&255,t[29]=h>>>8&255,t[30]=h>>>16&255,t[31]=h>>>24&255,t[32]=g>>>0&255,t[33]=g>>>8&255,t[34]=g>>>16&255,t[35]=g>>>24&255,t[36]=p>>>0&255,t[37]=p>>>8&255,t[38]=p>>>16&255,t[39]=p>>>24&255,t[40]=b>>>0&255,t[41]=b>>>8&255,t[42]=b>>>16&255,t[43]=b>>>24&255,t[44]=v>>>0&255,t[45]=v>>>8&255,t[46]=v>>>16&255,t[47]=v>>>24&255,t[48]=U>>>0&255,t[49]=U>>>8&255,t[50]=U>>>16&255,t[51]=U>>>24&255,t[52]=$>>>0&255,t[53]=$>>>8&255,t[54]=$>>>16&255,t[55]=$>>>24&255,t[56]=V>>>0&255,t[57]=V>>>8&255,t[58]=V>>>16&255,t[59]=V>>>24&255,t[60]=z>>>0&255,t[61]=z>>>8&255,t[62]=z>>>16&255,t[63]=z>>>24&255}function Te(t,f,r,e){for(var o=e[0]&255|(e[1]&255)<<8|(e[2]&255)<<16|(e[3]&255)<<24,l=r[0]&255|(r[1]&255)<<8|(r[2]&255)<<16|(r[3]&255)<<24,d=r[4]&255|(r[5]&255)<<8|(r[6]&255)<<16|(r[7]&255)<<24,y=r[8]&255|(r[9]&255)<<8|(r[10]&255)<<16|(r[11]&255)<<24,w=r[12]&255|(r[13]&255)<<8|(r[14]&255)<<16|(r[15]&255)<<24,K=e[4]&255|(e[5]&255)<<8|(e[6]&255)<<16|(e[7]&255)<<24,E=f[0]&255|(f[1]&255)<<8|(f[2]&255)<<16|(f[3]&255)<<24,k=f[4]&255|(f[5]&255)<<8|(f[6]&255)<<16|(f[7]&255)<<24,C=f[8]&255|(f[9]&255)<<8|(f[10]&255)<<16|(f[11]&255)<<24,O=f[12]&255|(f[13]&255)<<8|(f[14]&255)<<16|(f[15]&255)<<24,j=e[8]&255|(e[9]&255)<<8|(e[10]&255)<<16|(e[11]&255)<<24,F=r[16]&255|(r[17]&255)<<8|(r[18]&255)<<16|(r[19]&255)<<24,R=r[20]&255|(r[21]&255)<<8|(r[22]&255)<<16|(r[23]&255)<<24,q=r[24]&255|(r[25]&255)<<8|(r[26]&255)<<16|(r[27]&255)<<24,D=r[28]&255|(r[29]&255)<<8|(r[30]&255)<<16|(r[31]&255)<<24,Y=e[12]&255|(e[13]&255)<<8|(e[14]&255)<<16|(e[15]&255)<<24,B=o,P=l,_=d,N=y,T=w,A=K,x=E,h=k,g=C,p=O,b=j,v=F,U=R,$=q,V=D,z=Y,c,J=0;J<20;J+=2)c=B+U|0,T^=c<<7|c>>>25,c=T+B|0,g^=c<<9|c>>>23,c=g+T|0,U^=c<<13|c>>>19,c=U+g|0,B^=c<<18|c>>>14,c=A+P|0,p^=c<<7|c>>>25,c=p+A|0,$^=c<<9|c>>>23,c=$+p|0,P^=c<<13|c>>>19,c=P+$|0,A^=c<<18|c>>>14,c=b+x|0,V^=c<<7|c>>>25,c=V+b|0,_^=c<<9|c>>>23,c=_+V|0,x^=c<<13|c>>>19,c=x+_|0,b^=c<<18|c>>>14,c=z+v|0,N^=c<<7|c>>>25,c=N+z|0,h^=c<<9|c>>>23,c=h+N|0,v^=c<<13|c>>>19,c=v+h|0,z^=c<<18|c>>>14,c=B+N|0,P^=c<<7|c>>>25,c=P+B|0,_^=c<<9|c>>>23,c=_+P|0,N^=c<<13|c>>>19,c=N+_|0,B^=c<<18|c>>>14,c=A+T|0,x^=c<<7|c>>>25,c=x+A|0,h^=c<<9|c>>>23,c=h+x|0,T^=c<<13|c>>>19,c=T+h|0,A^=c<<18|c>>>14,c=b+p|0,v^=c<<7|c>>>25,c=v+b|0,g^=c<<9|c>>>23,c=g+v|0,p^=c<<13|c>>>19,c=p+g|0,b^=c<<18|c>>>14,c=z+V|0,U^=c<<7|c>>>25,c=U+z|0,$^=c<<9|c>>>23,c=$+U|0,V^=c<<13|c>>>19,c=V+$|0,z^=c<<18|c>>>14;t[0]=B>>>0&255,t[1]=B>>>8&255,t[2]=B>>>16&255,t[3]=B>>>24&255,t[4]=A>>>0&255,t[5]=A>>>8&255,t[6]=A>>>16&255,t[7]=A>>>24&255,t[8]=b>>>0&255,t[9]=b>>>8&255,t[10]=b>>>16&255,t[11]=b>>>24&255,t[12]=z>>>0&255,t[13]=z>>>8&255,t[14]=z>>>16&255,t[15]=z>>>24&255,t[16]=x>>>0&255,t[17]=x>>>8&255,t[18]=x>>>16&255,t[19]=x>>>24&255,t[20]=h>>>0&255,t[21]=h>>>8&255,t[22]=h>>>16&255,t[23]=h>>>24&255,t[24]=g>>>0&255,t[25]=g>>>8&255,t[26]=g>>>16&255,t[27]=g>>>24&255,t[28]=p>>>0&255,t[29]=p>>>8&255,t[30]=p>>>16&255,t[31]=p>>>24&255}function Ae(t,f,r,e){ue(t,f,r,e)}function Ce(t,f,r,e){Te(t,f,r,e)}var Ie=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);function Ot(t,f,r,e,o,l,d){var y=new Uint8Array(16),w=new Uint8Array(64),K,E;for(E=0;E<16;E++)y[E]=0;for(E=0;E<8;E++)y[E]=l[E];for(;o>=64;){for(Ae(w,y,d,Ie),E=0;E<64;E++)t[f+E]=r[e+E]^w[E];for(K=1,E=8;E<16;E++)K=K+(y[E]&255)|0,y[E]=K&255,K>>>=8;o-=64,f+=64,e+=64}if(o>0)for(Ae(w,y,d,Ie),E=0;E<o;E++)t[f+E]=r[e+E]^w[E];return 0}function jt(t,f,r,e,o){var l=new Uint8Array(16),d=new Uint8Array(64),y,w;for(w=0;w<16;w++)l[w]=0;for(w=0;w<8;w++)l[w]=e[w];for(;r>=64;){for(Ae(d,l,o,Ie),w=0;w<64;w++)t[f+w]=d[w];for(y=1,w=8;w<16;w++)y=y+(l[w]&255)|0,l[w]=y&255,y>>>=8;r-=64,f+=64}if(r>0)for(Ae(d,l,o,Ie),w=0;w<r;w++)t[f+w]=d[w];return 0}function qt(t,f,r,e,o){var l=new Uint8Array(32);Ce(l,e,o,Ie);for(var d=new Uint8Array(8),y=0;y<8;y++)d[y]=e[y+16];return jt(t,f,r,d,l)}function dt(t,f,r,e,o,l,d){var y=new Uint8Array(32);Ce(y,l,d,Ie);for(var w=new Uint8Array(8),K=0;K<8;K++)w[K]=l[K+16];return Ot(t,f,r,e,o,w,y)}var Ve=function(t){this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.leftover=0,this.fin=0;var f,r,e,o,l,d,y,w;f=t[0]&255|(t[1]&255)<<8,this.r[0]=f&8191,r=t[2]&255|(t[3]&255)<<8,this.r[1]=(f>>>13|r<<3)&8191,e=t[4]&255|(t[5]&255)<<8,this.r[2]=(r>>>10|e<<6)&7939,o=t[6]&255|(t[7]&255)<<8,this.r[3]=(e>>>7|o<<9)&8191,l=t[8]&255|(t[9]&255)<<8,this.r[4]=(o>>>4|l<<12)&255,this.r[5]=l>>>1&8190,d=t[10]&255|(t[11]&255)<<8,this.r[6]=(l>>>14|d<<2)&8191,y=t[12]&255|(t[13]&255)<<8,this.r[7]=(d>>>11|y<<5)&8065,w=t[14]&255|(t[15]&255)<<8,this.r[8]=(y>>>8|w<<8)&8191,this.r[9]=w>>>5&127,this.pad[0]=t[16]&255|(t[17]&255)<<8,this.pad[1]=t[18]&255|(t[19]&255)<<8,this.pad[2]=t[20]&255|(t[21]&255)<<8,this.pad[3]=t[22]&255|(t[23]&255)<<8,this.pad[4]=t[24]&255|(t[25]&255)<<8,this.pad[5]=t[26]&255|(t[27]&255)<<8,this.pad[6]=t[28]&255|(t[29]&255)<<8,this.pad[7]=t[30]&255|(t[31]&255)<<8};Ve.prototype.blocks=function(t,f,r){for(var e=this.fin?0:2048,o,l,d,y,w,K,E,k,C,O,j,F,R,q,D,Y,B,P,_,N=this.h[0],T=this.h[1],A=this.h[2],x=this.h[3],h=this.h[4],g=this.h[5],p=this.h[6],b=this.h[7],v=this.h[8],U=this.h[9],$=this.r[0],V=this.r[1],z=this.r[2],c=this.r[3],J=this.r[4],ee=this.r[5],te=this.r[6],H=this.r[7],W=this.r[8],X=this.r[9];r>=16;)o=t[f+0]&255|(t[f+1]&255)<<8,N+=o&8191,l=t[f+2]&255|(t[f+3]&255)<<8,T+=(o>>>13|l<<3)&8191,d=t[f+4]&255|(t[f+5]&255)<<8,A+=(l>>>10|d<<6)&8191,y=t[f+6]&255|(t[f+7]&255)<<8,x+=(d>>>7|y<<9)&8191,w=t[f+8]&255|(t[f+9]&255)<<8,h+=(y>>>4|w<<12)&8191,g+=w>>>1&8191,K=t[f+10]&255|(t[f+11]&255)<<8,p+=(w>>>14|K<<2)&8191,E=t[f+12]&255|(t[f+13]&255)<<8,b+=(K>>>11|E<<5)&8191,k=t[f+14]&255|(t[f+15]&255)<<8,v+=(E>>>8|k<<8)&8191,U+=k>>>5|e,C=0,O=C,O+=N*$,O+=T*(5*X),O+=A*(5*W),O+=x*(5*H),O+=h*(5*te),C=O>>>13,O&=8191,O+=g*(5*ee),O+=p*(5*J),O+=b*(5*c),O+=v*(5*z),O+=U*(5*V),C+=O>>>13,O&=8191,j=C,j+=N*V,j+=T*$,j+=A*(5*X),j+=x*(5*W),j+=h*(5*H),C=j>>>13,j&=8191,j+=g*(5*te),j+=p*(5*ee),j+=b*(5*J),j+=v*(5*c),j+=U*(5*z),C+=j>>>13,j&=8191,F=C,F+=N*z,F+=T*V,F+=A*$,F+=x*(5*X),F+=h*(5*W),C=F>>>13,F&=8191,F+=g*(5*H),F+=p*(5*te),F+=b*(5*ee),F+=v*(5*J),F+=U*(5*c),C+=F>>>13,F&=8191,R=C,R+=N*c,R+=T*z,R+=A*V,R+=x*$,R+=h*(5*X),C=R>>>13,R&=8191,R+=g*(5*W),R+=p*(5*H),R+=b*(5*te),R+=v*(5*ee),R+=U*(5*J),C+=R>>>13,R&=8191,q=C,q+=N*J,q+=T*c,q+=A*z,q+=x*V,q+=h*$,C=q>>>13,q&=8191,q+=g*(5*X),q+=p*(5*W),q+=b*(5*H),q+=v*(5*te),q+=U*(5*ee),C+=q>>>13,q&=8191,D=C,D+=N*ee,D+=T*J,D+=A*c,D+=x*z,D+=h*V,C=D>>>13,D&=8191,D+=g*$,D+=p*(5*X),D+=b*(5*W),D+=v*(5*H),D+=U*(5*te),C+=D>>>13,D&=8191,Y=C,Y+=N*te,Y+=T*ee,Y+=A*J,Y+=x*c,Y+=h*z,C=Y>>>13,Y&=8191,Y+=g*V,Y+=p*$,Y+=b*(5*X),Y+=v*(5*W),Y+=U*(5*H),C+=Y>>>13,Y&=8191,B=C,B+=N*H,B+=T*te,B+=A*ee,B+=x*J,B+=h*c,C=B>>>13,B&=8191,B+=g*z,B+=p*V,B+=b*$,B+=v*(5*X),B+=U*(5*W),C+=B>>>13,B&=8191,P=C,P+=N*W,P+=T*H,P+=A*te,P+=x*ee,P+=h*J,C=P>>>13,P&=8191,P+=g*c,P+=p*z,P+=b*V,P+=v*$,P+=U*(5*X),C+=P>>>13,P&=8191,_=C,_+=N*X,_+=T*W,_+=A*H,_+=x*te,_+=h*ee,C=_>>>13,_&=8191,_+=g*J,_+=p*c,_+=b*z,_+=v*V,_+=U*$,C+=_>>>13,_&=8191,C=(C<<2)+C|0,C=C+O|0,O=C&8191,C=C>>>13,j+=C,N=O,T=j,A=F,x=R,h=q,g=D,p=Y,b=B,v=P,U=_,f+=16,r-=16;this.h[0]=N,this.h[1]=T,this.h[2]=A,this.h[3]=x,this.h[4]=h,this.h[5]=g,this.h[6]=p,this.h[7]=b,this.h[8]=v,this.h[9]=U},Ve.prototype.finish=function(t,f){var r=new Uint16Array(10),e,o,l,d;if(this.leftover){for(d=this.leftover,this.buffer[d++]=1;d<16;d++)this.buffer[d]=0;this.fin=1,this.blocks(this.buffer,0,16)}for(e=this.h[1]>>>13,this.h[1]&=8191,d=2;d<10;d++)this.h[d]+=e,e=this.h[d]>>>13,this.h[d]&=8191;for(this.h[0]+=e*5,e=this.h[0]>>>13,this.h[0]&=8191,this.h[1]+=e,e=this.h[1]>>>13,this.h[1]&=8191,this.h[2]+=e,r[0]=this.h[0]+5,e=r[0]>>>13,r[0]&=8191,d=1;d<10;d++)r[d]=this.h[d]+e,e=r[d]>>>13,r[d]&=8191;for(r[9]-=8192,o=(e^1)-1,d=0;d<10;d++)r[d]&=o;for(o=~o,d=0;d<10;d++)this.h[d]=this.h[d]&o|r[d];for(this.h[0]=(this.h[0]|this.h[1]<<13)&65535,this.h[1]=(this.h[1]>>>3|this.h[2]<<10)&65535,this.h[2]=(this.h[2]>>>6|this.h[3]<<7)&65535,this.h[3]=(this.h[3]>>>9|this.h[4]<<4)&65535,this.h[4]=(this.h[4]>>>12|this.h[5]<<1|this.h[6]<<14)&65535,this.h[5]=(this.h[6]>>>2|this.h[7]<<11)&65535,this.h[6]=(this.h[7]>>>5|this.h[8]<<8)&65535,this.h[7]=(this.h[8]>>>8|this.h[9]<<5)&65535,l=this.h[0]+this.pad[0],this.h[0]=l&65535,d=1;d<8;d++)l=(this.h[d]+this.pad[d]|0)+(l>>>16)|0,this.h[d]=l&65535;t[f+0]=this.h[0]>>>0&255,t[f+1]=this.h[0]>>>8&255,t[f+2]=this.h[1]>>>0&255,t[f+3]=this.h[1]>>>8&255,t[f+4]=this.h[2]>>>0&255,t[f+5]=this.h[2]>>>8&255,t[f+6]=this.h[3]>>>0&255,t[f+7]=this.h[3]>>>8&255,t[f+8]=this.h[4]>>>0&255,t[f+9]=this.h[4]>>>8&255,t[f+10]=this.h[5]>>>0&255,t[f+11]=this.h[5]>>>8&255,t[f+12]=this.h[6]>>>0&255,t[f+13]=this.h[6]>>>8&255,t[f+14]=this.h[7]>>>0&255,t[f+15]=this.h[7]>>>8&255},Ve.prototype.update=function(t,f,r){var e,o;if(this.leftover){for(o=16-this.leftover,o>r&&(o=r),e=0;e<o;e++)this.buffer[this.leftover+e]=t[f+e];if(r-=o,f+=o,this.leftover+=o,this.leftover<16)return;this.blocks(this.buffer,0,16),this.leftover=0}if(r>=16&&(o=r-r%16,this.blocks(t,f,o),f+=o,r-=o),r){for(e=0;e<r;e++)this.buffer[this.leftover+e]=t[f+e];this.leftover+=r}};function ut(t,f,r,e,o,l){var d=new Ve(l);return d.update(r,e,o),d.finish(t,f),0}function Yt(t,f,r,e,o,l){var d=new Uint8Array(16);return ut(d,0,r,e,o,l),ce(t,f,d,0)}function xt(t,f,r,e,o){var l;if(r<32)return-1;for(dt(t,0,f,0,r,e,o),ut(t,16,t,32,r-32,t),l=0;l<16;l++)t[l]=0;return 0}function ht(t,f,r,e,o){var l,d=new Uint8Array(32);if(r<32||(qt(d,0,32,e,o),Yt(f,16,f,32,r-32,d)!==0))return-1;for(dt(t,0,f,0,r,e,o),l=0;l<32;l++)t[l]=0;return 0}function Ee(t,f){var r;for(r=0;r<16;r++)t[r]=f[r]|0}function pt(t){var f,r,e=1;for(f=0;f<16;f++)r=t[f]+e+65535,e=Math.floor(r/65536),t[f]=r-e*65536;t[0]+=e-1+37*(e-1)}function Ke(t,f,r){for(var e,o=~(r-1),l=0;l<16;l++)e=o&(t[l]^f[l]),t[l]^=e,f[l]^=e}function Pe(t,f){var r,e,o,l=a(),d=a();for(r=0;r<16;r++)d[r]=f[r];for(pt(d),pt(d),pt(d),e=0;e<2;e++){for(l[0]=d[0]-65517,r=1;r<15;r++)l[r]=d[r]-65535-(l[r-1]>>16&1),l[r-1]&=65535;l[15]=d[15]-32767-(l[14]>>16&1),o=l[15]>>16&1,l[14]&=65535,Ke(d,l,1-o)}for(r=0;r<16;r++)t[2*r]=d[r]&255,t[2*r+1]=d[r]>>8}function Dt(t,f){var r=new Uint8Array(32),e=new Uint8Array(32);return Pe(r,t),Pe(e,f),he(r,0,e,0)}function Rt(t){var f=new Uint8Array(32);return Pe(f,t),f[0]&1}function yt(t,f){var r;for(r=0;r<16;r++)t[r]=f[2*r]+(f[2*r+1]<<8);t[15]&=32767}function me(t,f,r){for(var e=0;e<16;e++)t[e]=f[e]+r[e]}function Se(t,f,r){for(var e=0;e<16;e++)t[e]=f[e]-r[e]}function Z(t,f,r){var e,o,l=0,d=0,y=0,w=0,K=0,E=0,k=0,C=0,O=0,j=0,F=0,R=0,q=0,D=0,Y=0,B=0,P=0,_=0,N=0,T=0,A=0,x=0,h=0,g=0,p=0,b=0,v=0,U=0,$=0,V=0,z=0,c=r[0],J=r[1],ee=r[2],te=r[3],H=r[4],W=r[5],X=r[6],de=r[7],oe=r[8],se=r[9],ie=r[10],le=r[11],xe=r[12],pe=r[13],ye=r[14],be=r[15];e=f[0],l+=e*c,d+=e*J,y+=e*ee,w+=e*te,K+=e*H,E+=e*W,k+=e*X,C+=e*de,O+=e*oe,j+=e*se,F+=e*ie,R+=e*le,q+=e*xe,D+=e*pe,Y+=e*ye,B+=e*be,e=f[1],d+=e*c,y+=e*J,w+=e*ee,K+=e*te,E+=e*H,k+=e*W,C+=e*X,O+=e*de,j+=e*oe,F+=e*se,R+=e*ie,q+=e*le,D+=e*xe,Y+=e*pe,B+=e*ye,P+=e*be,e=f[2],y+=e*c,w+=e*J,K+=e*ee,E+=e*te,k+=e*H,C+=e*W,O+=e*X,j+=e*de,F+=e*oe,R+=e*se,q+=e*ie,D+=e*le,Y+=e*xe,B+=e*pe,P+=e*ye,_+=e*be,e=f[3],w+=e*c,K+=e*J,E+=e*ee,k+=e*te,C+=e*H,O+=e*W,j+=e*X,F+=e*de,R+=e*oe,q+=e*se,D+=e*ie,Y+=e*le,B+=e*xe,P+=e*pe,_+=e*ye,N+=e*be,e=f[4],K+=e*c,E+=e*J,k+=e*ee,C+=e*te,O+=e*H,j+=e*W,F+=e*X,R+=e*de,q+=e*oe,D+=e*se,Y+=e*ie,B+=e*le,P+=e*xe,_+=e*pe,N+=e*ye,T+=e*be,e=f[5],E+=e*c,k+=e*J,C+=e*ee,O+=e*te,j+=e*H,F+=e*W,R+=e*X,q+=e*de,D+=e*oe,Y+=e*se,B+=e*ie,P+=e*le,_+=e*xe,N+=e*pe,T+=e*ye,A+=e*be,e=f[6],k+=e*c,C+=e*J,O+=e*ee,j+=e*te,F+=e*H,R+=e*W,q+=e*X,D+=e*de,Y+=e*oe,B+=e*se,P+=e*ie,_+=e*le,N+=e*xe,T+=e*pe,A+=e*ye,x+=e*be,e=f[7],C+=e*c,O+=e*J,j+=e*ee,F+=e*te,R+=e*H,q+=e*W,D+=e*X,Y+=e*de,B+=e*oe,P+=e*se,_+=e*ie,N+=e*le,T+=e*xe,A+=e*pe,x+=e*ye,h+=e*be,e=f[8],O+=e*c,j+=e*J,F+=e*ee,R+=e*te,q+=e*H,D+=e*W,Y+=e*X,B+=e*de,P+=e*oe,_+=e*se,N+=e*ie,T+=e*le,A+=e*xe,x+=e*pe,h+=e*ye,g+=e*be,e=f[9],j+=e*c,F+=e*J,R+=e*ee,q+=e*te,D+=e*H,Y+=e*W,B+=e*X,P+=e*de,_+=e*oe,N+=e*se,T+=e*ie,A+=e*le,x+=e*xe,h+=e*pe,g+=e*ye,p+=e*be,e=f[10],F+=e*c,R+=e*J,q+=e*ee,D+=e*te,Y+=e*H,B+=e*W,P+=e*X,_+=e*de,N+=e*oe,T+=e*se,A+=e*ie,x+=e*le,h+=e*xe,g+=e*pe,p+=e*ye,b+=e*be,e=f[11],R+=e*c,q+=e*J,D+=e*ee,Y+=e*te,B+=e*H,P+=e*W,_+=e*X,N+=e*de,T+=e*oe,A+=e*se,x+=e*ie,h+=e*le,g+=e*xe,p+=e*pe,b+=e*ye,v+=e*be,e=f[12],q+=e*c,D+=e*J,Y+=e*ee,B+=e*te,P+=e*H,_+=e*W,N+=e*X,T+=e*de,A+=e*oe,x+=e*se,h+=e*ie,g+=e*le,p+=e*xe,b+=e*pe,v+=e*ye,U+=e*be,e=f[13],D+=e*c,Y+=e*J,B+=e*ee,P+=e*te,_+=e*H,N+=e*W,T+=e*X,A+=e*de,x+=e*oe,h+=e*se,g+=e*ie,p+=e*le,b+=e*xe,v+=e*pe,U+=e*ye,$+=e*be,e=f[14],Y+=e*c,B+=e*J,P+=e*ee,_+=e*te,N+=e*H,T+=e*W,A+=e*X,x+=e*de,h+=e*oe,g+=e*se,p+=e*ie,b+=e*le,v+=e*xe,U+=e*pe,$+=e*ye,V+=e*be,e=f[15],B+=e*c,P+=e*J,_+=e*ee,N+=e*te,T+=e*H,A+=e*W,x+=e*X,h+=e*de,g+=e*oe,p+=e*se,b+=e*ie,v+=e*le,U+=e*xe,$+=e*pe,V+=e*ye,z+=e*be,l+=38*P,d+=38*_,y+=38*N,w+=38*T,K+=38*A,E+=38*x,k+=38*h,C+=38*g,O+=38*p,j+=38*b,F+=38*v,R+=38*U,q+=38*$,D+=38*V,Y+=38*z,o=1,e=l+o+65535,o=Math.floor(e/65536),l=e-o*65536,e=d+o+65535,o=Math.floor(e/65536),d=e-o*65536,e=y+o+65535,o=Math.floor(e/65536),y=e-o*65536,e=w+o+65535,o=Math.floor(e/65536),w=e-o*65536,e=K+o+65535,o=Math.floor(e/65536),K=e-o*65536,e=E+o+65535,o=Math.floor(e/65536),E=e-o*65536,e=k+o+65535,o=Math.floor(e/65536),k=e-o*65536,e=C+o+65535,o=Math.floor(e/65536),C=e-o*65536,e=O+o+65535,o=Math.floor(e/65536),O=e-o*65536,e=j+o+65535,o=Math.floor(e/65536),j=e-o*65536,e=F+o+65535,o=Math.floor(e/65536),F=e-o*65536,e=R+o+65535,o=Math.floor(e/65536),R=e-o*65536,e=q+o+65535,o=Math.floor(e/65536),q=e-o*65536,e=D+o+65535,o=Math.floor(e/65536),D=e-o*65536,e=Y+o+65535,o=Math.floor(e/65536),Y=e-o*65536,e=B+o+65535,o=Math.floor(e/65536),B=e-o*65536,l+=o-1+37*(o-1),o=1,e=l+o+65535,o=Math.floor(e/65536),l=e-o*65536,e=d+o+65535,o=Math.floor(e/65536),d=e-o*65536,e=y+o+65535,o=Math.floor(e/65536),y=e-o*65536,e=w+o+65535,o=Math.floor(e/65536),w=e-o*65536,e=K+o+65535,o=Math.floor(e/65536),K=e-o*65536,e=E+o+65535,o=Math.floor(e/65536),E=e-o*65536,e=k+o+65535,o=Math.floor(e/65536),k=e-o*65536,e=C+o+65535,o=Math.floor(e/65536),C=e-o*65536,e=O+o+65535,o=Math.floor(e/65536),O=e-o*65536,e=j+o+65535,o=Math.floor(e/65536),j=e-o*65536,e=F+o+65535,o=Math.floor(e/65536),F=e-o*65536,e=R+o+65535,o=Math.floor(e/65536),R=e-o*65536,e=q+o+65535,o=Math.floor(e/65536),q=e-o*65536,e=D+o+65535,o=Math.floor(e/65536),D=e-o*65536,e=Y+o+65535,o=Math.floor(e/65536),Y=e-o*65536,e=B+o+65535,o=Math.floor(e/65536),B=e-o*65536,l+=o-1+37*(o-1),t[0]=l,t[1]=d,t[2]=y,t[3]=w,t[4]=K,t[5]=E,t[6]=k,t[7]=C,t[8]=O,t[9]=j,t[10]=F,t[11]=R,t[12]=q,t[13]=D,t[14]=Y,t[15]=B}function we(t,f){Z(t,f,f)}function Ft(t,f){var r=a(),e;for(e=0;e<16;e++)r[e]=f[e];for(e=253;e>=0;e--)we(r,r),e!==2&&e!==4&&Z(r,r,f);for(e=0;e<16;e++)t[e]=r[e]}function $t(t,f){var r=a(),e;for(e=0;e<16;e++)r[e]=f[e];for(e=250;e>=0;e--)we(r,r),e!==1&&Z(r,r,f);for(e=0;e<16;e++)t[e]=r[e]}function He(t,f,r){var e=new Uint8Array(32),o=new Float64Array(80),l,d,y=a(),w=a(),K=a(),E=a(),k=a(),C=a();for(d=0;d<31;d++)e[d]=f[d];for(e[31]=f[31]&127|64,e[0]&=248,yt(o,r),d=0;d<16;d++)w[d]=o[d],E[d]=y[d]=K[d]=0;for(y[0]=E[0]=1,d=254;d>=0;--d)l=e[d>>>3]>>>(d&7)&1,Ke(y,w,l),Ke(K,E,l),me(k,y,K),Se(y,y,K),me(K,w,E),Se(w,w,E),we(E,k),we(C,y),Z(y,K,y),Z(K,w,k),me(k,y,K),Se(y,y,K),we(w,y),Se(K,E,C),Z(y,K,M),me(y,y,E),Z(K,K,y),Z(y,E,C),Z(E,w,o),we(w,k),Ke(y,w,l),Ke(K,E,l);for(d=0;d<16;d++)o[d+16]=y[d],o[d+32]=K[d],o[d+48]=w[d],o[d+64]=E[d];var O=o.subarray(32),j=o.subarray(16);return Ft(O,O),Z(j,j,O),Pe(t,j),0}function Je(t,f){return He(t,f,m)}function zt(t,f){return i(f,32),Je(t,f)}function Ge(t,f,r){var e=new Uint8Array(32);return He(e,r,f),Ce(t,u,e,Ie)}var Vt=xt,yn=ht;function bn(t,f,r,e,o,l){var d=new Uint8Array(32);return Ge(d,o,l),Vt(t,f,r,e,d)}function gn(t,f,r,e,o,l){var d=new Uint8Array(32);return Ge(d,o,l),yn(t,f,r,e,d)}var Ht=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function Jt(t,f,r,e){for(var o=new Int32Array(16),l=new Int32Array(16),d,y,w,K,E,k,C,O,j,F,R,q,D,Y,B,P,_,N,T,A,x,h,g,p,b,v,U=t[0],$=t[1],V=t[2],z=t[3],c=t[4],J=t[5],ee=t[6],te=t[7],H=f[0],W=f[1],X=f[2],de=f[3],oe=f[4],se=f[5],ie=f[6],le=f[7],xe=0;e>=128;){for(T=0;T<16;T++)A=8*T+xe,o[T]=r[A+0]<<24|r[A+1]<<16|r[A+2]<<8|r[A+3],l[T]=r[A+4]<<24|r[A+5]<<16|r[A+6]<<8|r[A+7];for(T=0;T<80;T++)if(d=U,y=$,w=V,K=z,E=c,k=J,C=ee,O=te,j=H,F=W,R=X,q=de,D=oe,Y=se,B=ie,P=le,x=te,h=le,g=h&65535,p=h>>>16,b=x&65535,v=x>>>16,x=(c>>>14|oe<<18)^(c>>>18|oe<<14)^(oe>>>9|c<<23),h=(oe>>>14|c<<18)^(oe>>>18|c<<14)^(c>>>9|oe<<23),g+=h&65535,p+=h>>>16,b+=x&65535,v+=x>>>16,x=c&J^~c&ee,h=oe&se^~oe&ie,g+=h&65535,p+=h>>>16,b+=x&65535,v+=x>>>16,x=Ht[T*2],h=Ht[T*2+1],g+=h&65535,p+=h>>>16,b+=x&65535,v+=x>>>16,x=o[T%16],h=l[T%16],g+=h&65535,p+=h>>>16,b+=x&65535,v+=x>>>16,p+=g>>>16,b+=p>>>16,v+=b>>>16,_=b&65535|v<<16,N=g&65535|p<<16,x=_,h=N,g=h&65535,p=h>>>16,b=x&65535,v=x>>>16,x=(U>>>28|H<<4)^(H>>>2|U<<30)^(H>>>7|U<<25),h=(H>>>28|U<<4)^(U>>>2|H<<30)^(U>>>7|H<<25),g+=h&65535,p+=h>>>16,b+=x&65535,v+=x>>>16,x=U&$^U&V^$&V,h=H&W^H&X^W&X,g+=h&65535,p+=h>>>16,b+=x&65535,v+=x>>>16,p+=g>>>16,b+=p>>>16,v+=b>>>16,O=b&65535|v<<16,P=g&65535|p<<16,x=K,h=q,g=h&65535,p=h>>>16,b=x&65535,v=x>>>16,x=_,h=N,g+=h&65535,p+=h>>>16,b+=x&65535,v+=x>>>16,p+=g>>>16,b+=p>>>16,v+=b>>>16,K=b&65535|v<<16,q=g&65535|p<<16,$=d,V=y,z=w,c=K,J=E,ee=k,te=C,U=O,W=j,X=F,de=R,oe=q,se=D,ie=Y,le=B,H=P,T%16===15)for(A=0;A<16;A++)x=o[A],h=l[A],g=h&65535,p=h>>>16,b=x&65535,v=x>>>16,x=o[(A+9)%16],h=l[(A+9)%16],g+=h&65535,p+=h>>>16,b+=x&65535,v+=x>>>16,_=o[(A+1)%16],N=l[(A+1)%16],x=(_>>>1|N<<31)^(_>>>8|N<<24)^_>>>7,h=(N>>>1|_<<31)^(N>>>8|_<<24)^(N>>>7|_<<25),g+=h&65535,p+=h>>>16,b+=x&65535,v+=x>>>16,_=o[(A+14)%16],N=l[(A+14)%16],x=(_>>>19|N<<13)^(N>>>29|_<<3)^_>>>6,h=(N>>>19|_<<13)^(_>>>29|N<<3)^(N>>>6|_<<26),g+=h&65535,p+=h>>>16,b+=x&65535,v+=x>>>16,p+=g>>>16,b+=p>>>16,v+=b>>>16,o[A]=b&65535|v<<16,l[A]=g&65535|p<<16;x=U,h=H,g=h&65535,p=h>>>16,b=x&65535,v=x>>>16,x=t[0],h=f[0],g+=h&65535,p+=h>>>16,b+=x&65535,v+=x>>>16,p+=g>>>16,b+=p>>>16,v+=b>>>16,t[0]=U=b&65535|v<<16,f[0]=H=g&65535|p<<16,x=$,h=W,g=h&65535,p=h>>>16,b=x&65535,v=x>>>16,x=t[1],h=f[1],g+=h&65535,p+=h>>>16,b+=x&65535,v+=x>>>16,p+=g>>>16,b+=p>>>16,v+=b>>>16,t[1]=$=b&65535|v<<16,f[1]=W=g&65535|p<<16,x=V,h=X,g=h&65535,p=h>>>16,b=x&65535,v=x>>>16,x=t[2],h=f[2],g+=h&65535,p+=h>>>16,b+=x&65535,v+=x>>>16,p+=g>>>16,b+=p>>>16,v+=b>>>16,t[2]=V=b&65535|v<<16,f[2]=X=g&65535|p<<16,x=z,h=de,g=h&65535,p=h>>>16,b=x&65535,v=x>>>16,x=t[3],h=f[3],g+=h&65535,p+=h>>>16,b+=x&65535,v+=x>>>16,p+=g>>>16,b+=p>>>16,v+=b>>>16,t[3]=z=b&65535|v<<16,f[3]=de=g&65535|p<<16,x=c,h=oe,g=h&65535,p=h>>>16,b=x&65535,v=x>>>16,x=t[4],h=f[4],g+=h&65535,p+=h>>>16,b+=x&65535,v+=x>>>16,p+=g>>>16,b+=p>>>16,v+=b>>>16,t[4]=c=b&65535|v<<16,f[4]=oe=g&65535|p<<16,x=J,h=se,g=h&65535,p=h>>>16,b=x&65535,v=x>>>16,x=t[5],h=f[5],g+=h&65535,p+=h>>>16,b+=x&65535,v+=x>>>16,p+=g>>>16,b+=p>>>16,v+=b>>>16,t[5]=J=b&65535|v<<16,f[5]=se=g&65535|p<<16,x=ee,h=ie,g=h&65535,p=h>>>16,b=x&65535,v=x>>>16,x=t[6],h=f[6],g+=h&65535,p+=h>>>16,b+=x&65535,v+=x>>>16,p+=g>>>16,b+=p>>>16,v+=b>>>16,t[6]=ee=b&65535|v<<16,f[6]=ie=g&65535|p<<16,x=te,h=le,g=h&65535,p=h>>>16,b=x&65535,v=x>>>16,x=t[7],h=f[7],g+=h&65535,p+=h>>>16,b+=x&65535,v+=x>>>16,p+=g>>>16,b+=p>>>16,v+=b>>>16,t[7]=te=b&65535|v<<16,f[7]=le=g&65535|p<<16,xe+=128,e-=128}return e}function Be(t,f,r){var e=new Int32Array(8),o=new Int32Array(8),l=new Uint8Array(256),d,y=r;for(e[0]=1779033703,e[1]=3144134277,e[2]=1013904242,e[3]=2773480762,e[4]=1359893119,e[5]=2600822924,e[6]=528734635,e[7]=1541459225,o[0]=4089235720,o[1]=2227873595,o[2]=4271175723,o[3]=1595750129,o[4]=2917565137,o[5]=725511199,o[6]=4215389547,o[7]=327033209,Jt(e,o,f,r),r%=128,d=0;d<r;d++)l[d]=f[y-r+d];for(l[r]=128,r=256-128*(r<112?1:0),l[r-9]=0,re(l,r-8,y/536870912|0,y<<3),Jt(e,o,l,r),d=0;d<8;d++)re(t,8*d,e[d],o[d]);return 0}function Ze(t,f){var r=a(),e=a(),o=a(),l=a(),d=a(),y=a(),w=a(),K=a(),E=a();Se(r,t[1],t[0]),Se(E,f[1],f[0]),Z(r,r,E),me(e,t[0],t[1]),me(E,f[0],f[1]),Z(e,e,E),Z(o,t[3],f[3]),Z(o,o,G),Z(l,t[2],f[2]),me(l,l,l),Se(d,e,r),Se(y,l,o),me(w,l,o),me(K,e,r),Z(t[0],d,y),Z(t[1],K,w),Z(t[2],w,y),Z(t[3],d,K)}function Gt(t,f,r){var e;for(e=0;e<4;e++)Ke(t[e],f[e],r)}function bt(t,f){var r=a(),e=a(),o=a();Ft(o,f[2]),Z(r,f[0],o),Z(e,f[1],o),Pe(t,e),t[31]^=Rt(r)<<7}function gt(t,f,r){var e,o;for(Ee(t[0],S),Ee(t[1],I),Ee(t[2],I),Ee(t[3],S),o=255;o>=0;--o)e=r[o/8|0]>>(o&7)&1,Gt(t,f,e),Ze(f,t),Ze(t,t),Gt(t,f,e)}function We(t,f){var r=[a(),a(),a(),a()];Ee(r[0],Q),Ee(r[1],ne),Ee(r[2],I),Z(r[3],Q,ne),gt(t,r,f)}function vt(t,f,r){var e=new Uint8Array(64),o=[a(),a(),a(),a()],l;for(r||i(f,32),Be(e,f,32),e[0]&=248,e[31]&=127,e[31]|=64,We(o,e),bt(t,o),l=0;l<32;l++)f[l+32]=t[l];return 0}var Xe=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function wt(t,f){var r,e,o,l;for(e=63;e>=32;--e){for(r=0,o=e-32,l=e-12;o<l;++o)f[o]+=r-16*f[e]*Xe[o-(e-32)],r=Math.floor((f[o]+128)/256),f[o]-=r*256;f[o]+=r,f[e]=0}for(r=0,o=0;o<32;o++)f[o]+=r-(f[31]>>4)*Xe[o],r=f[o]>>8,f[o]&=255;for(o=0;o<32;o++)f[o]-=r*Xe[o];for(e=0;e<32;e++)f[e+1]+=f[e]>>8,t[e]=f[e]&255}function mt(t){var f=new Float64Array(64),r;for(r=0;r<64;r++)f[r]=t[r];for(r=0;r<64;r++)t[r]=0;wt(t,f)}function Zt(t,f,r,e){var o=new Uint8Array(64),l=new Uint8Array(64),d=new Uint8Array(64),y,w,K=new Float64Array(64),E=[a(),a(),a(),a()];Be(o,e,32),o[0]&=248,o[31]&=127,o[31]|=64;var k=r+64;for(y=0;y<r;y++)t[64+y]=f[y];for(y=0;y<32;y++)t[32+y]=o[32+y];for(Be(d,t.subarray(32),r+32),mt(d),We(E,d),bt(t,E),y=32;y<64;y++)t[y]=e[y];for(Be(l,t,r+64),mt(l),y=0;y<64;y++)K[y]=0;for(y=0;y<32;y++)K[y]=d[y];for(y=0;y<32;y++)for(w=0;w<32;w++)K[y+w]+=l[y]*o[w];return wt(t.subarray(32),K),k}function vn(t,f){var r=a(),e=a(),o=a(),l=a(),d=a(),y=a(),w=a();return Ee(t[2],I),yt(t[1],f),we(o,t[1]),Z(l,o,L),Se(o,o,t[2]),me(l,t[2],l),we(d,l),we(y,d),Z(w,y,d),Z(r,w,o),Z(r,r,l),$t(r,r),Z(r,r,o),Z(r,r,l),Z(r,r,l),Z(t[0],r,l),we(e,t[0]),Z(e,e,l),Dt(e,o)&&Z(t[0],t[0],ae),we(e,t[0]),Z(e,e,l),Dt(e,o)?-1:(Rt(t[0])===f[31]>>7&&Se(t[0],S,t[0]),Z(t[3],t[0],t[1]),0)}function St(t,f,r,e){var o,l=new Uint8Array(32),d=new Uint8Array(64),y=[a(),a(),a(),a()],w=[a(),a(),a(),a()];if(r<64||vn(w,e))return-1;for(o=0;o<r;o++)t[o]=f[o];for(o=0;o<32;o++)t[o+32]=e[o];if(Be(d,t,r),mt(d),gt(y,w,d),We(w,f.subarray(32)),Ze(y,w),bt(l,y),r-=64,he(f,0,l,0)){for(o=0;o<r;o++)t[o]=0;return-1}for(o=0;o<r;o++)t[o]=f[o+64];return r}var At=32,Qe=24,je=32,Le=16,qe=32,ke=32,Ye=32,De=32,Et=32,Wt=Qe,wn=je,mn=Le,_e=64,Me=32,Ue=64,_t=32,Ct=64;n.lowlevel={crypto_core_hsalsa20:Ce,crypto_stream_xor:dt,crypto_stream:qt,crypto_stream_salsa20_xor:Ot,crypto_stream_salsa20:jt,crypto_onetimeauth:ut,crypto_onetimeauth_verify:Yt,crypto_verify_16:ce,crypto_verify_32:he,crypto_secretbox:xt,crypto_secretbox_open:ht,crypto_scalarmult:He,crypto_scalarmult_base:Je,crypto_box_beforenm:Ge,crypto_box_afternm:Vt,crypto_box:bn,crypto_box_open:gn,crypto_box_keypair:zt,crypto_hash:Be,crypto_sign:Zt,crypto_sign_keypair:vt,crypto_sign_open:St,crypto_secretbox_KEYBYTES:At,crypto_secretbox_NONCEBYTES:Qe,crypto_secretbox_ZEROBYTES:je,crypto_secretbox_BOXZEROBYTES:Le,crypto_scalarmult_BYTES:qe,crypto_scalarmult_SCALARBYTES:ke,crypto_box_PUBLICKEYBYTES:Ye,crypto_box_SECRETKEYBYTES:De,crypto_box_BEFORENMBYTES:Et,crypto_box_NONCEBYTES:Wt,crypto_box_ZEROBYTES:wn,crypto_box_BOXZEROBYTES:mn,crypto_sign_BYTES:_e,crypto_sign_PUBLICKEYBYTES:Me,crypto_sign_SECRETKEYBYTES:Ue,crypto_sign_SEEDBYTES:_t,crypto_hash_BYTES:Ct,gf:a,D:L,L:Xe,pack25519:Pe,unpack25519:yt,M:Z,A:me,S:we,Z:Se,pow2523:$t,add:Ze,set25519:Ee,modL:wt,scalarmult:gt,scalarbase:We};function Xt(t,f){if(t.length!==At)throw new Error("bad key size");if(f.length!==Qe)throw new Error("bad nonce size")}function Sn(t,f){if(t.length!==Ye)throw new Error("bad public key size");if(f.length!==De)throw new Error("bad secret key size")}function ge(){for(var t=0;t<arguments.length;t++)if(!(arguments[t]instanceof Uint8Array))throw new TypeError("unexpected type, use Uint8Array")}function Qt(t){for(var f=0;f<t.length;f++)t[f]=0}n.randomBytes=function(t){var f=new Uint8Array(t);return i(f,t),f},n.secretbox=function(t,f,r){ge(t,f,r),Xt(r,f);for(var e=new Uint8Array(je+t.length),o=new Uint8Array(e.length),l=0;l<t.length;l++)e[l+je]=t[l];return xt(o,e,e.length,f,r),o.subarray(Le)},n.secretbox.open=function(t,f,r){ge(t,f,r),Xt(r,f);for(var e=new Uint8Array(Le+t.length),o=new Uint8Array(e.length),l=0;l<t.length;l++)e[l+Le]=t[l];return e.length<32||ht(o,e,e.length,f,r)!==0?null:o.subarray(je)},n.secretbox.keyLength=At,n.secretbox.nonceLength=Qe,n.secretbox.overheadLength=Le,n.scalarMult=function(t,f){if(ge(t,f),t.length!==ke)throw new Error("bad n size");if(f.length!==qe)throw new Error("bad p size");var r=new Uint8Array(qe);return He(r,t,f),r},n.scalarMult.base=function(t){if(ge(t),t.length!==ke)throw new Error("bad n size");var f=new Uint8Array(qe);return Je(f,t),f},n.scalarMult.scalarLength=ke,n.scalarMult.groupElementLength=qe,n.box=function(t,f,r,e){var o=n.box.before(r,e);return n.secretbox(t,f,o)},n.box.before=function(t,f){ge(t,f),Sn(t,f);var r=new Uint8Array(Et);return Ge(r,t,f),r},n.box.after=n.secretbox,n.box.open=function(t,f,r,e){var o=n.box.before(r,e);return n.secretbox.open(t,f,o)},n.box.open.after=n.secretbox.open,n.box.keyPair=function(){var t=new Uint8Array(Ye),f=new Uint8Array(De);return zt(t,f),{publicKey:t,secretKey:f}},n.box.keyPair.fromSecretKey=function(t){if(ge(t),t.length!==De)throw new Error("bad secret key size");var f=new Uint8Array(Ye);return Je(f,t),{publicKey:f,secretKey:new Uint8Array(t)}},n.box.publicKeyLength=Ye,n.box.secretKeyLength=De,n.box.sharedKeyLength=Et,n.box.nonceLength=Wt,n.box.overheadLength=n.secretbox.overheadLength,n.sign=function(t,f){if(ge(t,f),f.length!==Ue)throw new Error("bad secret key size");var r=new Uint8Array(_e+t.length);return Zt(r,t,t.length,f),r},n.sign.open=function(t,f){if(ge(t,f),f.length!==Me)throw new Error("bad public key size");var r=new Uint8Array(t.length),e=St(r,t,t.length,f);if(e<0)return null;for(var o=new Uint8Array(e),l=0;l<o.length;l++)o[l]=r[l];return o},n.sign.detached=function(t,f){for(var r=n.sign(t,f),e=new Uint8Array(_e),o=0;o<e.length;o++)e[o]=r[o];return e},n.sign.detached.verify=function(t,f,r){if(ge(t,f,r),f.length!==_e)throw new Error("bad signature size");if(r.length!==Me)throw new Error("bad public key size");var e=new Uint8Array(_e+t.length),o=new Uint8Array(_e+t.length),l;for(l=0;l<_e;l++)e[l]=f[l];for(l=0;l<t.length;l++)e[l+_e]=t[l];return St(o,e,e.length,r)>=0},n.sign.keyPair=function(){var t=new Uint8Array(Me),f=new Uint8Array(Ue);return vt(t,f),{publicKey:t,secretKey:f}},n.sign.keyPair.fromSecretKey=function(t){if(ge(t),t.length!==Ue)throw new Error("bad secret key size");for(var f=new Uint8Array(Me),r=0;r<f.length;r++)f[r]=t[32+r];return{publicKey:f,secretKey:new Uint8Array(t)}},n.sign.keyPair.fromSeed=function(t){if(ge(t),t.length!==_t)throw new Error("bad seed size");for(var f=new Uint8Array(Me),r=new Uint8Array(Ue),e=0;e<32;e++)r[e]=t[e];return vt(f,r,!0),{publicKey:f,secretKey:r}},n.sign.publicKeyLength=Me,n.sign.secretKeyLength=Ue,n.sign.seedLength=_t,n.sign.signatureLength=_e,n.hash=function(t){ge(t);var f=new Uint8Array(Ct);return Be(f,t,t.length),f},n.hash.hashLength=Ct,n.verify=function(t,f){return ge(t,f),t.length===0||f.length===0||t.length!==f.length?!1:fe(t,0,f,0,t.length)===0},n.setPRNG=function(t){i=t},function(){var t=typeof self<"u"?self.crypto||self.msCrypto:null;if(t&&t.getRandomValues){var f=65536;n.setPRNG(function(r,e){var o,l=new Uint8Array(e);for(o=0;o<e;o+=f)t.getRandomValues(l.subarray(o,o+Math.min(e-o,f)));for(o=0;o<e;o++)r[o]=l[o];Qt(l)})}else typeof Cn<"u"&&(t=Mn,t&&t.randomBytes&&n.setPRNG(function(r,e){var o,l=t.randomBytes(e);for(o=0;o<e;o++)r[o]=l[o];Qt(l)}))}()})(s.exports?s.exports:self.nacl=self.nacl||{})})(an);var Nn=an.exports;const cn=En(Nn);var sn={exports:{}};(function(s){(function(n,a){s.exports?s.exports=a():(n.nacl||(n.nacl={}),n.nacl.util=a())})(An,function(){var n={};function a(i){if(!/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(i))throw new TypeError("invalid encoding")}return n.decodeUTF8=function(i){if(typeof i!="string")throw new TypeError("expected string");var u,m=unescape(encodeURIComponent(i)),S=new Uint8Array(m.length);for(u=0;u<m.length;u++)S[u]=m.charCodeAt(u);return S},n.encodeUTF8=function(i){var u,m=[];for(u=0;u<i.length;u++)m.push(String.fromCharCode(i[u]));return decodeURIComponent(escape(m.join("")))},typeof atob>"u"?typeof Buffer.from<"u"?(n.encodeBase64=function(i){return Buffer.from(i).toString("base64")},n.decodeBase64=function(i){return a(i),new Uint8Array(Array.prototype.slice.call(Buffer.from(i,"base64"),0))}):(n.encodeBase64=function(i){return new Buffer(i).toString("base64")},n.decodeBase64=function(i){return a(i),new Uint8Array(Array.prototype.slice.call(new Buffer(i,"base64"),0))}):(n.encodeBase64=function(i){var u,m=[],S=i.length;for(u=0;u<S;u++)m.push(String.fromCharCode(i[u]));return btoa(m.join(""))},n.decodeBase64=function(i){a(i);var u,m=atob(i),S=new Uint8Array(m.length);for(u=0;u<m.length;u++)S[u]=m.charCodeAt(u);return S}),n})})(sn);var ln=sn.exports;const Mt="meshlang_actors",Re="meshlang_active_actor",kt="meshlang_keys",et="meshlang_active_key";function $e(){const s=localStorage.getItem(Mt);if(s)try{const a=JSON.parse(s);return{actors:a.actors||a.keys||[]}}catch{return{actors:[]}}const n=localStorage.getItem(kt);if(n)try{const i={actors:JSON.parse(n).keys||[]};localStorage.setItem(Mt,JSON.stringify(i)),localStorage.removeItem(kt);const u=localStorage.getItem(et);return u&&(localStorage.setItem(Re,u),localStorage.removeItem(et)),i}catch{return{actors:[]}}return{actors:[]}}function Kt(s){localStorage.setItem(Mt,JSON.stringify(s))}function Pt(){const s=localStorage.getItem(Re);if(s)return s;const n=localStorage.getItem(et);return n?(localStorage.setItem(Re,n),localStorage.removeItem(et),n):null}function tt(s){localStorage.setItem(Re,s)}function dn(){return $e().actors}function Lt(s){return $e().actors.find(a=>a.id===s)||null}function un(s,n,a){const i=$e(),u=i.actors.findIndex(S=>S.id===s),m={id:s,name:n,publicKey:Array.from(a.publicKey),secretKey:Array.from(a.secretKey),createdAt:Date.now()};u>=0?i.actors[u]=m:i.actors.push(m),Kt(i)}function Tn(s){const n=$e();n.actors=n.actors.filter(a=>a.id!==s),Kt(n),Pt()===s&&localStorage.removeItem(Re)}function Kn(s,n){const a=$e(),i=a.actors.find(u=>u.id===s);i&&(i.name=n,Kt(a))}function Nt(s){return{publicKey:new Uint8Array(s.publicKey),secretKey:new Uint8Array(s.secretKey)}}function Pn(){const{publicKey:s,secretKey:n}=cn.sign.keyPair();return{publicKey:s,secretKey:n}}function Ut(s){const n=cn.hash(s);return ln.encodeBase64(n.slice(0,16)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function Fe(s){return{keyPair:s,nodeId:Ut(s.publicKey),publicKeyBase64:ln.encodeBase64(s.publicKey)}}function xn(s){const n=Pn(),a=Ut(n.publicKey),i=s||`Actor ${new Date().toLocaleString()}`;return un(a,i,n),tt(a),Fe(n)}function Ln(s){const n=Lt(s);return n?(tt(s),Fe(Nt(n))):null}function Un(){const s=dn(),n=Pt();if(n){const a=Lt(n);if(a)return Fe(Nt(a))}return s.length>0?(tt(s[0].id),Fe(Nt(s[0]))):xn("Default Actor")}function Ne(){return dn()}function nt(){return Pt()}function On(s){try{const n=JSON.parse(atob(s));if(!n.publicKey||!n.secretKey)return null;const a={publicKey:new Uint8Array(n.publicKey),secretKey:new Uint8Array(n.secretKey)},i=Ut(a.publicKey),u=n.name||`Imported ${new Date().toLocaleString()}`;return un(i,u,a),tt(i),Fe(a)}catch{return null}}function jn(s){const n=Lt(s);if(!n)return null;const a={name:n.name,publicKey:n.publicKey,secretKey:n.secretKey};return btoa(JSON.stringify(a))}class qn{facts=new Map;byScope=new Map;byKey=new Map;byValue=new Map;listeners=new Set;valueKey(n){return JSON.stringify(n)}factId(n,a){return`${a}:${n[0]}:${this.valueKey(n[1])}`}add(n,a,i){const u=i??a,m=this.factId(n,u);if(this.facts.has(m))return null;const S={id:m,fact:n,scope:u,timestamp:Date.now(),source:a};this.facts.set(m,S),this.byScope.has(u)||this.byScope.set(u,new Set),this.byScope.get(u).add(m),this.byKey.has(n[0])||this.byKey.set(n[0],new Set),this.byKey.get(n[0]).add(m);const I=this.valueKey(n[1]);this.byValue.has(I)||this.byValue.set(I,new Set),this.byValue.get(I).add(m);for(const M of this.listeners)M(S);return S}get(n){return this.facts.get(n)}has(n,a){return this.facts.has(this.factId(n,a))}retract(n,a){const i=this.factId(n,a);if(!this.facts.get(i))return!1;this.facts.delete(i);const m=this.byScope.get(a);m&&(m.delete(i),m.size===0&&this.byScope.delete(a));const S=this.byKey.get(n[0]);S&&(S.delete(i),S.size===0&&this.byKey.delete(n[0]));const I=this.valueKey(n[1]),M=this.byValue.get(I);return M&&(M.delete(i),M.size===0&&this.byValue.delete(I)),!0}all(){return Array.from(this.facts.values())}allIds(){return new Set(this.facts.keys())}findByScope(n){const a=this.byScope.get(n);return a?Array.from(a).map(i=>this.facts.get(i)):[]}findByKey(n){const a=this.byKey.get(n);return a?Array.from(a).map(i=>this.facts.get(i)):[]}findByValue(n){const a=this.byValue.get(this.valueKey(n));return a?Array.from(a).map(i=>this.facts.get(i)):[]}onAdd(n){return this.listeners.add(n),()=>this.listeners.delete(n)}addStored(n){if(this.facts.has(n.id))return!1;this.facts.set(n.id,n);const a=n.fact,i=n.scope;this.byScope.has(i)||this.byScope.set(i,new Set),this.byScope.get(i).add(n.id),this.byKey.has(a[0])||this.byKey.set(a[0],new Set),this.byKey.get(a[0]).add(n.id);const u=this.valueKey(a[1]);this.byValue.has(u)||this.byValue.set(u,new Set),this.byValue.get(u).add(n.id);for(const m of this.listeners)m(n);return!0}}function en(s){return{id:s.id,k:s.fact[0],v:s.fact[1],sc:s.scope,t:s.timestamp,s:s.source}}function tn(s){if("e"in s&&"a"in s){const a=s;return{id:a.id,fact:[a.a,a.v],scope:a.e,timestamp:a.t,source:a.s}}const n=s;return{id:n.id,fact:[n.k,n.v],scope:n.sc,timestamp:n.t,source:n.s}}function Yn(s){return JSON.stringify(s)}function Dn(s){return JSON.parse(s)}class nn{constructor(n,a={iceServers:[{urls:"stun:stun.l.google.com:19302"}]}){this.isInitiator=n,this.config=a,this.connection=new RTCPeerConnection(this.config),this.connection.oniceconnectionstatechange=()=>{console.log("[Peer] ICE connection state:",this.connection.iceConnectionState),(this.connection.iceConnectionState==="disconnected"||this.connection.iceConnectionState==="failed")&&this.setState("disconnected")},this.connection.onconnectionstatechange=()=>{console.log("[Peer] Connection state:",this.connection.connectionState)},this.connection.onsignalingstatechange=()=>{console.log("[Peer] Signaling state:",this.connection.signalingState)},n?(this.channel=this.connection.createDataChannel("meshlang"),this.setupChannel(this.channel)):this.connection.ondatachannel=i=>{this.channel=i.channel,this.setupChannel(this.channel)}}connection;channel=null;state="connecting";messageHandlers=new Set;stateHandlers=new Set;pendingCandidates=[];remoteDescriptionSet=!1;remoteInfo=null;setupChannel(n){console.log("[Peer] Setting up data channel:",n.label),n.onopen=()=>{console.log("[Peer] Data channel opened"),this.setState("connected")},n.onclose=()=>{console.log("[Peer] Data channel closed"),this.setState("disconnected")},n.onerror=a=>{console.error("[Peer] Data channel error:",a)},n.onmessage=a=>{try{const i=Dn(a.data);console.log("[Peer] Received message:",i.type),i.type==="hello"&&(this.remoteInfo={nodeId:i.nodeId,publicKey:i.publicKey});for(const u of this.messageHandlers)u(i)}catch(i){console.error("Failed to decode message:",i)}}}setState(n){this.state=n;for(const a of this.stateHandlers)a(n)}getState(){return this.state}async createOffer(){console.log("[Peer] Creating offer");const n=await this.connection.createOffer();return await this.connection.setLocalDescription(n),console.log("[Peer] Offer created and local description set"),n}async acceptOffer(n){console.log("[Peer] Accepting offer"),await this.connection.setRemoteDescription(n),this.remoteDescriptionSet=!0,await this.flushPendingCandidates();const a=await this.connection.createAnswer();return await this.connection.setLocalDescription(a),console.log("[Peer] Answer created and local description set"),a}async acceptAnswer(n){console.log("[Peer] Accepting answer"),await this.connection.setRemoteDescription(n),this.remoteDescriptionSet=!0,await this.flushPendingCandidates(),console.log("[Peer] Answer accepted, remote description set")}async flushPendingCandidates(){for(const n of this.pendingCandidates)await this.connection.addIceCandidate(n);this.pendingCandidates=[]}async addIceCandidate(n){this.remoteDescriptionSet?await this.connection.addIceCandidate(n):this.pendingCandidates.push(n)}onIceCandidate(n){const a=this.connection.onicecandidate;this.connection.onicecandidate=i=>{i.candidate&&(console.log("[Peer] ICE candidate:",i.candidate.candidate?.substring(0,50)),n(i.candidate)),a&&a.call(this.connection,i)}}onIceGatheringComplete(n){const a=this.connection.onicecandidate;this.connection.onicecandidate=i=>{a&&a.call(this.connection,i),i.candidate||(console.log("[Peer] ICE gathering complete"),n())}}send(n){this.channel&&this.channel.readyState==="open"&&this.channel.send(Yn(n))}onMessage(n){return this.messageHandlers.add(n),()=>this.messageHandlers.delete(n)}onStateChange(n){return this.stateHandlers.add(n),()=>this.stateHandlers.delete(n)}close(){this.channel?.close(),this.connection.close(),this.setState("disconnected")}}class Rn{constructor(n,a){this.identity=n,this.store=a,a.onAdd(i=>{const u={type:"fact-add",fact:en(i)};this.broadcast(u)})}peers=new Map;listeners=new Set;broadcast(n,a){for(const[i,u]of this.peers)i!==a&&u.getState()==="connected"&&u.send(n)}notifyListeners(){for(const n of this.listeners)n()}setupPeer(n){n.onStateChange(a=>{if(console.log("[Mesh] Peer state changed:",a,"remoteInfo:",n.remoteInfo?.nodeId),a==="connected"){console.log("[Mesh] Sending hello to peer"),n.send({type:"hello",nodeId:this.identity.nodeId,publicKey:this.identity.publicKeyBase64});const i=Array.from(this.store.allIds());console.log("[Mesh] Sending sync request with",i.length,"known facts"),n.send({type:"sync-request",haveIds:i}),this.notifyListeners()}a==="disconnected"&&n.remoteInfo&&(console.log("[Mesh] Peer disconnected:",n.remoteInfo.nodeId),this.peers.delete(n.remoteInfo.nodeId),this.notifyListeners())}),n.onMessage(a=>{console.log("[Mesh] Received message:",a.type),this.handleMessage(n,a)})}handleMessage(n,a){switch(a.type){case"hello":n.remoteInfo={nodeId:a.nodeId,publicKey:a.publicKey},this.peers.set(a.nodeId,n),this.notifyListeners();break;case"sync-request":{const i=new Set(a.haveIds),u=this.store.all().filter(m=>!i.has(m.id)).map(en);n.send({type:"sync-response",facts:u});break}case"sync-response":for(const i of a.facts){const u=tn(i);this.store.addStored(u)}break;case"fact-add":{const i=tn(a.fact);this.store.addStored(i)&&this.broadcast(a,n.remoteInfo?.nodeId);break}}}async createOffer(){console.log("[Mesh] Creating offer");const n=new nn(!0),a=[],i=new Promise(S=>{n.onIceCandidate(I=>{a.push(I)}),n.onIceGatheringComplete(()=>S())}),u=await n.createOffer();console.log("[Mesh] Waiting for ICE candidates..."),await i,console.log("[Mesh] Got",a.length,"ICE candidates");const m={type:"offer",nodeId:this.identity.nodeId,publicKey:this.identity.publicKeyBase64,sdp:u,candidates:a.map(S=>S.toJSON())};return this.peers.set("pending-offer",n),this.setupPeer(n),console.log("[Mesh] Offer created, waiting for answer"),btoa(JSON.stringify(m))}async acceptOffer(n){console.log("[Mesh] Accepting offer");const a=JSON.parse(atob(n));console.log("[Mesh] Offer from:",a.nodeId,"with",a.candidates.length,"candidates");const i=new nn(!1);i.remoteInfo={nodeId:a.nodeId,publicKey:a.publicKey};const u=[],m=new Promise(M=>{i.onIceCandidate(L=>{u.push(L)}),i.onIceGatheringComplete(()=>M())}),S=await i.acceptOffer(a.sdp);console.log("[Mesh] Adding",a.candidates.length,"remote ICE candidates");for(const M of a.candidates)await i.addIceCandidate(M);console.log("[Mesh] Waiting for local ICE candidates..."),await m,console.log("[Mesh] Got",u.length,"local ICE candidates"),this.peers.set(a.nodeId,i),this.setupPeer(i);const I={type:"answer",nodeId:this.identity.nodeId,publicKey:this.identity.publicKeyBase64,sdp:S,candidates:u.map(M=>M.toJSON())};return console.log("[Mesh] Answer created"),btoa(JSON.stringify(I))}async acceptAnswer(n){console.log("[Mesh] Accepting answer");const a=JSON.parse(atob(n));console.log("[Mesh] Answer from:",a.nodeId,"with",a.candidates.length,"candidates");const i=this.peers.get("pending-offer");if(!i)throw new Error("No pending offer to accept answer for");this.peers.delete("pending-offer"),i.remoteInfo={nodeId:a.nodeId,publicKey:a.publicKey},this.peers.set(a.nodeId,i),await i.acceptAnswer(a.sdp),console.log("[Mesh] Adding",a.candidates.length,"remote ICE candidates");for(const u of a.candidates)await i.addIceCandidate(u);console.log("[Mesh] Connection established")}getPeers(){const n=[];for(const a of this.peers.values())a.remoteInfo&&a.getState()==="connected"&&n.push(a.remoteInfo);return n}getPeerCount(){return this.getPeers().length}onChange(n){return this.listeners.add(n),()=>this.listeners.delete(n)}}class Oe{constructor(n){this.name=n}static isVar(n){return n instanceof Oe}}function It(s,n,a){if(Oe.isVar(s)){const i=a.get(s.name);if(i!==void 0)return i===n?a:null;const u=new Map(a);return u.set(s.name,n),u}return s===n?a:null}function Fn(s,n,a,i){let u=a;return i!==void 0&&(u=It(i,n.scope,u),!u)||(u=It(s[0],n.fact[0],u),!u)?null:(u=It(s[1],n.fact[1],u),u)}function $n(s,n,a){if(n.length===0)return[new Map];let i=[new Map];for(const u of n){const m=[];for(const S of i){let I;const[M,L]=u;a?.scope?I=s.findByScope(a.scope):!Oe.isVar(M)&&typeof M=="string"?I=s.findByKey(M):I=s.all(),a?.scope&&!Oe.isVar(M)&&(I=I.filter(G=>G.fact[0]===M));for(const G of I){const Q=Fn(u,G,S,a?.scopePattern);Q&&m.push(Q)}}i=m}return i}function rn(s){return new Oe(s)}function zn(s){const n={};for(const[a,i]of s)n[`?${a}`]=i;return n}async function fn(s){await navigator.clipboard.writeText(s)}function Vn(s,n,a){s.innerHTML=`
    <div class="exchange">
      <h3>Connect to Peer</h3>
      <div class="exchange-tabs">
        <button class="tab active" data-tab="initiate">Create Invite</button>
        <button class="tab" data-tab="join">Join with Invite</button>
      </div>

      <div class="tab-content" id="initiate-tab">
        <p>1. Click "Generate" to create an invite code</p>
        <button id="generate-offer">Generate Invite</button>
        <textarea id="offer-output" readonly placeholder="Invite code will appear here..."></textarea>
        <button id="copy-offer" disabled>Copy to Clipboard</button>

        <p>2. Share the code with peer, then paste their response:</p>
        <textarea id="answer-input" placeholder="Paste peer's response here..."></textarea>
        <button id="accept-answer" disabled>Connect</button>
      </div>

      <div class="tab-content hidden" id="join-tab">
        <p>1. Paste the invite code from your peer:</p>
        <textarea id="offer-input" placeholder="Paste invite code here..."></textarea>
        <button id="accept-offer">Accept Invite</button>

        <p>2. Copy the response and send it back:</p>
        <textarea id="answer-output" readonly placeholder="Response will appear here..."></textarea>
        <button id="copy-answer" disabled>Copy to Clipboard</button>
      </div>
    </div>
  `;const i=s.querySelectorAll(".tab"),u=s.querySelector("#initiate-tab"),m=s.querySelector("#join-tab");i.forEach(fe=>{fe.addEventListener("click",()=>{i.forEach(he=>he.classList.remove("active")),fe.classList.add("active");const ce=fe.dataset.tab;u.classList.toggle("hidden",ce!=="initiate"),m.classList.toggle("hidden",ce!=="join")})});const S=s.querySelector("#generate-offer"),I=s.querySelector("#offer-output"),M=s.querySelector("#copy-offer"),L=s.querySelector("#answer-input"),G=s.querySelector("#accept-answer");S.addEventListener("click",async()=>{S.disabled=!0,S.textContent="Generating...";try{const fe=await n.createOffer();I.value=fe,M.disabled=!1,G.disabled=!1}catch(fe){I.value=`Error: ${fe}`}S.disabled=!1,S.textContent="Generate Invite"}),M.addEventListener("click",async()=>{await fn(I.value),M.textContent="Copied!",setTimeout(()=>M.textContent="Copy to Clipboard",2e3)}),G.addEventListener("click",async()=>{const fe=L.value.trim();if(fe)try{await n.acceptAnswer(fe)}catch(ce){alert(`Failed to connect: ${ce}`)}});const Q=s.querySelector("#offer-input"),ne=s.querySelector("#accept-offer"),ae=s.querySelector("#answer-output"),re=s.querySelector("#copy-answer");ne.addEventListener("click",async()=>{const fe=Q.value.trim();if(fe){ne.disabled=!0,ne.textContent="Processing...";try{const ce=await n.acceptOffer(fe);ae.value=ce,re.disabled=!1}catch(ce){ae.value=`Error: ${ce}`}ne.disabled=!1,ne.textContent="Accept Invite"}}),re.addEventListener("click",async()=>{await fn(ae.value),re.textContent="Copied!",setTimeout(()=>re.textContent="Copy to Clipboard",2e3)})}function Bt(s,n){const i=s.findByScope(n).find(u=>u.fact[0]==="name");return i?String(i.fact[1]):n.slice(0,8)}function hn(s,n){const i=s.findByScope(n).find(m=>m.fact[0]==="parents");if(!i)return[];const u=i.fact[1];return Array.isArray(u)?u:typeof u=="string"?[u]:[]}function pn(s,n){const i=s.findByScope(n).find(m=>m.fact[0]==="children");if(!i)return[];const u=i.fact[1];return Array.isArray(u)?u:typeof u=="string"?[u]:[]}function on(s,n){return{currentScope:n,path:[...s.path,n]}}function Hn(s){if(s.path.length<=1)return null;const n=s.path.slice(0,-1);return{currentScope:n[n.length-1],path:n}}function Jn(s,n){return n<0||n>=s.path.length?s:{currentScope:s.path[n],path:s.path.slice(0,n+1)}}function Gn(s,n,a){if(n<=0||n>=s.path.length)return s;const i=[...s.path];return i[n-1]=a,{currentScope:s.currentScope,path:i}}function Zn(s,n,a,i){const u=pn(s,n);if(!u.includes(a)){const S=[...u,a],I=s.findByScope(n).find(M=>M.fact[0]==="children");I&&s.retract(I.fact,n),s.add(["children",S],i,n)}const m=hn(s,a);if(!m.includes(n)){const S=[...m,n],I=s.findByScope(a).find(M=>M.fact[0]==="parents");I&&s.retract(I.fact,a),s.add(["parents",S],i,a)}}function Wn(s,n,a,i){const u=`scope_${Date.now()}_${Math.random().toString(36).slice(2,8)}`;return s.add(["name",a],i,u),Zn(s,n,u,i),u}function Xn(s){return{currentScope:s,path:[s]}}function Qn(s){return typeof s=="string"?`"${s}"`:s===null?"null":String(s)}function kn(s,n,a){const i=document.createElement("div");i.className="scope-navigator";const u=document.createElement("div");u.className="breadcrumbs",n.path.forEach((I,M)=>{const L=document.createElement("div");L.className="breadcrumb";const G=Bt(s,I),Q=hn(s,I),ne=M===n.path.length-1;if(M>0&&Q.length>1){const re=document.createElement("select");re.className="breadcrumb-dropdown";const fe=n.path[M-1];Q.forEach(ce=>{const he=document.createElement("option");he.value=ce,he.textContent=Bt(s,ce),he.selected=ce===fe,re.appendChild(he)}),re.onchange=()=>{const ce=Gn(n,M,re.value);a(ce)},L.appendChild(re),L.appendChild(document.createTextNode(" / "))}else M>0&&L.appendChild(document.createTextNode(" / "));const ae=document.createElement("span");ae.className=`breadcrumb-name ${ne?"current":"clickable"}`,ae.textContent=G,ne||(ae.onclick=()=>{const re=Jn(n,M);a(re)}),L.appendChild(ae),u.appendChild(L)}),i.appendChild(u);const m=pn(s,n.currentScope);if(m.length>0){const I=document.createElement("div");I.className="child-scopes";const M=document.createElement("span");M.className="child-scopes-label",M.textContent="Subscopes: ",I.appendChild(M),m.forEach(L=>{const G=document.createElement("button");G.className="child-scope-btn",G.textContent=Bt(s,L),G.onclick=()=>{const Q=on(n,L);a(Q)},I.appendChild(G)}),i.appendChild(I)}const S=document.createElement("button");if(S.className="add-child-scope-btn",S.textContent="+ New Subscope",S.onclick=()=>{const I=prompt("Name for new subscope:");if(I){const M=Wn(s,n.currentScope,I,n.currentScope),L=on(n,M);a(L)}},i.appendChild(S),n.path.length>1){const I=document.createElement("button");I.className="scope-up-btn",I.textContent=" Up",I.onclick=()=>{const M=Hn(n);M&&a(M)},i.appendChild(I)}return i}function Tt(s){const n=s.trim();return n==="true"?!0:n==="false"?!1:n==="null"?null:/^-?\d+(\.\d+)?$/.test(n)?parseFloat(n):n.startsWith('"')&&n.endsWith('"')||n.startsWith("'")&&n.endsWith("'")?n.slice(1,-1):n}function er(s,n,a){const i=document.createElement("div"),u=s.findByScope(n);if(u.length===0)return i.innerHTML='<p class="empty-state">No facts in this scope. Add some below.</p>',i;const m=document.createElement("ul");m.className="fact-list";for(const S of u){const I=document.createElement("li");I.className="fact-item";const M=document.createElement("span");M.className="key",M.textContent=S.fact[0];const L=document.createTextNode(": "),G=document.createElement("span");G.className="value editable",G.textContent=Qn(S.fact[1]),G.title="Click to edit",G.onclick=()=>{const Q=document.createElement("input");Q.type="text",Q.className="fact-edit-input",Q.value=typeof S.fact[1]=="string"?S.fact[1]:String(S.fact[1]);const ne=()=>{const ae=Tt(Q.value),re=S.fact;s.retract(re,n),s.add([re[0],ae],a,n)};Q.onblur=ne,Q.onkeydown=ae=>{ae.key==="Enter"?ne():ae.key==="Escape"&&s.add(S.fact,a,S.scope)},G.replaceWith(Q),Q.focus(),Q.select()},I.appendChild(M),I.appendChild(L),I.appendChild(G),m.appendChild(I)}return i.appendChild(m),i}function tr(s,n,a){const i=document.createElement("div");i.className="add-fact-form",i.innerHTML=`
    <input type="text" id="fact-key" placeholder="key" />
    <input type="text" id="fact-value" placeholder="value" />
    <button id="add-fact-btn">Add</button>
  `;const u=i.querySelector("#fact-key"),m=i.querySelector("#fact-value"),S=i.querySelector("#add-fact-btn"),I=()=>{const M=u.value.trim();let L=m.value.trim();M&&(L==="true"?L=!0:L==="false"?L=!1:L==="null"?L=null:/^-?\d+(\.\d+)?$/.test(L)&&(L=parseFloat(L)),s.add([M,L],a,n),u.value="",m.value="",u.focus())};return S.onclick=I,[u,m].forEach(M=>{M.onkeydown=L=>{L.key==="Enter"&&I()}}),i}function nr(s,n){const a=document.createElement("div");a.className="query-builder",a.innerHTML=`
    <h4>Query in current scope</h4>
    <div class="query-pattern">
      <div class="pattern-slot" data-slot="key">
        <label>Key</label>
        <div class="slot-options">
          <button class="slot-btn" data-type="any">Any (?k)</button>
          <button class="slot-btn active" data-type="specific">Specific</button>
        </div>
        <input type="text" class="slot-input" placeholder="key" />
      </div>

      <div class="pattern-slot" data-slot="value">
        <label>Value</label>
        <div class="slot-options">
          <button class="slot-btn active" data-type="any">Any (?v)</button>
          <button class="slot-btn" data-type="specific">Specific</button>
        </div>
        <input type="text" class="slot-input hidden" placeholder="value" />
      </div>
    </div>

    <div class="query-preview">
      <code class="pattern-text"></code>
    </div>

    <div class="query-results empty">Configure pattern above</div>
  `;const i=a.querySelectorAll(".pattern-slot"),u=a.querySelector(".pattern-text"),m=a.querySelector(".query-results"),S={key:{type:"specific",value:""},value:{type:"any",value:""}};function I(){const L=S.key.type==="any"?"?key":S.key.value||"?key",G=S.value.type==="any"?"?val":S.value.value||"?val";u.textContent=`[${L}, ${G}]`}function M(){try{const L=S.key.type==="any"?rn("key"):Tt(S.key.value),G=S.value.type==="any"?rn("val"):Tt(S.value.value),ne=$n(s,[[L,G]],{scope:n});ne.length===0?(m.className="query-results empty",m.textContent="No matches"):(m.className="query-results",m.innerHTML=ne.map(ae=>`<div class="result-row">${JSON.stringify(zn(ae))}</div>`).join(""))}catch(L){m.className="query-results empty",m.textContent=`Error: ${L}`}}return i.forEach(L=>{const G=L.dataset.slot,Q=L.querySelectorAll(".slot-btn"),ne=L.querySelector(".slot-input");Q.forEach(ae=>{ae.addEventListener("click",()=>{const re=ae.dataset.type;Q.forEach(fe=>fe.classList.remove("active")),ae.classList.add("active"),S[G].type=re,re==="specific"?(ne.classList.remove("hidden"),ne.focus()):ne.classList.add("hidden"),I(),M()})}),ne.addEventListener("input",()=>{S[G].value=ne.value,I(),M()})}),I(),M(),a}function rr(s,n,a){const i=n.findByScope(s).find(u=>u.fact[0]==="name");return i?String(i.fact[1]):a}function fr(s,n,a){const i=document.createElement("div");i.className="actor-switcher";const u=n.getActors();i.innerHTML=`
    <div class="actor-switcher-row">
      <select class="actor-select">
        ${u.map(ue=>`<option value="${ue.id}" ${ue.id===s?"selected":""}>${rr(ue.id,a,ue.name)}</option>`).join("")}
      </select>
      <button class="actor-btn" title="New Actor">+</button>
      <button class="actor-btn" title="Import Actor">Import</button>
      <button class="actor-btn" title="Export Actor">Export</button>
      <button class="actor-btn actor-btn-danger" title="Delete Actor">Delete</button>
    </div>
    <div class="actor-import-row hidden">
      <input type="text" class="actor-import-input" placeholder="Paste actor data..." />
      <button class="actor-import-btn">Import</button>
      <button class="actor-import-cancel">Cancel</button>
    </div>
    <div class="actor-export-row hidden">
      <textarea class="actor-export-output" readonly></textarea>
      <button class="actor-export-copy">Copy</button>
      <button class="actor-export-close">Close</button>
    </div>
  `;const m=i.querySelector(".actor-select"),S=i.querySelectorAll(".actor-btn")[0],I=i.querySelectorAll(".actor-btn")[1],M=i.querySelectorAll(".actor-btn")[2],L=i.querySelectorAll(".actor-btn")[3],G=i.querySelector(".actor-import-row"),Q=i.querySelector(".actor-import-input"),ne=i.querySelector(".actor-import-btn"),ae=i.querySelector(".actor-import-cancel"),re=i.querySelector(".actor-export-row"),fe=i.querySelector(".actor-export-output"),ce=i.querySelector(".actor-export-copy"),he=i.querySelector(".actor-export-close");return m.onchange=()=>{n.onSwitchActor(m.value)},S.onclick=()=>{const ue=prompt("Enter a name for the new actor:",`Actor ${new Date().toLocaleString()}`);ue!==null&&n.onCreateActor(ue||void 0)},I.onclick=()=>{G.classList.remove("hidden"),Q.focus()},ae.onclick=()=>{G.classList.add("hidden"),Q.value=""},ne.onclick=()=>{const ue=Q.value.trim();if(!ue)return;n.onImportActor(ue)?(G.classList.add("hidden"),Q.value=""):alert("Invalid actor data")},M.onclick=()=>{const ue=n.onExportActor(s);ue&&(fe.value=ue,re.classList.remove("hidden"))},ce.onclick=async()=>{await navigator.clipboard.writeText(fe.value),ce.textContent="Copied!",setTimeout(()=>ce.textContent="Copy",2e3)},he.onclick=()=>{re.classList.add("hidden"),fe.value=""},L.onclick=()=>{if(u.length<=1){alert("Cannot delete the last actor");return}confirm("Are you sure you want to delete this actor?")&&n.onDeleteActor(s)},i}function rt(s,n,a){const{identity:i,store:u,mesh:m}=n;let S=n.navigation||Xn(i.nodeId);function I(L){S=L,M()}function M(){const L=m.getPeerCount(),G=S.currentScope,Q=u.findByScope(G);s.innerHTML="";const ne=document.createElement("div");ne.className="header";const ae=document.createElement("div");ae.className="header-info",ae.innerHTML=`
      <div class="node-id">Node: ${i.nodeId}</div>
      <div class="peer-count ${L>0?"connected":""}">
        ${L} peer${L!==1?"s":""} connected
      </div>
    `,ne.appendChild(ae),ne.appendChild(fr(i.nodeId,a,u)),s.appendChild(ne);const re=document.createElement("div");re.className="section",re.innerHTML=`
      <div class="section-header">
        <h2>Scope</h2>
      </div>
    `;const fe=document.createElement("div");fe.className="section-content",fe.appendChild(kn(u,S,I)),re.appendChild(fe),s.appendChild(re);const ce=document.createElement("div");ce.className="section",ce.innerHTML=`
      <div class="section-header">
        <h2>Facts</h2>
        <span>${Q.length} in scope</span>
      </div>
    `;const he=document.createElement("div");he.className="section-content",he.appendChild(er(u,G,i.nodeId)),he.appendChild(tr(u,G,i.nodeId)),ce.appendChild(he),s.appendChild(ce);const ue=document.createElement("div");ue.className="section",ue.innerHTML=`
      <div class="section-header">
        <h2>Query</h2>
      </div>
    `;const Te=document.createElement("div");Te.className="section-content",Te.appendChild(nr(u,G)),ue.appendChild(Te),s.appendChild(ue);const Ae=document.createElement("div");Ae.className="section",Ae.innerHTML=`
      <div class="section-header">
        <h2>Connect</h2>
      </div>
    `;const Ce=document.createElement("div");Ce.className="section-content",Vn(Ce,m),Ae.appendChild(Ce),s.appendChild(Ae)}M(),u.onAdd(()=>M()),m.onChange(()=>M())}let ve=null;function ft(s){const n=new qn,a=new Rn(s,n);return{identity:s,store:n,mesh:a}}function ze(s){const n=Ln(s);if(!n)return!1;ve=ft(n),lt(n,ve.store),console.log("Switched to Node ID:",n.nodeId);const a=document.getElementById("app");return a&&rt(a,ve,{onSwitchActor:ze,onCreateActor:ot,onImportActor:at,onExportActor:ct,onDeleteActor:st,onRenameActor:it,getActors:Ne,getCurrentActorId:nt}),!0}function ot(s){const n=xn(s);ve=ft(n),lt(n,ve.store);const a=document.getElementById("app");return a&&rt(a,ve,{onSwitchActor:ze,onCreateActor:ot,onImportActor:at,onExportActor:ct,onDeleteActor:st,onRenameActor:it,getActors:Ne,getCurrentActorId:nt}),n}function at(s){const n=On(s);if(!n)return null;ve=ft(n),lt(n,ve.store);const a=document.getElementById("app");return a&&rt(a,ve,{onSwitchActor:ze,onCreateActor:ot,onImportActor:at,onExportActor:ct,onDeleteActor:st,onRenameActor:it,getActors:Ne,getCurrentActorId:nt}),n}function ct(s){return jn(s)}function st(s){if(Ne().length<=1)return alert("Cannot delete the last actor"),!1;if(Tn(s),ve?.identity.nodeId===s){const a=Ne();a.length>0&&ze(a[0].id)}return!0}function it(s,n){Kn(s,n)}function lt(s,n){if(!n.findByScope(s.nodeId).find(i=>i.fact[0]==="name")){const u=Ne().find(m=>m.id===s.nodeId)?.name||s.nodeId;n.add(["name",u],s.nodeId,s.nodeId)}}function or(){const s=Un();console.log("Node ID:",s.nodeId),ve=ft(s),lt(s,ve.store),rt(document.getElementById("app"),ve,{onSwitchActor:ze,onCreateActor:ot,onImportActor:at,onExportActor:ct,onDeleteActor:st,onRenameActor:it,getActors:Ne,getCurrentActorId:nt})}or();
