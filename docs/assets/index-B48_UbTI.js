(function(){const f=document.createElement("link").relList;if(f&&f.supports&&f.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))s(h);new MutationObserver(h=>{for(const m of h)if(m.type==="childList")for(const _ of m.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&s(_)}).observe(document,{childList:!0,subtree:!0});function a(h){const m={};return h.integrity&&(m.integrity=h.integrity),h.referrerPolicy&&(m.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?m.credentials="include":h.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function s(h){if(h.ep)return;h.ep=!0;const m=a(h);fetch(h.href,m)}})();var vn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function wn(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function mn(i){if(i.__esModule)return i;var f=i.default;if(typeof f=="function"){var a=function s(){return this instanceof s?Reflect.construct(f,arguments,this.constructor):f.apply(this,arguments)};a.prototype=f.prototype}else a={};return Object.defineProperty(a,"__esModule",{value:!0}),Object.keys(i).forEach(function(s){var h=Object.getOwnPropertyDescriptor(i,s);Object.defineProperty(a,s,h.get?h:{enumerable:!0,get:function(){return i[s]}})}),a}function Sn(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var fn={exports:{}};const An={},_n=Object.freeze(Object.defineProperty({__proto__:null,default:An},Symbol.toStringTag,{value:"Module"})),En=mn(_n);(function(i){(function(f){var a=function(t){var r,n=new Float64Array(16);if(t)for(r=0;r<t.length;r++)n[r]=t[r];return n},s=function(){throw new Error("no PRNG")},h=new Uint8Array(16),m=new Uint8Array(32);m[0]=9;var _=a(),Y=a([1]),L=a([56129,1]),ne=a([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),fe=a([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),re=a([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),W=a([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),ae=a([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function oe(t,r,n,e){t[r]=n>>24&255,t[r+1]=n>>16&255,t[r+2]=n>>8&255,t[r+3]=n&255,t[r+4]=e>>24&255,t[r+5]=e>>16&255,t[r+6]=e>>8&255,t[r+7]=e&255}function ee(t,r,n,e,o){var l,d=0;for(l=0;l<o;l++)d|=t[r+l]^n[e+l];return(1&d-1>>>8)-1}function ce(t,r,n,e){return ee(t,r,n,e,16)}function he(t,r,n,e){return ee(t,r,n,e,32)}function ue(t,r,n,e){for(var o=e[0]&255|(e[1]&255)<<8|(e[2]&255)<<16|(e[3]&255)<<24,l=n[0]&255|(n[1]&255)<<8|(n[2]&255)<<16|(n[3]&255)<<24,d=n[4]&255|(n[5]&255)<<8|(n[6]&255)<<16|(n[7]&255)<<24,y=n[8]&255|(n[9]&255)<<8|(n[10]&255)<<16|(n[11]&255)<<24,w=n[12]&255|(n[13]&255)<<8|(n[14]&255)<<16|(n[15]&255)<<24,K=e[4]&255|(e[5]&255)<<8|(e[6]&255)<<16|(e[7]&255)<<24,A=r[0]&255|(r[1]&255)<<8|(r[2]&255)<<16|(r[3]&255)<<24,X=r[4]&255|(r[5]&255)<<8|(r[6]&255)<<16|(r[7]&255)<<24,C=r[8]&255|(r[9]&255)<<8|(r[10]&255)<<16|(r[11]&255)<<24,N=r[12]&255|(r[13]&255)<<8|(r[14]&255)<<16|(r[15]&255)<<24,O=e[8]&255|(e[9]&255)<<8|(e[10]&255)<<16|(e[11]&255)<<24,R=n[16]&255|(n[17]&255)<<8|(n[18]&255)<<16|(n[19]&255)<<24,D=n[20]&255|(n[21]&255)<<8|(n[22]&255)<<16|(n[23]&255)<<24,P=n[24]&255|(n[25]&255)<<8|(n[26]&255)<<16|(n[27]&255)<<24,q=n[28]&255|(n[29]&255)<<8|(n[30]&255)<<16|(n[31]&255)<<24,j=e[12]&255|(e[13]&255)<<8|(e[14]&255)<<16|(e[15]&255)<<24,I=o,T=l,E=d,B=y,M=w,S=K,x=A,u=X,g=C,p=N,b=O,v=R,U=D,$=P,z=q,F=j,c,H=0;H<20;H+=2)c=I+U|0,M^=c<<7|c>>>25,c=M+I|0,g^=c<<9|c>>>23,c=g+M|0,U^=c<<13|c>>>19,c=U+g|0,I^=c<<18|c>>>14,c=S+T|0,p^=c<<7|c>>>25,c=p+S|0,$^=c<<9|c>>>23,c=$+p|0,T^=c<<13|c>>>19,c=T+$|0,S^=c<<18|c>>>14,c=b+x|0,z^=c<<7|c>>>25,c=z+b|0,E^=c<<9|c>>>23,c=E+z|0,x^=c<<13|c>>>19,c=x+E|0,b^=c<<18|c>>>14,c=F+v|0,B^=c<<7|c>>>25,c=B+F|0,u^=c<<9|c>>>23,c=u+B|0,v^=c<<13|c>>>19,c=v+u|0,F^=c<<18|c>>>14,c=I+B|0,T^=c<<7|c>>>25,c=T+I|0,E^=c<<9|c>>>23,c=E+T|0,B^=c<<13|c>>>19,c=B+E|0,I^=c<<18|c>>>14,c=S+M|0,x^=c<<7|c>>>25,c=x+S|0,u^=c<<9|c>>>23,c=u+x|0,M^=c<<13|c>>>19,c=M+u|0,S^=c<<18|c>>>14,c=b+p|0,v^=c<<7|c>>>25,c=v+b|0,g^=c<<9|c>>>23,c=g+v|0,p^=c<<13|c>>>19,c=p+g|0,b^=c<<18|c>>>14,c=F+z|0,U^=c<<7|c>>>25,c=U+F|0,$^=c<<9|c>>>23,c=$+U|0,z^=c<<13|c>>>19,c=z+$|0,F^=c<<18|c>>>14;I=I+o|0,T=T+l|0,E=E+d|0,B=B+y|0,M=M+w|0,S=S+K|0,x=x+A|0,u=u+X|0,g=g+C|0,p=p+N|0,b=b+O|0,v=v+R|0,U=U+D|0,$=$+P|0,z=z+q|0,F=F+j|0,t[0]=I>>>0&255,t[1]=I>>>8&255,t[2]=I>>>16&255,t[3]=I>>>24&255,t[4]=T>>>0&255,t[5]=T>>>8&255,t[6]=T>>>16&255,t[7]=T>>>24&255,t[8]=E>>>0&255,t[9]=E>>>8&255,t[10]=E>>>16&255,t[11]=E>>>24&255,t[12]=B>>>0&255,t[13]=B>>>8&255,t[14]=B>>>16&255,t[15]=B>>>24&255,t[16]=M>>>0&255,t[17]=M>>>8&255,t[18]=M>>>16&255,t[19]=M>>>24&255,t[20]=S>>>0&255,t[21]=S>>>8&255,t[22]=S>>>16&255,t[23]=S>>>24&255,t[24]=x>>>0&255,t[25]=x>>>8&255,t[26]=x>>>16&255,t[27]=x>>>24&255,t[28]=u>>>0&255,t[29]=u>>>8&255,t[30]=u>>>16&255,t[31]=u>>>24&255,t[32]=g>>>0&255,t[33]=g>>>8&255,t[34]=g>>>16&255,t[35]=g>>>24&255,t[36]=p>>>0&255,t[37]=p>>>8&255,t[38]=p>>>16&255,t[39]=p>>>24&255,t[40]=b>>>0&255,t[41]=b>>>8&255,t[42]=b>>>16&255,t[43]=b>>>24&255,t[44]=v>>>0&255,t[45]=v>>>8&255,t[46]=v>>>16&255,t[47]=v>>>24&255,t[48]=U>>>0&255,t[49]=U>>>8&255,t[50]=U>>>16&255,t[51]=U>>>24&255,t[52]=$>>>0&255,t[53]=$>>>8&255,t[54]=$>>>16&255,t[55]=$>>>24&255,t[56]=z>>>0&255,t[57]=z>>>8&255,t[58]=z>>>16&255,t[59]=z>>>24&255,t[60]=F>>>0&255,t[61]=F>>>8&255,t[62]=F>>>16&255,t[63]=F>>>24&255}function Ee(t,r,n,e){for(var o=e[0]&255|(e[1]&255)<<8|(e[2]&255)<<16|(e[3]&255)<<24,l=n[0]&255|(n[1]&255)<<8|(n[2]&255)<<16|(n[3]&255)<<24,d=n[4]&255|(n[5]&255)<<8|(n[6]&255)<<16|(n[7]&255)<<24,y=n[8]&255|(n[9]&255)<<8|(n[10]&255)<<16|(n[11]&255)<<24,w=n[12]&255|(n[13]&255)<<8|(n[14]&255)<<16|(n[15]&255)<<24,K=e[4]&255|(e[5]&255)<<8|(e[6]&255)<<16|(e[7]&255)<<24,A=r[0]&255|(r[1]&255)<<8|(r[2]&255)<<16|(r[3]&255)<<24,X=r[4]&255|(r[5]&255)<<8|(r[6]&255)<<16|(r[7]&255)<<24,C=r[8]&255|(r[9]&255)<<8|(r[10]&255)<<16|(r[11]&255)<<24,N=r[12]&255|(r[13]&255)<<8|(r[14]&255)<<16|(r[15]&255)<<24,O=e[8]&255|(e[9]&255)<<8|(e[10]&255)<<16|(e[11]&255)<<24,R=n[16]&255|(n[17]&255)<<8|(n[18]&255)<<16|(n[19]&255)<<24,D=n[20]&255|(n[21]&255)<<8|(n[22]&255)<<16|(n[23]&255)<<24,P=n[24]&255|(n[25]&255)<<8|(n[26]&255)<<16|(n[27]&255)<<24,q=n[28]&255|(n[29]&255)<<8|(n[30]&255)<<16|(n[31]&255)<<24,j=e[12]&255|(e[13]&255)<<8|(e[14]&255)<<16|(e[15]&255)<<24,I=o,T=l,E=d,B=y,M=w,S=K,x=A,u=X,g=C,p=N,b=O,v=R,U=D,$=P,z=q,F=j,c,H=0;H<20;H+=2)c=I+U|0,M^=c<<7|c>>>25,c=M+I|0,g^=c<<9|c>>>23,c=g+M|0,U^=c<<13|c>>>19,c=U+g|0,I^=c<<18|c>>>14,c=S+T|0,p^=c<<7|c>>>25,c=p+S|0,$^=c<<9|c>>>23,c=$+p|0,T^=c<<13|c>>>19,c=T+$|0,S^=c<<18|c>>>14,c=b+x|0,z^=c<<7|c>>>25,c=z+b|0,E^=c<<9|c>>>23,c=E+z|0,x^=c<<13|c>>>19,c=x+E|0,b^=c<<18|c>>>14,c=F+v|0,B^=c<<7|c>>>25,c=B+F|0,u^=c<<9|c>>>23,c=u+B|0,v^=c<<13|c>>>19,c=v+u|0,F^=c<<18|c>>>14,c=I+B|0,T^=c<<7|c>>>25,c=T+I|0,E^=c<<9|c>>>23,c=E+T|0,B^=c<<13|c>>>19,c=B+E|0,I^=c<<18|c>>>14,c=S+M|0,x^=c<<7|c>>>25,c=x+S|0,u^=c<<9|c>>>23,c=u+x|0,M^=c<<13|c>>>19,c=M+u|0,S^=c<<18|c>>>14,c=b+p|0,v^=c<<7|c>>>25,c=v+b|0,g^=c<<9|c>>>23,c=g+v|0,p^=c<<13|c>>>19,c=p+g|0,b^=c<<18|c>>>14,c=F+z|0,U^=c<<7|c>>>25,c=U+F|0,$^=c<<9|c>>>23,c=$+U|0,z^=c<<13|c>>>19,c=z+$|0,F^=c<<18|c>>>14;t[0]=I>>>0&255,t[1]=I>>>8&255,t[2]=I>>>16&255,t[3]=I>>>24&255,t[4]=S>>>0&255,t[5]=S>>>8&255,t[6]=S>>>16&255,t[7]=S>>>24&255,t[8]=b>>>0&255,t[9]=b>>>8&255,t[10]=b>>>16&255,t[11]=b>>>24&255,t[12]=F>>>0&255,t[13]=F>>>8&255,t[14]=F>>>16&255,t[15]=F>>>24&255,t[16]=x>>>0&255,t[17]=x>>>8&255,t[18]=x>>>16&255,t[19]=x>>>24&255,t[20]=u>>>0&255,t[21]=u>>>8&255,t[22]=u>>>16&255,t[23]=u>>>24&255,t[24]=g>>>0&255,t[25]=g>>>8&255,t[26]=g>>>16&255,t[27]=g>>>24&255,t[28]=p>>>0&255,t[29]=p>>>8&255,t[30]=p>>>16&255,t[31]=p>>>24&255}function Ce(t,r,n,e){ue(t,r,n,e)}function Ie(t,r,n,e){Ee(t,r,n,e)}var Be=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);function Pt(t,r,n,e,o,l,d){var y=new Uint8Array(16),w=new Uint8Array(64),K,A;for(A=0;A<16;A++)y[A]=0;for(A=0;A<8;A++)y[A]=l[A];for(;o>=64;){for(Ce(w,y,d,Be),A=0;A<64;A++)t[r+A]=n[e+A]^w[A];for(K=1,A=8;A<16;A++)K=K+(y[A]&255)|0,y[A]=K&255,K>>>=8;o-=64,r+=64,e+=64}if(o>0)for(Ce(w,y,d,Be),A=0;A<o;A++)t[r+A]=n[e+A]^w[A];return 0}function jt(t,r,n,e,o){var l=new Uint8Array(16),d=new Uint8Array(64),y,w;for(w=0;w<16;w++)l[w]=0;for(w=0;w<8;w++)l[w]=e[w];for(;n>=64;){for(Ce(d,l,o,Be),w=0;w<64;w++)t[r+w]=d[w];for(y=1,w=8;w<16;w++)y=y+(l[w]&255)|0,l[w]=y&255,y>>>=8;n-=64,r+=64}if(n>0)for(Ce(d,l,o,Be),w=0;w<n;w++)t[r+w]=d[w];return 0}function qt(t,r,n,e,o){var l=new Uint8Array(32);Ie(l,e,o,Be);for(var d=new Uint8Array(8),y=0;y<8;y++)d[y]=e[y+16];return jt(t,r,n,d,l)}function dt(t,r,n,e,o,l,d){var y=new Uint8Array(32);Ie(y,l,d,Be);for(var w=new Uint8Array(8),K=0;K<8;K++)w[K]=l[K+16];return Pt(t,r,n,e,o,w,y)}var Ve=function(t){this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.leftover=0,this.fin=0;var r,n,e,o,l,d,y,w;r=t[0]&255|(t[1]&255)<<8,this.r[0]=r&8191,n=t[2]&255|(t[3]&255)<<8,this.r[1]=(r>>>13|n<<3)&8191,e=t[4]&255|(t[5]&255)<<8,this.r[2]=(n>>>10|e<<6)&7939,o=t[6]&255|(t[7]&255)<<8,this.r[3]=(e>>>7|o<<9)&8191,l=t[8]&255|(t[9]&255)<<8,this.r[4]=(o>>>4|l<<12)&255,this.r[5]=l>>>1&8190,d=t[10]&255|(t[11]&255)<<8,this.r[6]=(l>>>14|d<<2)&8191,y=t[12]&255|(t[13]&255)<<8,this.r[7]=(d>>>11|y<<5)&8065,w=t[14]&255|(t[15]&255)<<8,this.r[8]=(y>>>8|w<<8)&8191,this.r[9]=w>>>5&127,this.pad[0]=t[16]&255|(t[17]&255)<<8,this.pad[1]=t[18]&255|(t[19]&255)<<8,this.pad[2]=t[20]&255|(t[21]&255)<<8,this.pad[3]=t[22]&255|(t[23]&255)<<8,this.pad[4]=t[24]&255|(t[25]&255)<<8,this.pad[5]=t[26]&255|(t[27]&255)<<8,this.pad[6]=t[28]&255|(t[29]&255)<<8,this.pad[7]=t[30]&255|(t[31]&255)<<8};Ve.prototype.blocks=function(t,r,n){for(var e=this.fin?0:2048,o,l,d,y,w,K,A,X,C,N,O,R,D,P,q,j,I,T,E,B=this.h[0],M=this.h[1],S=this.h[2],x=this.h[3],u=this.h[4],g=this.h[5],p=this.h[6],b=this.h[7],v=this.h[8],U=this.h[9],$=this.r[0],z=this.r[1],F=this.r[2],c=this.r[3],H=this.r[4],Q=this.r[5],k=this.r[6],V=this.r[7],G=this.r[8],Z=this.r[9];n>=16;)o=t[r+0]&255|(t[r+1]&255)<<8,B+=o&8191,l=t[r+2]&255|(t[r+3]&255)<<8,M+=(o>>>13|l<<3)&8191,d=t[r+4]&255|(t[r+5]&255)<<8,S+=(l>>>10|d<<6)&8191,y=t[r+6]&255|(t[r+7]&255)<<8,x+=(d>>>7|y<<9)&8191,w=t[r+8]&255|(t[r+9]&255)<<8,u+=(y>>>4|w<<12)&8191,g+=w>>>1&8191,K=t[r+10]&255|(t[r+11]&255)<<8,p+=(w>>>14|K<<2)&8191,A=t[r+12]&255|(t[r+13]&255)<<8,b+=(K>>>11|A<<5)&8191,X=t[r+14]&255|(t[r+15]&255)<<8,v+=(A>>>8|X<<8)&8191,U+=X>>>5|e,C=0,N=C,N+=B*$,N+=M*(5*Z),N+=S*(5*G),N+=x*(5*V),N+=u*(5*k),C=N>>>13,N&=8191,N+=g*(5*Q),N+=p*(5*H),N+=b*(5*c),N+=v*(5*F),N+=U*(5*z),C+=N>>>13,N&=8191,O=C,O+=B*z,O+=M*$,O+=S*(5*Z),O+=x*(5*G),O+=u*(5*V),C=O>>>13,O&=8191,O+=g*(5*k),O+=p*(5*Q),O+=b*(5*H),O+=v*(5*c),O+=U*(5*F),C+=O>>>13,O&=8191,R=C,R+=B*F,R+=M*z,R+=S*$,R+=x*(5*Z),R+=u*(5*G),C=R>>>13,R&=8191,R+=g*(5*V),R+=p*(5*k),R+=b*(5*Q),R+=v*(5*H),R+=U*(5*c),C+=R>>>13,R&=8191,D=C,D+=B*c,D+=M*F,D+=S*z,D+=x*$,D+=u*(5*Z),C=D>>>13,D&=8191,D+=g*(5*G),D+=p*(5*V),D+=b*(5*k),D+=v*(5*Q),D+=U*(5*H),C+=D>>>13,D&=8191,P=C,P+=B*H,P+=M*c,P+=S*F,P+=x*z,P+=u*$,C=P>>>13,P&=8191,P+=g*(5*Z),P+=p*(5*G),P+=b*(5*V),P+=v*(5*k),P+=U*(5*Q),C+=P>>>13,P&=8191,q=C,q+=B*Q,q+=M*H,q+=S*c,q+=x*F,q+=u*z,C=q>>>13,q&=8191,q+=g*$,q+=p*(5*Z),q+=b*(5*G),q+=v*(5*V),q+=U*(5*k),C+=q>>>13,q&=8191,j=C,j+=B*k,j+=M*Q,j+=S*H,j+=x*c,j+=u*F,C=j>>>13,j&=8191,j+=g*z,j+=p*$,j+=b*(5*Z),j+=v*(5*G),j+=U*(5*V),C+=j>>>13,j&=8191,I=C,I+=B*V,I+=M*k,I+=S*Q,I+=x*H,I+=u*c,C=I>>>13,I&=8191,I+=g*F,I+=p*z,I+=b*$,I+=v*(5*Z),I+=U*(5*G),C+=I>>>13,I&=8191,T=C,T+=B*G,T+=M*V,T+=S*k,T+=x*Q,T+=u*H,C=T>>>13,T&=8191,T+=g*c,T+=p*F,T+=b*z,T+=v*$,T+=U*(5*Z),C+=T>>>13,T&=8191,E=C,E+=B*Z,E+=M*G,E+=S*V,E+=x*k,E+=u*Q,C=E>>>13,E&=8191,E+=g*H,E+=p*c,E+=b*F,E+=v*z,E+=U*$,C+=E>>>13,E&=8191,C=(C<<2)+C|0,C=C+N|0,N=C&8191,C=C>>>13,O+=C,B=N,M=O,S=R,x=D,u=P,g=q,p=j,b=I,v=T,U=E,r+=16,n-=16;this.h[0]=B,this.h[1]=M,this.h[2]=S,this.h[3]=x,this.h[4]=u,this.h[5]=g,this.h[6]=p,this.h[7]=b,this.h[8]=v,this.h[9]=U},Ve.prototype.finish=function(t,r){var n=new Uint16Array(10),e,o,l,d;if(this.leftover){for(d=this.leftover,this.buffer[d++]=1;d<16;d++)this.buffer[d]=0;this.fin=1,this.blocks(this.buffer,0,16)}for(e=this.h[1]>>>13,this.h[1]&=8191,d=2;d<10;d++)this.h[d]+=e,e=this.h[d]>>>13,this.h[d]&=8191;for(this.h[0]+=e*5,e=this.h[0]>>>13,this.h[0]&=8191,this.h[1]+=e,e=this.h[1]>>>13,this.h[1]&=8191,this.h[2]+=e,n[0]=this.h[0]+5,e=n[0]>>>13,n[0]&=8191,d=1;d<10;d++)n[d]=this.h[d]+e,e=n[d]>>>13,n[d]&=8191;for(n[9]-=8192,o=(e^1)-1,d=0;d<10;d++)n[d]&=o;for(o=~o,d=0;d<10;d++)this.h[d]=this.h[d]&o|n[d];for(this.h[0]=(this.h[0]|this.h[1]<<13)&65535,this.h[1]=(this.h[1]>>>3|this.h[2]<<10)&65535,this.h[2]=(this.h[2]>>>6|this.h[3]<<7)&65535,this.h[3]=(this.h[3]>>>9|this.h[4]<<4)&65535,this.h[4]=(this.h[4]>>>12|this.h[5]<<1|this.h[6]<<14)&65535,this.h[5]=(this.h[6]>>>2|this.h[7]<<11)&65535,this.h[6]=(this.h[7]>>>5|this.h[8]<<8)&65535,this.h[7]=(this.h[8]>>>8|this.h[9]<<5)&65535,l=this.h[0]+this.pad[0],this.h[0]=l&65535,d=1;d<8;d++)l=(this.h[d]+this.pad[d]|0)+(l>>>16)|0,this.h[d]=l&65535;t[r+0]=this.h[0]>>>0&255,t[r+1]=this.h[0]>>>8&255,t[r+2]=this.h[1]>>>0&255,t[r+3]=this.h[1]>>>8&255,t[r+4]=this.h[2]>>>0&255,t[r+5]=this.h[2]>>>8&255,t[r+6]=this.h[3]>>>0&255,t[r+7]=this.h[3]>>>8&255,t[r+8]=this.h[4]>>>0&255,t[r+9]=this.h[4]>>>8&255,t[r+10]=this.h[5]>>>0&255,t[r+11]=this.h[5]>>>8&255,t[r+12]=this.h[6]>>>0&255,t[r+13]=this.h[6]>>>8&255,t[r+14]=this.h[7]>>>0&255,t[r+15]=this.h[7]>>>8&255},Ve.prototype.update=function(t,r,n){var e,o;if(this.leftover){for(o=16-this.leftover,o>n&&(o=n),e=0;e<o;e++)this.buffer[this.leftover+e]=t[r+e];if(n-=o,r+=o,this.leftover+=o,this.leftover<16)return;this.blocks(this.buffer,0,16),this.leftover=0}if(n>=16&&(o=n-n%16,this.blocks(t,r,o),r+=o,n-=o),n){for(e=0;e<n;e++)this.buffer[this.leftover+e]=t[r+e];this.leftover+=n}};function xt(t,r,n,e,o,l){var d=new Ve(l);return d.update(n,e,o),d.finish(t,r),0}function Yt(t,r,n,e,o,l){var d=new Uint8Array(16);return xt(d,0,n,e,o,l),ce(t,r,d,0)}function ut(t,r,n,e,o){var l;if(n<32)return-1;for(dt(t,0,r,0,n,e,o),xt(t,16,t,32,n-32,t),l=0;l<16;l++)t[l]=0;return 0}function ht(t,r,n,e,o){var l,d=new Uint8Array(32);if(n<32||(qt(d,0,32,e,o),Yt(r,16,r,32,n-32,d)!==0))return-1;for(dt(t,0,r,0,n,e,o),l=0;l<32;l++)t[l]=0;return 0}function Ae(t,r){var n;for(n=0;n<16;n++)t[n]=r[n]|0}function pt(t){var r,n,e=1;for(r=0;r<16;r++)n=t[r]+e+65535,e=Math.floor(n/65536),t[r]=n-e*65536;t[0]+=e-1+37*(e-1)}function Le(t,r,n){for(var e,o=~(n-1),l=0;l<16;l++)e=o&(t[l]^r[l]),t[l]^=e,r[l]^=e}function Ue(t,r){var n,e,o,l=a(),d=a();for(n=0;n<16;n++)d[n]=r[n];for(pt(d),pt(d),pt(d),e=0;e<2;e++){for(l[0]=d[0]-65517,n=1;n<15;n++)l[n]=d[n]-65535-(l[n-1]>>16&1),l[n-1]&=65535;l[15]=d[15]-32767-(l[14]>>16&1),o=l[15]>>16&1,l[14]&=65535,Le(d,l,1-o)}for(n=0;n<16;n++)t[2*n]=d[n]&255,t[2*n+1]=d[n]>>8}function Dt(t,r){var n=new Uint8Array(32),e=new Uint8Array(32);return Ue(n,t),Ue(e,r),he(n,0,e,0)}function Rt(t){var r=new Uint8Array(32);return Ue(r,t),r[0]&1}function yt(t,r){var n;for(n=0;n<16;n++)t[n]=r[2*n]+(r[2*n+1]<<8);t[15]&=32767}function me(t,r,n){for(var e=0;e<16;e++)t[e]=r[e]+n[e]}function Se(t,r,n){for(var e=0;e<16;e++)t[e]=r[e]-n[e]}function J(t,r,n){var e,o,l=0,d=0,y=0,w=0,K=0,A=0,X=0,C=0,N=0,O=0,R=0,D=0,P=0,q=0,j=0,I=0,T=0,E=0,B=0,M=0,S=0,x=0,u=0,g=0,p=0,b=0,v=0,U=0,$=0,z=0,F=0,c=n[0],H=n[1],Q=n[2],k=n[3],V=n[4],G=n[5],Z=n[6],de=n[7],te=n[8],se=n[9],ie=n[10],le=n[11],xe=n[12],pe=n[13],ye=n[14],be=n[15];e=r[0],l+=e*c,d+=e*H,y+=e*Q,w+=e*k,K+=e*V,A+=e*G,X+=e*Z,C+=e*de,N+=e*te,O+=e*se,R+=e*ie,D+=e*le,P+=e*xe,q+=e*pe,j+=e*ye,I+=e*be,e=r[1],d+=e*c,y+=e*H,w+=e*Q,K+=e*k,A+=e*V,X+=e*G,C+=e*Z,N+=e*de,O+=e*te,R+=e*se,D+=e*ie,P+=e*le,q+=e*xe,j+=e*pe,I+=e*ye,T+=e*be,e=r[2],y+=e*c,w+=e*H,K+=e*Q,A+=e*k,X+=e*V,C+=e*G,N+=e*Z,O+=e*de,R+=e*te,D+=e*se,P+=e*ie,q+=e*le,j+=e*xe,I+=e*pe,T+=e*ye,E+=e*be,e=r[3],w+=e*c,K+=e*H,A+=e*Q,X+=e*k,C+=e*V,N+=e*G,O+=e*Z,R+=e*de,D+=e*te,P+=e*se,q+=e*ie,j+=e*le,I+=e*xe,T+=e*pe,E+=e*ye,B+=e*be,e=r[4],K+=e*c,A+=e*H,X+=e*Q,C+=e*k,N+=e*V,O+=e*G,R+=e*Z,D+=e*de,P+=e*te,q+=e*se,j+=e*ie,I+=e*le,T+=e*xe,E+=e*pe,B+=e*ye,M+=e*be,e=r[5],A+=e*c,X+=e*H,C+=e*Q,N+=e*k,O+=e*V,R+=e*G,D+=e*Z,P+=e*de,q+=e*te,j+=e*se,I+=e*ie,T+=e*le,E+=e*xe,B+=e*pe,M+=e*ye,S+=e*be,e=r[6],X+=e*c,C+=e*H,N+=e*Q,O+=e*k,R+=e*V,D+=e*G,P+=e*Z,q+=e*de,j+=e*te,I+=e*se,T+=e*ie,E+=e*le,B+=e*xe,M+=e*pe,S+=e*ye,x+=e*be,e=r[7],C+=e*c,N+=e*H,O+=e*Q,R+=e*k,D+=e*V,P+=e*G,q+=e*Z,j+=e*de,I+=e*te,T+=e*se,E+=e*ie,B+=e*le,M+=e*xe,S+=e*pe,x+=e*ye,u+=e*be,e=r[8],N+=e*c,O+=e*H,R+=e*Q,D+=e*k,P+=e*V,q+=e*G,j+=e*Z,I+=e*de,T+=e*te,E+=e*se,B+=e*ie,M+=e*le,S+=e*xe,x+=e*pe,u+=e*ye,g+=e*be,e=r[9],O+=e*c,R+=e*H,D+=e*Q,P+=e*k,q+=e*V,j+=e*G,I+=e*Z,T+=e*de,E+=e*te,B+=e*se,M+=e*ie,S+=e*le,x+=e*xe,u+=e*pe,g+=e*ye,p+=e*be,e=r[10],R+=e*c,D+=e*H,P+=e*Q,q+=e*k,j+=e*V,I+=e*G,T+=e*Z,E+=e*de,B+=e*te,M+=e*se,S+=e*ie,x+=e*le,u+=e*xe,g+=e*pe,p+=e*ye,b+=e*be,e=r[11],D+=e*c,P+=e*H,q+=e*Q,j+=e*k,I+=e*V,T+=e*G,E+=e*Z,B+=e*de,M+=e*te,S+=e*se,x+=e*ie,u+=e*le,g+=e*xe,p+=e*pe,b+=e*ye,v+=e*be,e=r[12],P+=e*c,q+=e*H,j+=e*Q,I+=e*k,T+=e*V,E+=e*G,B+=e*Z,M+=e*de,S+=e*te,x+=e*se,u+=e*ie,g+=e*le,p+=e*xe,b+=e*pe,v+=e*ye,U+=e*be,e=r[13],q+=e*c,j+=e*H,I+=e*Q,T+=e*k,E+=e*V,B+=e*G,M+=e*Z,S+=e*de,x+=e*te,u+=e*se,g+=e*ie,p+=e*le,b+=e*xe,v+=e*pe,U+=e*ye,$+=e*be,e=r[14],j+=e*c,I+=e*H,T+=e*Q,E+=e*k,B+=e*V,M+=e*G,S+=e*Z,x+=e*de,u+=e*te,g+=e*se,p+=e*ie,b+=e*le,v+=e*xe,U+=e*pe,$+=e*ye,z+=e*be,e=r[15],I+=e*c,T+=e*H,E+=e*Q,B+=e*k,M+=e*V,S+=e*G,x+=e*Z,u+=e*de,g+=e*te,p+=e*se,b+=e*ie,v+=e*le,U+=e*xe,$+=e*pe,z+=e*ye,F+=e*be,l+=38*T,d+=38*E,y+=38*B,w+=38*M,K+=38*S,A+=38*x,X+=38*u,C+=38*g,N+=38*p,O+=38*b,R+=38*v,D+=38*U,P+=38*$,q+=38*z,j+=38*F,o=1,e=l+o+65535,o=Math.floor(e/65536),l=e-o*65536,e=d+o+65535,o=Math.floor(e/65536),d=e-o*65536,e=y+o+65535,o=Math.floor(e/65536),y=e-o*65536,e=w+o+65535,o=Math.floor(e/65536),w=e-o*65536,e=K+o+65535,o=Math.floor(e/65536),K=e-o*65536,e=A+o+65535,o=Math.floor(e/65536),A=e-o*65536,e=X+o+65535,o=Math.floor(e/65536),X=e-o*65536,e=C+o+65535,o=Math.floor(e/65536),C=e-o*65536,e=N+o+65535,o=Math.floor(e/65536),N=e-o*65536,e=O+o+65535,o=Math.floor(e/65536),O=e-o*65536,e=R+o+65535,o=Math.floor(e/65536),R=e-o*65536,e=D+o+65535,o=Math.floor(e/65536),D=e-o*65536,e=P+o+65535,o=Math.floor(e/65536),P=e-o*65536,e=q+o+65535,o=Math.floor(e/65536),q=e-o*65536,e=j+o+65535,o=Math.floor(e/65536),j=e-o*65536,e=I+o+65535,o=Math.floor(e/65536),I=e-o*65536,l+=o-1+37*(o-1),o=1,e=l+o+65535,o=Math.floor(e/65536),l=e-o*65536,e=d+o+65535,o=Math.floor(e/65536),d=e-o*65536,e=y+o+65535,o=Math.floor(e/65536),y=e-o*65536,e=w+o+65535,o=Math.floor(e/65536),w=e-o*65536,e=K+o+65535,o=Math.floor(e/65536),K=e-o*65536,e=A+o+65535,o=Math.floor(e/65536),A=e-o*65536,e=X+o+65535,o=Math.floor(e/65536),X=e-o*65536,e=C+o+65535,o=Math.floor(e/65536),C=e-o*65536,e=N+o+65535,o=Math.floor(e/65536),N=e-o*65536,e=O+o+65535,o=Math.floor(e/65536),O=e-o*65536,e=R+o+65535,o=Math.floor(e/65536),R=e-o*65536,e=D+o+65535,o=Math.floor(e/65536),D=e-o*65536,e=P+o+65535,o=Math.floor(e/65536),P=e-o*65536,e=q+o+65535,o=Math.floor(e/65536),q=e-o*65536,e=j+o+65535,o=Math.floor(e/65536),j=e-o*65536,e=I+o+65535,o=Math.floor(e/65536),I=e-o*65536,l+=o-1+37*(o-1),t[0]=l,t[1]=d,t[2]=y,t[3]=w,t[4]=K,t[5]=A,t[6]=X,t[7]=C,t[8]=N,t[9]=O,t[10]=R,t[11]=D,t[12]=P,t[13]=q,t[14]=j,t[15]=I}function we(t,r){J(t,r,r)}function $t(t,r){var n=a(),e;for(e=0;e<16;e++)n[e]=r[e];for(e=253;e>=0;e--)we(n,n),e!==2&&e!==4&&J(n,n,r);for(e=0;e<16;e++)t[e]=n[e]}function Ft(t,r){var n=a(),e;for(e=0;e<16;e++)n[e]=r[e];for(e=250;e>=0;e--)we(n,n),e!==1&&J(n,n,r);for(e=0;e<16;e++)t[e]=n[e]}function He(t,r,n){var e=new Uint8Array(32),o=new Float64Array(80),l,d,y=a(),w=a(),K=a(),A=a(),X=a(),C=a();for(d=0;d<31;d++)e[d]=r[d];for(e[31]=r[31]&127|64,e[0]&=248,yt(o,n),d=0;d<16;d++)w[d]=o[d],A[d]=y[d]=K[d]=0;for(y[0]=A[0]=1,d=254;d>=0;--d)l=e[d>>>3]>>>(d&7)&1,Le(y,w,l),Le(K,A,l),me(X,y,K),Se(y,y,K),me(K,w,A),Se(w,w,A),we(A,X),we(C,y),J(y,K,y),J(K,w,X),me(X,y,K),Se(y,y,K),we(w,y),Se(K,A,C),J(y,K,L),me(y,y,A),J(K,K,y),J(y,A,C),J(A,w,o),we(w,X),Le(y,w,l),Le(K,A,l);for(d=0;d<16;d++)o[d+16]=y[d],o[d+32]=K[d],o[d+48]=w[d],o[d+64]=A[d];var N=o.subarray(32),O=o.subarray(16);return $t(N,N),J(O,O,N),Ue(t,O),0}function Je(t,r){return He(t,r,m)}function zt(t,r){return s(r,32),Je(t,r)}function Ge(t,r,n){var e=new Uint8Array(32);return He(e,n,r),Ie(t,h,e,Be)}var Vt=ut,xn=ht;function un(t,r,n,e,o,l){var d=new Uint8Array(32);return Ge(d,o,l),Vt(t,r,n,e,d)}function hn(t,r,n,e,o,l){var d=new Uint8Array(32);return Ge(d,o,l),xn(t,r,n,e,d)}var Ht=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function Jt(t,r,n,e){for(var o=new Int32Array(16),l=new Int32Array(16),d,y,w,K,A,X,C,N,O,R,D,P,q,j,I,T,E,B,M,S,x,u,g,p,b,v,U=t[0],$=t[1],z=t[2],F=t[3],c=t[4],H=t[5],Q=t[6],k=t[7],V=r[0],G=r[1],Z=r[2],de=r[3],te=r[4],se=r[5],ie=r[6],le=r[7],xe=0;e>=128;){for(M=0;M<16;M++)S=8*M+xe,o[M]=n[S+0]<<24|n[S+1]<<16|n[S+2]<<8|n[S+3],l[M]=n[S+4]<<24|n[S+5]<<16|n[S+6]<<8|n[S+7];for(M=0;M<80;M++)if(d=U,y=$,w=z,K=F,A=c,X=H,C=Q,N=k,O=V,R=G,D=Z,P=de,q=te,j=se,I=ie,T=le,x=k,u=le,g=u&65535,p=u>>>16,b=x&65535,v=x>>>16,x=(c>>>14|te<<18)^(c>>>18|te<<14)^(te>>>9|c<<23),u=(te>>>14|c<<18)^(te>>>18|c<<14)^(c>>>9|te<<23),g+=u&65535,p+=u>>>16,b+=x&65535,v+=x>>>16,x=c&H^~c&Q,u=te&se^~te&ie,g+=u&65535,p+=u>>>16,b+=x&65535,v+=x>>>16,x=Ht[M*2],u=Ht[M*2+1],g+=u&65535,p+=u>>>16,b+=x&65535,v+=x>>>16,x=o[M%16],u=l[M%16],g+=u&65535,p+=u>>>16,b+=x&65535,v+=x>>>16,p+=g>>>16,b+=p>>>16,v+=b>>>16,E=b&65535|v<<16,B=g&65535|p<<16,x=E,u=B,g=u&65535,p=u>>>16,b=x&65535,v=x>>>16,x=(U>>>28|V<<4)^(V>>>2|U<<30)^(V>>>7|U<<25),u=(V>>>28|U<<4)^(U>>>2|V<<30)^(U>>>7|V<<25),g+=u&65535,p+=u>>>16,b+=x&65535,v+=x>>>16,x=U&$^U&z^$&z,u=V&G^V&Z^G&Z,g+=u&65535,p+=u>>>16,b+=x&65535,v+=x>>>16,p+=g>>>16,b+=p>>>16,v+=b>>>16,N=b&65535|v<<16,T=g&65535|p<<16,x=K,u=P,g=u&65535,p=u>>>16,b=x&65535,v=x>>>16,x=E,u=B,g+=u&65535,p+=u>>>16,b+=x&65535,v+=x>>>16,p+=g>>>16,b+=p>>>16,v+=b>>>16,K=b&65535|v<<16,P=g&65535|p<<16,$=d,z=y,F=w,c=K,H=A,Q=X,k=C,U=N,G=O,Z=R,de=D,te=P,se=q,ie=j,le=I,V=T,M%16===15)for(S=0;S<16;S++)x=o[S],u=l[S],g=u&65535,p=u>>>16,b=x&65535,v=x>>>16,x=o[(S+9)%16],u=l[(S+9)%16],g+=u&65535,p+=u>>>16,b+=x&65535,v+=x>>>16,E=o[(S+1)%16],B=l[(S+1)%16],x=(E>>>1|B<<31)^(E>>>8|B<<24)^E>>>7,u=(B>>>1|E<<31)^(B>>>8|E<<24)^(B>>>7|E<<25),g+=u&65535,p+=u>>>16,b+=x&65535,v+=x>>>16,E=o[(S+14)%16],B=l[(S+14)%16],x=(E>>>19|B<<13)^(B>>>29|E<<3)^E>>>6,u=(B>>>19|E<<13)^(E>>>29|B<<3)^(B>>>6|E<<26),g+=u&65535,p+=u>>>16,b+=x&65535,v+=x>>>16,p+=g>>>16,b+=p>>>16,v+=b>>>16,o[S]=b&65535|v<<16,l[S]=g&65535|p<<16;x=U,u=V,g=u&65535,p=u>>>16,b=x&65535,v=x>>>16,x=t[0],u=r[0],g+=u&65535,p+=u>>>16,b+=x&65535,v+=x>>>16,p+=g>>>16,b+=p>>>16,v+=b>>>16,t[0]=U=b&65535|v<<16,r[0]=V=g&65535|p<<16,x=$,u=G,g=u&65535,p=u>>>16,b=x&65535,v=x>>>16,x=t[1],u=r[1],g+=u&65535,p+=u>>>16,b+=x&65535,v+=x>>>16,p+=g>>>16,b+=p>>>16,v+=b>>>16,t[1]=$=b&65535|v<<16,r[1]=G=g&65535|p<<16,x=z,u=Z,g=u&65535,p=u>>>16,b=x&65535,v=x>>>16,x=t[2],u=r[2],g+=u&65535,p+=u>>>16,b+=x&65535,v+=x>>>16,p+=g>>>16,b+=p>>>16,v+=b>>>16,t[2]=z=b&65535|v<<16,r[2]=Z=g&65535|p<<16,x=F,u=de,g=u&65535,p=u>>>16,b=x&65535,v=x>>>16,x=t[3],u=r[3],g+=u&65535,p+=u>>>16,b+=x&65535,v+=x>>>16,p+=g>>>16,b+=p>>>16,v+=b>>>16,t[3]=F=b&65535|v<<16,r[3]=de=g&65535|p<<16,x=c,u=te,g=u&65535,p=u>>>16,b=x&65535,v=x>>>16,x=t[4],u=r[4],g+=u&65535,p+=u>>>16,b+=x&65535,v+=x>>>16,p+=g>>>16,b+=p>>>16,v+=b>>>16,t[4]=c=b&65535|v<<16,r[4]=te=g&65535|p<<16,x=H,u=se,g=u&65535,p=u>>>16,b=x&65535,v=x>>>16,x=t[5],u=r[5],g+=u&65535,p+=u>>>16,b+=x&65535,v+=x>>>16,p+=g>>>16,b+=p>>>16,v+=b>>>16,t[5]=H=b&65535|v<<16,r[5]=se=g&65535|p<<16,x=Q,u=ie,g=u&65535,p=u>>>16,b=x&65535,v=x>>>16,x=t[6],u=r[6],g+=u&65535,p+=u>>>16,b+=x&65535,v+=x>>>16,p+=g>>>16,b+=p>>>16,v+=b>>>16,t[6]=Q=b&65535|v<<16,r[6]=ie=g&65535|p<<16,x=k,u=le,g=u&65535,p=u>>>16,b=x&65535,v=x>>>16,x=t[7],u=r[7],g+=u&65535,p+=u>>>16,b+=x&65535,v+=x>>>16,p+=g>>>16,b+=p>>>16,v+=b>>>16,t[7]=k=b&65535|v<<16,r[7]=le=g&65535|p<<16,xe+=128,e-=128}return e}function Me(t,r,n){var e=new Int32Array(8),o=new Int32Array(8),l=new Uint8Array(256),d,y=n;for(e[0]=1779033703,e[1]=3144134277,e[2]=1013904242,e[3]=2773480762,e[4]=1359893119,e[5]=2600822924,e[6]=528734635,e[7]=1541459225,o[0]=4089235720,o[1]=2227873595,o[2]=4271175723,o[3]=1595750129,o[4]=2917565137,o[5]=725511199,o[6]=4215389547,o[7]=327033209,Jt(e,o,r,n),n%=128,d=0;d<n;d++)l[d]=r[y-n+d];for(l[n]=128,n=256-128*(n<112?1:0),l[n-9]=0,oe(l,n-8,y/536870912|0,y<<3),Jt(e,o,l,n),d=0;d<8;d++)oe(t,8*d,e[d],o[d]);return 0}function Ze(t,r){var n=a(),e=a(),o=a(),l=a(),d=a(),y=a(),w=a(),K=a(),A=a();Se(n,t[1],t[0]),Se(A,r[1],r[0]),J(n,n,A),me(e,t[0],t[1]),me(A,r[0],r[1]),J(e,e,A),J(o,t[3],r[3]),J(o,o,fe),J(l,t[2],r[2]),me(l,l,l),Se(d,e,n),Se(y,l,o),me(w,l,o),me(K,e,n),J(t[0],d,y),J(t[1],K,w),J(t[2],w,y),J(t[3],d,K)}function Gt(t,r,n){var e;for(e=0;e<4;e++)Le(t[e],r[e],n)}function bt(t,r){var n=a(),e=a(),o=a();$t(o,r[2]),J(n,r[0],o),J(e,r[1],o),Ue(t,e),t[31]^=Rt(n)<<7}function gt(t,r,n){var e,o;for(Ae(t[0],_),Ae(t[1],Y),Ae(t[2],Y),Ae(t[3],_),o=255;o>=0;--o)e=n[o/8|0]>>(o&7)&1,Gt(t,r,e),Ze(r,t),Ze(t,t),Gt(t,r,e)}function We(t,r){var n=[a(),a(),a(),a()];Ae(n[0],re),Ae(n[1],W),Ae(n[2],Y),J(n[3],re,W),gt(t,n,r)}function vt(t,r,n){var e=new Uint8Array(64),o=[a(),a(),a(),a()],l;for(n||s(r,32),Me(e,r,32),e[0]&=248,e[31]&=127,e[31]|=64,We(o,e),bt(t,o),l=0;l<32;l++)r[l+32]=t[l];return 0}var Xe=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function wt(t,r){var n,e,o,l;for(e=63;e>=32;--e){for(n=0,o=e-32,l=e-12;o<l;++o)r[o]+=n-16*r[e]*Xe[o-(e-32)],n=Math.floor((r[o]+128)/256),r[o]-=n*256;r[o]+=n,r[e]=0}for(n=0,o=0;o<32;o++)r[o]+=n-(r[31]>>4)*Xe[o],n=r[o]>>8,r[o]&=255;for(o=0;o<32;o++)r[o]-=n*Xe[o];for(e=0;e<32;e++)r[e+1]+=r[e]>>8,t[e]=r[e]&255}function mt(t){var r=new Float64Array(64),n;for(n=0;n<64;n++)r[n]=t[n];for(n=0;n<64;n++)t[n]=0;wt(t,r)}function Zt(t,r,n,e){var o=new Uint8Array(64),l=new Uint8Array(64),d=new Uint8Array(64),y,w,K=new Float64Array(64),A=[a(),a(),a(),a()];Me(o,e,32),o[0]&=248,o[31]&=127,o[31]|=64;var X=n+64;for(y=0;y<n;y++)t[64+y]=r[y];for(y=0;y<32;y++)t[32+y]=o[32+y];for(Me(d,t.subarray(32),n+32),mt(d),We(A,d),bt(t,A),y=32;y<64;y++)t[y]=e[y];for(Me(l,t,n+64),mt(l),y=0;y<64;y++)K[y]=0;for(y=0;y<32;y++)K[y]=d[y];for(y=0;y<32;y++)for(w=0;w<32;w++)K[y+w]+=l[y]*o[w];return wt(t.subarray(32),K),X}function pn(t,r){var n=a(),e=a(),o=a(),l=a(),d=a(),y=a(),w=a();return Ae(t[2],Y),yt(t[1],r),we(o,t[1]),J(l,o,ne),Se(o,o,t[2]),me(l,t[2],l),we(d,l),we(y,d),J(w,y,d),J(n,w,o),J(n,n,l),Ft(n,n),J(n,n,o),J(n,n,l),J(n,n,l),J(t[0],n,l),we(e,t[0]),J(e,e,l),Dt(e,o)&&J(t[0],t[0],ae),we(e,t[0]),J(e,e,l),Dt(e,o)?-1:(Rt(t[0])===r[31]>>7&&Se(t[0],_,t[0]),J(t[3],t[0],t[1]),0)}function St(t,r,n,e){var o,l=new Uint8Array(32),d=new Uint8Array(64),y=[a(),a(),a(),a()],w=[a(),a(),a(),a()];if(n<64||pn(w,e))return-1;for(o=0;o<n;o++)t[o]=r[o];for(o=0;o<32;o++)t[o+32]=e[o];if(Me(d,t,n),mt(d),gt(y,w,d),We(w,r.subarray(32)),Ze(y,w),bt(l,y),n-=64,he(r,0,l,0)){for(o=0;o<n;o++)t[o]=0;return-1}for(o=0;o<n;o++)t[o]=r[o+64];return n}var At=32,Qe=24,je=32,Ne=16,qe=32,ke=32,Ye=32,De=32,_t=32,Wt=Qe,yn=je,bn=Ne,_e=64,Ke=32,Oe=64,Et=32,Ct=64;f.lowlevel={crypto_core_hsalsa20:Ie,crypto_stream_xor:dt,crypto_stream:qt,crypto_stream_salsa20_xor:Pt,crypto_stream_salsa20:jt,crypto_onetimeauth:xt,crypto_onetimeauth_verify:Yt,crypto_verify_16:ce,crypto_verify_32:he,crypto_secretbox:ut,crypto_secretbox_open:ht,crypto_scalarmult:He,crypto_scalarmult_base:Je,crypto_box_beforenm:Ge,crypto_box_afternm:Vt,crypto_box:un,crypto_box_open:hn,crypto_box_keypair:zt,crypto_hash:Me,crypto_sign:Zt,crypto_sign_keypair:vt,crypto_sign_open:St,crypto_secretbox_KEYBYTES:At,crypto_secretbox_NONCEBYTES:Qe,crypto_secretbox_ZEROBYTES:je,crypto_secretbox_BOXZEROBYTES:Ne,crypto_scalarmult_BYTES:qe,crypto_scalarmult_SCALARBYTES:ke,crypto_box_PUBLICKEYBYTES:Ye,crypto_box_SECRETKEYBYTES:De,crypto_box_BEFORENMBYTES:_t,crypto_box_NONCEBYTES:Wt,crypto_box_ZEROBYTES:yn,crypto_box_BOXZEROBYTES:bn,crypto_sign_BYTES:_e,crypto_sign_PUBLICKEYBYTES:Ke,crypto_sign_SECRETKEYBYTES:Oe,crypto_sign_SEEDBYTES:Et,crypto_hash_BYTES:Ct,gf:a,D:ne,L:Xe,pack25519:Ue,unpack25519:yt,M:J,A:me,S:we,Z:Se,pow2523:Ft,add:Ze,set25519:Ae,modL:wt,scalarmult:gt,scalarbase:We};function Xt(t,r){if(t.length!==At)throw new Error("bad key size");if(r.length!==Qe)throw new Error("bad nonce size")}function gn(t,r){if(t.length!==Ye)throw new Error("bad public key size");if(r.length!==De)throw new Error("bad secret key size")}function ge(){for(var t=0;t<arguments.length;t++)if(!(arguments[t]instanceof Uint8Array))throw new TypeError("unexpected type, use Uint8Array")}function Qt(t){for(var r=0;r<t.length;r++)t[r]=0}f.randomBytes=function(t){var r=new Uint8Array(t);return s(r,t),r},f.secretbox=function(t,r,n){ge(t,r,n),Xt(n,r);for(var e=new Uint8Array(je+t.length),o=new Uint8Array(e.length),l=0;l<t.length;l++)e[l+je]=t[l];return ut(o,e,e.length,r,n),o.subarray(Ne)},f.secretbox.open=function(t,r,n){ge(t,r,n),Xt(n,r);for(var e=new Uint8Array(Ne+t.length),o=new Uint8Array(e.length),l=0;l<t.length;l++)e[l+Ne]=t[l];return e.length<32||ht(o,e,e.length,r,n)!==0?null:o.subarray(je)},f.secretbox.keyLength=At,f.secretbox.nonceLength=Qe,f.secretbox.overheadLength=Ne,f.scalarMult=function(t,r){if(ge(t,r),t.length!==ke)throw new Error("bad n size");if(r.length!==qe)throw new Error("bad p size");var n=new Uint8Array(qe);return He(n,t,r),n},f.scalarMult.base=function(t){if(ge(t),t.length!==ke)throw new Error("bad n size");var r=new Uint8Array(qe);return Je(r,t),r},f.scalarMult.scalarLength=ke,f.scalarMult.groupElementLength=qe,f.box=function(t,r,n,e){var o=f.box.before(n,e);return f.secretbox(t,r,o)},f.box.before=function(t,r){ge(t,r),gn(t,r);var n=new Uint8Array(_t);return Ge(n,t,r),n},f.box.after=f.secretbox,f.box.open=function(t,r,n,e){var o=f.box.before(n,e);return f.secretbox.open(t,r,o)},f.box.open.after=f.secretbox.open,f.box.keyPair=function(){var t=new Uint8Array(Ye),r=new Uint8Array(De);return zt(t,r),{publicKey:t,secretKey:r}},f.box.keyPair.fromSecretKey=function(t){if(ge(t),t.length!==De)throw new Error("bad secret key size");var r=new Uint8Array(Ye);return Je(r,t),{publicKey:r,secretKey:new Uint8Array(t)}},f.box.publicKeyLength=Ye,f.box.secretKeyLength=De,f.box.sharedKeyLength=_t,f.box.nonceLength=Wt,f.box.overheadLength=f.secretbox.overheadLength,f.sign=function(t,r){if(ge(t,r),r.length!==Oe)throw new Error("bad secret key size");var n=new Uint8Array(_e+t.length);return Zt(n,t,t.length,r),n},f.sign.open=function(t,r){if(ge(t,r),r.length!==Ke)throw new Error("bad public key size");var n=new Uint8Array(t.length),e=St(n,t,t.length,r);if(e<0)return null;for(var o=new Uint8Array(e),l=0;l<o.length;l++)o[l]=n[l];return o},f.sign.detached=function(t,r){for(var n=f.sign(t,r),e=new Uint8Array(_e),o=0;o<e.length;o++)e[o]=n[o];return e},f.sign.detached.verify=function(t,r,n){if(ge(t,r,n),r.length!==_e)throw new Error("bad signature size");if(n.length!==Ke)throw new Error("bad public key size");var e=new Uint8Array(_e+t.length),o=new Uint8Array(_e+t.length),l;for(l=0;l<_e;l++)e[l]=r[l];for(l=0;l<t.length;l++)e[l+_e]=t[l];return St(o,e,e.length,n)>=0},f.sign.keyPair=function(){var t=new Uint8Array(Ke),r=new Uint8Array(Oe);return vt(t,r),{publicKey:t,secretKey:r}},f.sign.keyPair.fromSecretKey=function(t){if(ge(t),t.length!==Oe)throw new Error("bad secret key size");for(var r=new Uint8Array(Ke),n=0;n<r.length;n++)r[n]=t[32+n];return{publicKey:r,secretKey:new Uint8Array(t)}},f.sign.keyPair.fromSeed=function(t){if(ge(t),t.length!==Et)throw new Error("bad seed size");for(var r=new Uint8Array(Ke),n=new Uint8Array(Oe),e=0;e<32;e++)n[e]=t[e];return vt(r,n,!0),{publicKey:r,secretKey:n}},f.sign.publicKeyLength=Ke,f.sign.secretKeyLength=Oe,f.sign.seedLength=Et,f.sign.signatureLength=_e,f.hash=function(t){ge(t);var r=new Uint8Array(Ct);return Me(r,t,t.length),r},f.hash.hashLength=Ct,f.verify=function(t,r){return ge(t,r),t.length===0||r.length===0||t.length!==r.length?!1:ee(t,0,r,0,t.length)===0},f.setPRNG=function(t){s=t},function(){var t=typeof self<"u"?self.crypto||self.msCrypto:null;if(t&&t.getRandomValues){var r=65536;f.setPRNG(function(n,e){var o,l=new Uint8Array(e);for(o=0;o<e;o+=r)t.getRandomValues(l.subarray(o,o+Math.min(e-o,r)));for(o=0;o<e;o++)n[o]=l[o];Qt(l)})}else typeof Sn<"u"&&(t=En,t&&t.randomBytes&&f.setPRNG(function(n,e){var o,l=t.randomBytes(e);for(o=0;o<e;o++)n[o]=l[o];Qt(l)}))}()})(i.exports?i.exports:self.nacl=self.nacl||{})})(fn);var Cn=fn.exports;const on=wn(Cn);var an={exports:{}};(function(i){(function(f,a){i.exports?i.exports=a():(f.nacl||(f.nacl={}),f.nacl.util=a())})(vn,function(){var f={};function a(s){if(!/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(s))throw new TypeError("invalid encoding")}return f.decodeUTF8=function(s){if(typeof s!="string")throw new TypeError("expected string");var h,m=unescape(encodeURIComponent(s)),_=new Uint8Array(m.length);for(h=0;h<m.length;h++)_[h]=m.charCodeAt(h);return _},f.encodeUTF8=function(s){var h,m=[];for(h=0;h<s.length;h++)m.push(String.fromCharCode(s[h]));return decodeURIComponent(escape(m.join("")))},typeof atob>"u"?typeof Buffer.from<"u"?(f.encodeBase64=function(s){return Buffer.from(s).toString("base64")},f.decodeBase64=function(s){return a(s),new Uint8Array(Array.prototype.slice.call(Buffer.from(s,"base64"),0))}):(f.encodeBase64=function(s){return new Buffer(s).toString("base64")},f.decodeBase64=function(s){return a(s),new Uint8Array(Array.prototype.slice.call(new Buffer(s,"base64"),0))}):(f.encodeBase64=function(s){var h,m=[],_=s.length;for(h=0;h<_;h++)m.push(String.fromCharCode(s[h]));return btoa(m.join(""))},f.decodeBase64=function(s){a(s);var h,m=atob(s),_=new Uint8Array(m.length);for(h=0;h<m.length;h++)_[h]=m.charCodeAt(h);return _}),f})})(an);var cn=an.exports;const Mt="meshlang_actors",Re="meshlang_active_actor",kt="meshlang_keys",et="meshlang_active_key";function Fe(){const i=localStorage.getItem(Mt);if(i)try{const a=JSON.parse(i);return{actors:a.actors||a.keys||[]}}catch{return{actors:[]}}const f=localStorage.getItem(kt);if(f)try{const s={actors:JSON.parse(f).keys||[]};localStorage.setItem(Mt,JSON.stringify(s)),localStorage.removeItem(kt);const h=localStorage.getItem(et);return h&&(localStorage.setItem(Re,h),localStorage.removeItem(et)),s}catch{return{actors:[]}}return{actors:[]}}function Lt(i){localStorage.setItem(Mt,JSON.stringify(i))}function Ut(){const i=localStorage.getItem(Re);if(i)return i;const f=localStorage.getItem(et);return f?(localStorage.setItem(Re,f),localStorage.removeItem(et),f):null}function tt(i){localStorage.setItem(Re,i)}function sn(){return Fe().actors}function Nt(i){return Fe().actors.find(a=>a.id===i)||null}function ln(i,f,a){const s=Fe(),h=s.actors.findIndex(_=>_.id===i),m={id:i,name:f,publicKey:Array.from(a.publicKey),secretKey:Array.from(a.secretKey),createdAt:Date.now()};h>=0?s.actors[h]=m:s.actors.push(m),Lt(s)}function In(i){const f=Fe();f.actors=f.actors.filter(a=>a.id!==i),Lt(f),Ut()===i&&localStorage.removeItem(Re)}function Bn(i,f){const a=Fe(),s=a.actors.find(h=>h.id===i);s&&(s.name=f,Lt(a))}function Kt(i){return{publicKey:new Uint8Array(i.publicKey),secretKey:new Uint8Array(i.secretKey)}}function Mn(){const{publicKey:i,secretKey:f}=on.sign.keyPair();return{publicKey:i,secretKey:f}}function Ot(i){const f=on.hash(i);return cn.encodeBase64(f.slice(0,16)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function $e(i){return{keyPair:i,nodeId:Ot(i.publicKey),publicKeyBase64:cn.encodeBase64(i.publicKey)}}function dn(i){const f=Mn(),a=Ot(f.publicKey),s=i||`Actor ${new Date().toLocaleString()}`;return ln(a,s,f),tt(a),$e(f)}function Kn(i){const f=Nt(i);return f?(tt(i),$e(Kt(f))):null}function Tn(){const i=sn(),f=Ut();if(f){const a=Nt(f);if(a)return $e(Kt(a))}return i.length>0?(tt(i[0].id),$e(Kt(i[0]))):dn("Default Actor")}function Te(){return sn()}function nt(){return Ut()}function Ln(i){try{const f=JSON.parse(atob(i));if(!f.publicKey||!f.secretKey)return null;const a={publicKey:new Uint8Array(f.publicKey),secretKey:new Uint8Array(f.secretKey)},s=Ot(a.publicKey),h=f.name||`Imported ${new Date().toLocaleString()}`;return ln(s,h,a),tt(s),$e(a)}catch{return null}}function Un(i){const f=Nt(i);if(!f)return null;const a={name:f.name,publicKey:f.publicKey,secretKey:f.secretKey};return btoa(JSON.stringify(a))}class Nn{facts=new Map;byScope=new Map;byKey=new Map;byValue=new Map;listeners=new Set;valueKey(f){return JSON.stringify(f)}factId(f,a){return`${a}:${f[0]}:${this.valueKey(f[1])}`}add(f,a,s){const h=s??a,m=this.factId(f,h);if(this.facts.has(m))return null;const _={id:m,fact:f,scope:h,timestamp:Date.now(),source:a};this.facts.set(m,_),this.byScope.has(h)||this.byScope.set(h,new Set),this.byScope.get(h).add(m),this.byKey.has(f[0])||this.byKey.set(f[0],new Set),this.byKey.get(f[0]).add(m);const Y=this.valueKey(f[1]);this.byValue.has(Y)||this.byValue.set(Y,new Set),this.byValue.get(Y).add(m);for(const L of this.listeners)L(_);return _}get(f){return this.facts.get(f)}has(f,a){return this.facts.has(this.factId(f,a))}retract(f,a){const s=this.factId(f,a);if(!this.facts.get(s))return!1;this.facts.delete(s);const m=this.byScope.get(a);m&&(m.delete(s),m.size===0&&this.byScope.delete(a));const _=this.byKey.get(f[0]);_&&(_.delete(s),_.size===0&&this.byKey.delete(f[0]));const Y=this.valueKey(f[1]),L=this.byValue.get(Y);return L&&(L.delete(s),L.size===0&&this.byValue.delete(Y)),!0}all(){return Array.from(this.facts.values())}allIds(){return new Set(this.facts.keys())}findByScope(f){const a=this.byScope.get(f);return a?Array.from(a).map(s=>this.facts.get(s)):[]}findByKey(f){const a=this.byKey.get(f);return a?Array.from(a).map(s=>this.facts.get(s)):[]}findByValue(f){const a=this.byValue.get(this.valueKey(f));return a?Array.from(a).map(s=>this.facts.get(s)):[]}onAdd(f){return this.listeners.add(f),()=>this.listeners.delete(f)}addStored(f){if(this.facts.has(f.id))return!1;this.facts.set(f.id,f);const a=f.fact,s=f.scope;this.byScope.has(s)||this.byScope.set(s,new Set),this.byScope.get(s).add(f.id),this.byKey.has(a[0])||this.byKey.set(a[0],new Set),this.byKey.get(a[0]).add(f.id);const h=this.valueKey(a[1]);this.byValue.has(h)||this.byValue.set(h,new Set),this.byValue.get(h).add(f.id);for(const m of this.listeners)m(f);return!0}}function en(i){return{id:i.id,k:i.fact[0],v:i.fact[1],sc:i.scope,t:i.timestamp,s:i.source}}function tn(i){if("e"in i&&"a"in i){const a=i;return{id:a.id,fact:[a.a,a.v],scope:a.e,timestamp:a.t,source:a.s}}const f=i;return{id:f.id,fact:[f.k,f.v],scope:f.sc,timestamp:f.t,source:f.s}}function On(i){return JSON.stringify(i)}function Pn(i){return JSON.parse(i)}class nn{constructor(f,a={iceServers:[{urls:"stun:stun.l.google.com:19302"}]}){this.isInitiator=f,this.config=a,this.connection=new RTCPeerConnection(this.config),this.connection.oniceconnectionstatechange=()=>{console.log("[Peer] ICE connection state:",this.connection.iceConnectionState),(this.connection.iceConnectionState==="disconnected"||this.connection.iceConnectionState==="failed")&&this.setState("disconnected")},this.connection.onconnectionstatechange=()=>{console.log("[Peer] Connection state:",this.connection.connectionState)},this.connection.onsignalingstatechange=()=>{console.log("[Peer] Signaling state:",this.connection.signalingState)},f?(this.channel=this.connection.createDataChannel("meshlang"),this.setupChannel(this.channel)):this.connection.ondatachannel=s=>{this.channel=s.channel,this.setupChannel(this.channel)}}connection;channel=null;state="connecting";messageHandlers=new Set;stateHandlers=new Set;pendingCandidates=[];remoteDescriptionSet=!1;remoteInfo=null;setupChannel(f){console.log("[Peer] Setting up data channel:",f.label),f.onopen=()=>{console.log("[Peer] Data channel opened"),this.setState("connected")},f.onclose=()=>{console.log("[Peer] Data channel closed"),this.setState("disconnected")},f.onerror=a=>{console.error("[Peer] Data channel error:",a)},f.onmessage=a=>{try{const s=Pn(a.data);console.log("[Peer] Received message:",s.type),s.type==="hello"&&(this.remoteInfo={nodeId:s.nodeId,publicKey:s.publicKey});for(const h of this.messageHandlers)h(s)}catch(s){console.error("Failed to decode message:",s)}}}setState(f){this.state=f;for(const a of this.stateHandlers)a(f)}getState(){return this.state}async createOffer(){console.log("[Peer] Creating offer");const f=await this.connection.createOffer();return await this.connection.setLocalDescription(f),console.log("[Peer] Offer created and local description set"),f}async acceptOffer(f){console.log("[Peer] Accepting offer"),await this.connection.setRemoteDescription(f),this.remoteDescriptionSet=!0,await this.flushPendingCandidates();const a=await this.connection.createAnswer();return await this.connection.setLocalDescription(a),console.log("[Peer] Answer created and local description set"),a}async acceptAnswer(f){console.log("[Peer] Accepting answer"),await this.connection.setRemoteDescription(f),this.remoteDescriptionSet=!0,await this.flushPendingCandidates(),console.log("[Peer] Answer accepted, remote description set")}async flushPendingCandidates(){for(const f of this.pendingCandidates)await this.connection.addIceCandidate(f);this.pendingCandidates=[]}async addIceCandidate(f){this.remoteDescriptionSet?await this.connection.addIceCandidate(f):this.pendingCandidates.push(f)}onIceCandidate(f){const a=this.connection.onicecandidate;this.connection.onicecandidate=s=>{s.candidate&&(console.log("[Peer] ICE candidate:",s.candidate.candidate?.substring(0,50)),f(s.candidate)),a&&a.call(this.connection,s)}}onIceGatheringComplete(f){const a=this.connection.onicecandidate;this.connection.onicecandidate=s=>{a&&a.call(this.connection,s),s.candidate||(console.log("[Peer] ICE gathering complete"),f())}}send(f){this.channel&&this.channel.readyState==="open"&&this.channel.send(On(f))}onMessage(f){return this.messageHandlers.add(f),()=>this.messageHandlers.delete(f)}onStateChange(f){return this.stateHandlers.add(f),()=>this.stateHandlers.delete(f)}close(){this.channel?.close(),this.connection.close(),this.setState("disconnected")}}class jn{constructor(f,a){this.identity=f,this.store=a,a.onAdd(s=>{const h={type:"fact-add",fact:en(s)};this.broadcast(h)})}peers=new Map;listeners=new Set;broadcast(f,a){for(const[s,h]of this.peers)s!==a&&h.getState()==="connected"&&h.send(f)}notifyListeners(){for(const f of this.listeners)f()}setupPeer(f){f.onStateChange(a=>{if(console.log("[Mesh] Peer state changed:",a,"remoteInfo:",f.remoteInfo?.nodeId),a==="connected"){console.log("[Mesh] Sending hello to peer"),f.send({type:"hello",nodeId:this.identity.nodeId,publicKey:this.identity.publicKeyBase64});const s=Array.from(this.store.allIds());console.log("[Mesh] Sending sync request with",s.length,"known facts"),f.send({type:"sync-request",haveIds:s}),this.notifyListeners()}a==="disconnected"&&f.remoteInfo&&(console.log("[Mesh] Peer disconnected:",f.remoteInfo.nodeId),this.peers.delete(f.remoteInfo.nodeId),this.notifyListeners())}),f.onMessage(a=>{console.log("[Mesh] Received message:",a.type),this.handleMessage(f,a)})}handleMessage(f,a){switch(a.type){case"hello":f.remoteInfo={nodeId:a.nodeId,publicKey:a.publicKey},this.peers.set(a.nodeId,f),this.notifyListeners();break;case"sync-request":{const s=new Set(a.haveIds),h=this.store.all().filter(m=>!s.has(m.id)).map(en);f.send({type:"sync-response",facts:h});break}case"sync-response":for(const s of a.facts){const h=tn(s);this.store.addStored(h)}break;case"fact-add":{const s=tn(a.fact);this.store.addStored(s)&&this.broadcast(a,f.remoteInfo?.nodeId);break}}}async createOffer(){console.log("[Mesh] Creating offer");const f=new nn(!0),a=[],s=new Promise(_=>{f.onIceCandidate(Y=>{a.push(Y)}),f.onIceGatheringComplete(()=>_())}),h=await f.createOffer();console.log("[Mesh] Waiting for ICE candidates..."),await s,console.log("[Mesh] Got",a.length,"ICE candidates");const m={type:"offer",nodeId:this.identity.nodeId,publicKey:this.identity.publicKeyBase64,sdp:h,candidates:a.map(_=>_.toJSON())};return this.peers.set("pending-offer",f),this.setupPeer(f),console.log("[Mesh] Offer created, waiting for answer"),btoa(JSON.stringify(m))}async acceptOffer(f){console.log("[Mesh] Accepting offer");const a=JSON.parse(atob(f));console.log("[Mesh] Offer from:",a.nodeId,"with",a.candidates.length,"candidates");const s=new nn(!1);s.remoteInfo={nodeId:a.nodeId,publicKey:a.publicKey};const h=[],m=new Promise(L=>{s.onIceCandidate(ne=>{h.push(ne)}),s.onIceGatheringComplete(()=>L())}),_=await s.acceptOffer(a.sdp);console.log("[Mesh] Adding",a.candidates.length,"remote ICE candidates");for(const L of a.candidates)await s.addIceCandidate(L);console.log("[Mesh] Waiting for local ICE candidates..."),await m,console.log("[Mesh] Got",h.length,"local ICE candidates"),this.peers.set(a.nodeId,s),this.setupPeer(s);const Y={type:"answer",nodeId:this.identity.nodeId,publicKey:this.identity.publicKeyBase64,sdp:_,candidates:h.map(L=>L.toJSON())};return console.log("[Mesh] Answer created"),btoa(JSON.stringify(Y))}async acceptAnswer(f){console.log("[Mesh] Accepting answer");const a=JSON.parse(atob(f));console.log("[Mesh] Answer from:",a.nodeId,"with",a.candidates.length,"candidates");const s=this.peers.get("pending-offer");if(!s)throw new Error("No pending offer to accept answer for");this.peers.delete("pending-offer"),s.remoteInfo={nodeId:a.nodeId,publicKey:a.publicKey},this.peers.set(a.nodeId,s),await s.acceptAnswer(a.sdp),console.log("[Mesh] Adding",a.candidates.length,"remote ICE candidates");for(const h of a.candidates)await s.addIceCandidate(h);console.log("[Mesh] Connection established")}getPeers(){const f=[];for(const a of this.peers.values())a.remoteInfo&&a.getState()==="connected"&&f.push(a.remoteInfo);return f}getPeerCount(){return this.getPeers().length}onChange(f){return this.listeners.add(f),()=>this.listeners.delete(f)}}class Pe{constructor(f){this.name=f}static isVar(f){return f instanceof Pe}}function It(i,f,a){if(Pe.isVar(i)){const s=a.get(i.name);if(s!==void 0)return s===f?a:null;const h=new Map(a);return h.set(i.name,f),h}return i===f?a:null}function qn(i,f,a,s){let h=a;return s!==void 0&&(h=It(s,f.scope,h),!h)||(h=It(i[0],f.fact[0],h),!h)?null:(h=It(i[1],f.fact[1],h),h)}function Yn(i,f,a){if(f.length===0)return[new Map];let s=[new Map];for(const h of f){const m=[];for(const _ of s){let Y;const[L,ne]=h;a?.scope?Y=i.findByScope(a.scope):!Pe.isVar(L)&&typeof L=="string"?Y=i.findByKey(L):Y=i.all(),a?.scope&&!Pe.isVar(L)&&(Y=Y.filter(fe=>fe.fact[0]===L));for(const fe of Y){const re=qn(h,fe,_,a?.scopePattern);re&&m.push(re)}}s=m}return s}function Bt(i){return new Pe(i)}function Dn(i){const f={};for(const[a,s]of i)f[`?${a}`]=s;return f}async function rn(i){await navigator.clipboard.writeText(i)}function Rn(i,f,a){i.innerHTML=`
    <div class="exchange">
      <h3>Connect to Peer</h3>
      <div class="exchange-tabs">
        <button class="tab active" data-tab="initiate">Create Invite</button>
        <button class="tab" data-tab="join">Join with Invite</button>
      </div>

      <div class="tab-content" id="initiate-tab">
        <p>1. Click "Generate" to create an invite code</p>
        <button id="generate-offer">Generate Invite</button>
        <textarea id="offer-output" readonly placeholder="Invite code will appear here..."></textarea>
        <button id="copy-offer" disabled>Copy to Clipboard</button>

        <p>2. Share the code with peer, then paste their response:</p>
        <textarea id="answer-input" placeholder="Paste peer's response here..."></textarea>
        <button id="accept-answer" disabled>Connect</button>
      </div>

      <div class="tab-content hidden" id="join-tab">
        <p>1. Paste the invite code from your peer:</p>
        <textarea id="offer-input" placeholder="Paste invite code here..."></textarea>
        <button id="accept-offer">Accept Invite</button>

        <p>2. Copy the response and send it back:</p>
        <textarea id="answer-output" readonly placeholder="Response will appear here..."></textarea>
        <button id="copy-answer" disabled>Copy to Clipboard</button>
      </div>
    </div>
  `;const s=i.querySelectorAll(".tab"),h=i.querySelector("#initiate-tab"),m=i.querySelector("#join-tab");s.forEach(ee=>{ee.addEventListener("click",()=>{s.forEach(he=>he.classList.remove("active")),ee.classList.add("active");const ce=ee.dataset.tab;h.classList.toggle("hidden",ce!=="initiate"),m.classList.toggle("hidden",ce!=="join")})});const _=i.querySelector("#generate-offer"),Y=i.querySelector("#offer-output"),L=i.querySelector("#copy-offer"),ne=i.querySelector("#answer-input"),fe=i.querySelector("#accept-answer");_.addEventListener("click",async()=>{_.disabled=!0,_.textContent="Generating...";try{const ee=await f.createOffer();Y.value=ee,L.disabled=!1,fe.disabled=!1}catch(ee){Y.value=`Error: ${ee}`}_.disabled=!1,_.textContent="Generate Invite"}),L.addEventListener("click",async()=>{await rn(Y.value),L.textContent="Copied!",setTimeout(()=>L.textContent="Copy to Clipboard",2e3)}),fe.addEventListener("click",async()=>{const ee=ne.value.trim();if(ee)try{await f.acceptAnswer(ee)}catch(ce){alert(`Failed to connect: ${ce}`)}});const re=i.querySelector("#offer-input"),W=i.querySelector("#accept-offer"),ae=i.querySelector("#answer-output"),oe=i.querySelector("#copy-answer");W.addEventListener("click",async()=>{const ee=re.value.trim();if(ee){W.disabled=!0,W.textContent="Processing...";try{const ce=await f.acceptOffer(ee);ae.value=ce,oe.disabled=!1}catch(ce){ae.value=`Error: ${ce}`}W.disabled=!1,W.textContent="Accept Invite"}}),oe.addEventListener("click",async()=>{await rn(ae.value),oe.textContent="Copied!",setTimeout(()=>oe.textContent="Copy to Clipboard",2e3)})}function $n(i){return typeof i=="string"?`"${i}"`:i===null?"null":String(i)}function Fn(i){const f=new Map;for(const a of i){const s=a.scope;f.has(s)||f.set(s,[]),f.get(s).push(a)}return f}function Tt(i){const f=i.trim();return f==="true"?!0:f==="false"?!1:f==="null"?null:/^-?\d+(\.\d+)?$/.test(f)?parseFloat(f):f.startsWith('"')&&f.endsWith('"')||f.startsWith("'")&&f.endsWith("'")?f.slice(1,-1):f}function zn(i,f){const a=document.createElement("div"),s=i.all();if(s.length===0)return a.innerHTML='<p class="empty-state">No facts yet. Add some below.</p>',a;const h=Fn(s),m=document.createElement("ul");m.className="fact-list";for(const[_,Y]of h){const L=document.createElement("li");L.className="tree-item";const ne=document.createElement("div");ne.className="tree-toggle";const fe=_===f?`${_} (current)`:_;ne.innerHTML=`<span class="scope"> ${fe}</span> <span style="color:#7f8c8d">(${Y.length})</span>`,ne.onclick=()=>L.classList.toggle("collapsed");const re=document.createElement("ul");re.className="tree-children fact-list";for(const W of Y){const ae=document.createElement("li");ae.className="fact-item";const oe=document.createElement("span");oe.className="key",oe.textContent=W.fact[0];const ee=document.createTextNode(": "),ce=document.createElement("span");ce.className="value editable",ce.textContent=$n(W.fact[1]),ce.title="Click to edit",ce.onclick=()=>{const he=document.createElement("input");he.type="text",he.className="fact-edit-input",he.value=typeof W.fact[1]=="string"?W.fact[1]:String(W.fact[1]);const ue=()=>{const Ee=Tt(he.value),Ce=W.fact,Ie=W.scope;i.retract(Ce,Ie),i.add([Ce[0],Ee],f,Ie)};he.onblur=ue,he.onkeydown=Ee=>{Ee.key==="Enter"?ue():Ee.key==="Escape"&&i.add(W.fact,f,W.scope)},ce.replaceWith(he),he.focus(),he.select()},ae.appendChild(oe),ae.appendChild(ee),ae.appendChild(ce),re.appendChild(ae)}L.appendChild(ne),L.appendChild(re),m.appendChild(L)}return a.appendChild(m),a}function Vn(i,f){const a=document.createElement("div");a.className="add-fact-form",a.innerHTML=`
    <input type="text" id="fact-key" placeholder="key" />
    <input type="text" id="fact-value" placeholder="value" />
    <button id="add-fact-btn">Add</button>
  `;const s=a.querySelector("#fact-key"),h=a.querySelector("#fact-value"),m=a.querySelector("#add-fact-btn"),_=()=>{const Y=s.value.trim();let L=h.value.trim();Y&&(L==="true"?L=!0:L==="false"?L=!1:L==="null"?L=null:/^-?\d+(\.\d+)?$/.test(L)&&(L=parseFloat(L)),i.add([Y,L],f),s.value="",h.value="",s.focus())};return m.onclick=_,[s,h].forEach(Y=>{Y.onkeydown=L=>{L.key==="Enter"&&_()}}),a}function Hn(i,f){const a=document.createElement("div");a.className="query-builder",a.innerHTML=`
    <div class="query-pattern">
      <div class="pattern-slot" data-slot="scope">
        <label>Scope</label>
        <div class="slot-options">
          <button class="slot-btn active" data-type="current">Current</button>
          <button class="slot-btn" data-type="any">Any (?s)</button>
          <button class="slot-btn" data-type="specific">Specific</button>
        </div>
        <input type="text" class="slot-input hidden" placeholder="scope" />
      </div>

      <div class="pattern-slot" data-slot="key">
        <label>Key</label>
        <div class="slot-options">
          <button class="slot-btn" data-type="any">Any (?k)</button>
          <button class="slot-btn active" data-type="specific">Specific</button>
        </div>
        <input type="text" class="slot-input" placeholder="key" />
      </div>

      <div class="pattern-slot" data-slot="value">
        <label>Value</label>
        <div class="slot-options">
          <button class="slot-btn active" data-type="any">Any (?v)</button>
          <button class="slot-btn" data-type="specific">Specific</button>
        </div>
        <input type="text" class="slot-input hidden" placeholder="value" />
      </div>
    </div>

    <div class="query-preview">
      <code class="pattern-text"></code>
    </div>

    <div class="query-results empty">Configure pattern above</div>
  `;const s=a.querySelectorAll(".pattern-slot"),h=a.querySelector(".pattern-text"),m=a.querySelector(".query-results"),_={scope:{type:"current",value:f},key:{type:"specific",value:""},value:{type:"any",value:""}};function Y(){const ne=_.scope.type==="current"?"current":_.scope.type==="any"?"?scope":_.scope.value||"?scope",fe=_.key.type==="any"?"?key":_.key.value||"?key",re=_.value.type==="any"?"?val":_.value.value||"?val";h.textContent=`(${fe}, ${re}) in ${ne}`}function L(){try{const ne=_.key.type==="any"?Bt("key"):Tt(_.key.value),fe=_.value.type==="any"?Bt("val"):Tt(_.value.value),re=[ne,fe],W=_.scope.type==="current"?{scope:f}:_.scope.type==="specific"&&_.scope.value?{scope:_.scope.value}:{scopePattern:Bt("scope")},ae=Yn(i,[re],W);ae.length===0?(m.className="query-results empty",m.textContent="No matches"):(m.className="query-results",m.innerHTML=ae.map(oe=>`<div class="result-row">${JSON.stringify(Dn(oe))}</div>`).join(""))}catch(ne){m.className="query-results empty",m.textContent=`Error: ${ne}`}}return s.forEach(ne=>{const fe=ne.dataset.slot,re=ne.querySelectorAll(".slot-btn"),W=ne.querySelector(".slot-input");re.forEach(ae=>{ae.addEventListener("click",()=>{const oe=ae.dataset.type;re.forEach(ee=>ee.classList.remove("active")),ae.classList.add("active"),_[fe].type=oe,oe==="specific"||fe==="scope"&&oe==="specific"?(W.classList.remove("hidden"),W.focus()):W.classList.add("hidden"),Y(),L()})}),W.addEventListener("input",()=>{_[fe].value=W.value,Y(),L()})}),Y(),L(),a}function Jn(i,f,a){const s=f.findByScope(i).find(h=>h.fact[0]==="name");return s?String(s.fact[1]):a}function Gn(i,f,a){const s=document.createElement("div");s.className="actor-switcher";const h=f.getActors();s.innerHTML=`
    <div class="actor-switcher-row">
      <select class="actor-select">
        ${h.map(ue=>`<option value="${ue.id}" ${ue.id===i?"selected":""}>${Jn(ue.id,a,ue.name)}</option>`).join("")}
      </select>
      <button class="actor-btn" title="New Actor">+</button>
      <button class="actor-btn" title="Import Actor">Import</button>
      <button class="actor-btn" title="Export Actor">Export</button>
      <button class="actor-btn actor-btn-danger" title="Delete Actor">Delete</button>
    </div>
    <div class="actor-import-row hidden">
      <input type="text" class="actor-import-input" placeholder="Paste actor data..." />
      <button class="actor-import-btn">Import</button>
      <button class="actor-import-cancel">Cancel</button>
    </div>
    <div class="actor-export-row hidden">
      <textarea class="actor-export-output" readonly></textarea>
      <button class="actor-export-copy">Copy</button>
      <button class="actor-export-close">Close</button>
    </div>
  `;const m=s.querySelector(".actor-select"),_=s.querySelectorAll(".actor-btn")[0],Y=s.querySelectorAll(".actor-btn")[1],L=s.querySelectorAll(".actor-btn")[2],ne=s.querySelectorAll(".actor-btn")[3],fe=s.querySelector(".actor-import-row"),re=s.querySelector(".actor-import-input"),W=s.querySelector(".actor-import-btn"),ae=s.querySelector(".actor-import-cancel"),oe=s.querySelector(".actor-export-row"),ee=s.querySelector(".actor-export-output"),ce=s.querySelector(".actor-export-copy"),he=s.querySelector(".actor-export-close");return m.onchange=()=>{f.onSwitchActor(m.value)},_.onclick=()=>{const ue=prompt("Enter a name for the new actor:",`Actor ${new Date().toLocaleString()}`);ue!==null&&f.onCreateActor(ue||void 0)},Y.onclick=()=>{fe.classList.remove("hidden"),re.focus()},ae.onclick=()=>{fe.classList.add("hidden"),re.value=""},W.onclick=()=>{const ue=re.value.trim();if(!ue)return;f.onImportActor(ue)?(fe.classList.add("hidden"),re.value=""):alert("Invalid actor data")},L.onclick=()=>{const ue=f.onExportActor(i);ue&&(ee.value=ue,oe.classList.remove("hidden"))},ce.onclick=async()=>{await navigator.clipboard.writeText(ee.value),ce.textContent="Copied!",setTimeout(()=>ce.textContent="Copy",2e3)},he.onclick=()=>{oe.classList.add("hidden"),ee.value=""},ne.onclick=()=>{if(h.length<=1){alert("Cannot delete the last actor");return}confirm("Are you sure you want to delete this actor?")&&f.onDeleteActor(i)},s}function rt(i,f,a){const{identity:s,store:h,mesh:m}=f;function _(){const Y=m.getPeerCount();i.innerHTML="";const L=document.createElement("div");L.className="header";const ne=document.createElement("div");ne.className="header-info",ne.innerHTML=`
      <div class="node-id">Node: ${s.nodeId}</div>
      <div class="peer-count ${Y>0?"connected":""}">
        ${Y} peer${Y!==1?"s":""} connected
      </div>
    `,L.appendChild(ne),L.appendChild(Gn(s.nodeId,a,h)),i.appendChild(L);const fe=document.createElement("div");fe.className="section",fe.innerHTML=`
      <div class="section-header">
        <h2>Facts</h2>
        <span>${h.all().length} total</span>
      </div>
    `;const re=document.createElement("div");re.className="section-content",re.appendChild(zn(h,s.nodeId)),re.appendChild(Vn(h,s.nodeId)),fe.appendChild(re),i.appendChild(fe);const W=document.createElement("div");W.className="section",W.innerHTML=`
      <div class="section-header">
        <h2>Query</h2>
      </div>
    `;const ae=document.createElement("div");ae.className="section-content",ae.appendChild(Hn(h,s.nodeId)),W.appendChild(ae),i.appendChild(W);const oe=document.createElement("div");oe.className="section",oe.innerHTML=`
      <div class="section-header">
        <h2>Connect</h2>
      </div>
    `;const ee=document.createElement("div");ee.className="section-content",Rn(ee,m),oe.appendChild(ee),i.appendChild(oe)}_(),h.onAdd(()=>_()),m.onChange(()=>_())}let ve=null;function ft(i){const f=new Nn,a=new jn(i,f);return{identity:i,store:f,mesh:a}}function ze(i){const f=Kn(i);if(!f)return!1;ve=ft(f),lt(f,ve.store),console.log("Switched to Node ID:",f.nodeId);const a=document.getElementById("app");return a&&rt(a,ve,{onSwitchActor:ze,onCreateActor:ot,onImportActor:at,onExportActor:ct,onDeleteActor:st,onRenameActor:it,getActors:Te,getCurrentActorId:nt}),!0}function ot(i){const f=dn(i);ve=ft(f),lt(f,ve.store);const a=document.getElementById("app");return a&&rt(a,ve,{onSwitchActor:ze,onCreateActor:ot,onImportActor:at,onExportActor:ct,onDeleteActor:st,onRenameActor:it,getActors:Te,getCurrentActorId:nt}),f}function at(i){const f=Ln(i);if(!f)return null;ve=ft(f),lt(f,ve.store);const a=document.getElementById("app");return a&&rt(a,ve,{onSwitchActor:ze,onCreateActor:ot,onImportActor:at,onExportActor:ct,onDeleteActor:st,onRenameActor:it,getActors:Te,getCurrentActorId:nt}),f}function ct(i){return Un(i)}function st(i){if(Te().length<=1)return alert("Cannot delete the last actor"),!1;if(In(i),ve?.identity.nodeId===i){const a=Te();a.length>0&&ze(a[0].id)}return!0}function it(i,f){Bn(i,f)}function lt(i,f){if(!f.findByScope(i.nodeId).find(s=>s.fact[0]==="name")){const h=Te().find(m=>m.id===i.nodeId)?.name||i.nodeId;f.add(["name",h],i.nodeId,i.nodeId)}}function Zn(){const i=Tn();console.log("Node ID:",i.nodeId),ve=ft(i),lt(i,ve.store),rt(document.getElementById("app"),ve,{onSwitchActor:ze,onCreateActor:ot,onImportActor:at,onExportActor:ct,onDeleteActor:st,onRenameActor:it,getActors:Te,getCurrentActorId:nt})}Zn();
