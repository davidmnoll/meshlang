(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))o(i);new MutationObserver(i=>{for(const d of i)if(d.type==="childList")for(const h of d.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&o(h)}).observe(document,{childList:!0,subtree:!0});function r(i){const d={};return i.integrity&&(d.integrity=i.integrity),i.referrerPolicy&&(d.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?d.credentials="include":i.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function o(i){if(i.ep)return;i.ep=!0;const d=r(i);fetch(i.href,d)}})();var Mn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Bn(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}function Pn(f){if(f.__esModule)return f;var t=f.default;if(typeof t=="function"){var r=function o(){return this instanceof o?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};r.prototype=t.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(f).forEach(function(o){var i=Object.getOwnPropertyDescriptor(f,o);Object.defineProperty(r,o,i.get?i:{enumerable:!0,get:function(){return f[o]}})}),r}function Un(f){throw new Error('Could not dynamically require "'+f+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var xn={exports:{}};const On={},Kn=Object.freeze(Object.defineProperty({__proto__:null,default:On},Symbol.toStringTag,{value:"Module"})),$n=Pn(Kn);(function(f){(function(t){var r=function(n){var a,s=new Float64Array(16);if(n)for(a=0;a<n.length;a++)s[a]=n[a];return s},o=function(){throw new Error("no PRNG")},i=new Uint8Array(16),d=new Uint8Array(32);d[0]=9;var h=r(),v=r([1]),S=r([56129,1]),M=r([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),A=r([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),B=r([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),_=r([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),I=r([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function D(n,a,s,e){n[a]=s>>24&255,n[a+1]=s>>16&255,n[a+2]=s>>8&255,n[a+3]=s&255,n[a+4]=e>>24&255,n[a+5]=e>>16&255,n[a+6]=e>>8&255,n[a+7]=e&255}function R(n,a,s,e,c){var u,p=0;for(u=0;u<c;u++)p|=n[a+u]^s[e+u];return(1&p-1>>>8)-1}function W(n,a,s,e){return R(n,a,s,e,16)}function ie(n,a,s,e){return R(n,a,s,e,32)}function fe(n,a,s,e){for(var c=e[0]&255|(e[1]&255)<<8|(e[2]&255)<<16|(e[3]&255)<<24,u=s[0]&255|(s[1]&255)<<8|(s[2]&255)<<16|(s[3]&255)<<24,p=s[4]&255|(s[5]&255)<<8|(s[6]&255)<<16|(s[7]&255)<<24,g=s[8]&255|(s[9]&255)<<8|(s[10]&255)<<16|(s[11]&255)<<24,E=s[12]&255|(s[13]&255)<<8|(s[14]&255)<<16|(s[15]&255)<<24,$=e[4]&255|(e[5]&255)<<8|(e[6]&255)<<16|(e[7]&255)<<24,L=a[0]&255|(a[1]&255)<<8|(a[2]&255)<<16|(a[3]&255)<<24,oe=a[4]&255|(a[5]&255)<<8|(a[6]&255)<<16|(a[7]&255)<<24,P=a[8]&255|(a[9]&255)<<8|(a[10]&255)<<16|(a[11]&255)<<24,k=a[12]&255|(a[13]&255)<<8|(a[14]&255)<<16|(a[15]&255)<<24,H=e[8]&255|(e[9]&255)<<8|(e[10]&255)<<16|(e[11]&255)<<24,z=s[16]&255|(s[17]&255)<<8|(s[18]&255)<<16|(s[19]&255)<<24,G=s[20]&255|(s[21]&255)<<8|(s[22]&255)<<16|(s[23]&255)<<24,Y=s[24]&255|(s[25]&255)<<8|(s[26]&255)<<16|(s[27]&255)<<24,F=s[28]&255|(s[29]&255)<<8|(s[30]&255)<<16|(s[31]&255)<<24,V=e[12]&255|(e[13]&255)<<8|(e[14]&255)<<16|(e[15]&255)<<24,U=c,j=u,T=p,O=g,K=E,N=$,x=L,y=oe,w=P,m=k,b=H,C=z,q=G,J=Y,Q=F,Z=V,l,ee=0;ee<20;ee+=2)l=U+q|0,K^=l<<7|l>>>25,l=K+U|0,w^=l<<9|l>>>23,l=w+K|0,q^=l<<13|l>>>19,l=q+w|0,U^=l<<18|l>>>14,l=N+j|0,m^=l<<7|l>>>25,l=m+N|0,J^=l<<9|l>>>23,l=J+m|0,j^=l<<13|l>>>19,l=j+J|0,N^=l<<18|l>>>14,l=b+x|0,Q^=l<<7|l>>>25,l=Q+b|0,T^=l<<9|l>>>23,l=T+Q|0,x^=l<<13|l>>>19,l=x+T|0,b^=l<<18|l>>>14,l=Z+C|0,O^=l<<7|l>>>25,l=O+Z|0,y^=l<<9|l>>>23,l=y+O|0,C^=l<<13|l>>>19,l=C+y|0,Z^=l<<18|l>>>14,l=U+O|0,j^=l<<7|l>>>25,l=j+U|0,T^=l<<9|l>>>23,l=T+j|0,O^=l<<13|l>>>19,l=O+T|0,U^=l<<18|l>>>14,l=N+K|0,x^=l<<7|l>>>25,l=x+N|0,y^=l<<9|l>>>23,l=y+x|0,K^=l<<13|l>>>19,l=K+y|0,N^=l<<18|l>>>14,l=b+m|0,C^=l<<7|l>>>25,l=C+b|0,w^=l<<9|l>>>23,l=w+C|0,m^=l<<13|l>>>19,l=m+w|0,b^=l<<18|l>>>14,l=Z+Q|0,q^=l<<7|l>>>25,l=q+Z|0,J^=l<<9|l>>>23,l=J+q|0,Q^=l<<13|l>>>19,l=Q+J|0,Z^=l<<18|l>>>14;U=U+c|0,j=j+u|0,T=T+p|0,O=O+g|0,K=K+E|0,N=N+$|0,x=x+L|0,y=y+oe|0,w=w+P|0,m=m+k|0,b=b+H|0,C=C+z|0,q=q+G|0,J=J+Y|0,Q=Q+F|0,Z=Z+V|0,n[0]=U>>>0&255,n[1]=U>>>8&255,n[2]=U>>>16&255,n[3]=U>>>24&255,n[4]=j>>>0&255,n[5]=j>>>8&255,n[6]=j>>>16&255,n[7]=j>>>24&255,n[8]=T>>>0&255,n[9]=T>>>8&255,n[10]=T>>>16&255,n[11]=T>>>24&255,n[12]=O>>>0&255,n[13]=O>>>8&255,n[14]=O>>>16&255,n[15]=O>>>24&255,n[16]=K>>>0&255,n[17]=K>>>8&255,n[18]=K>>>16&255,n[19]=K>>>24&255,n[20]=N>>>0&255,n[21]=N>>>8&255,n[22]=N>>>16&255,n[23]=N>>>24&255,n[24]=x>>>0&255,n[25]=x>>>8&255,n[26]=x>>>16&255,n[27]=x>>>24&255,n[28]=y>>>0&255,n[29]=y>>>8&255,n[30]=y>>>16&255,n[31]=y>>>24&255,n[32]=w>>>0&255,n[33]=w>>>8&255,n[34]=w>>>16&255,n[35]=w>>>24&255,n[36]=m>>>0&255,n[37]=m>>>8&255,n[38]=m>>>16&255,n[39]=m>>>24&255,n[40]=b>>>0&255,n[41]=b>>>8&255,n[42]=b>>>16&255,n[43]=b>>>24&255,n[44]=C>>>0&255,n[45]=C>>>8&255,n[46]=C>>>16&255,n[47]=C>>>24&255,n[48]=q>>>0&255,n[49]=q>>>8&255,n[50]=q>>>16&255,n[51]=q>>>24&255,n[52]=J>>>0&255,n[53]=J>>>8&255,n[54]=J>>>16&255,n[55]=J>>>24&255,n[56]=Q>>>0&255,n[57]=Q>>>8&255,n[58]=Q>>>16&255,n[59]=Q>>>24&255,n[60]=Z>>>0&255,n[61]=Z>>>8&255,n[62]=Z>>>16&255,n[63]=Z>>>24&255}function xe(n,a,s,e){for(var c=e[0]&255|(e[1]&255)<<8|(e[2]&255)<<16|(e[3]&255)<<24,u=s[0]&255|(s[1]&255)<<8|(s[2]&255)<<16|(s[3]&255)<<24,p=s[4]&255|(s[5]&255)<<8|(s[6]&255)<<16|(s[7]&255)<<24,g=s[8]&255|(s[9]&255)<<8|(s[10]&255)<<16|(s[11]&255)<<24,E=s[12]&255|(s[13]&255)<<8|(s[14]&255)<<16|(s[15]&255)<<24,$=e[4]&255|(e[5]&255)<<8|(e[6]&255)<<16|(e[7]&255)<<24,L=a[0]&255|(a[1]&255)<<8|(a[2]&255)<<16|(a[3]&255)<<24,oe=a[4]&255|(a[5]&255)<<8|(a[6]&255)<<16|(a[7]&255)<<24,P=a[8]&255|(a[9]&255)<<8|(a[10]&255)<<16|(a[11]&255)<<24,k=a[12]&255|(a[13]&255)<<8|(a[14]&255)<<16|(a[15]&255)<<24,H=e[8]&255|(e[9]&255)<<8|(e[10]&255)<<16|(e[11]&255)<<24,z=s[16]&255|(s[17]&255)<<8|(s[18]&255)<<16|(s[19]&255)<<24,G=s[20]&255|(s[21]&255)<<8|(s[22]&255)<<16|(s[23]&255)<<24,Y=s[24]&255|(s[25]&255)<<8|(s[26]&255)<<16|(s[27]&255)<<24,F=s[28]&255|(s[29]&255)<<8|(s[30]&255)<<16|(s[31]&255)<<24,V=e[12]&255|(e[13]&255)<<8|(e[14]&255)<<16|(e[15]&255)<<24,U=c,j=u,T=p,O=g,K=E,N=$,x=L,y=oe,w=P,m=k,b=H,C=z,q=G,J=Y,Q=F,Z=V,l,ee=0;ee<20;ee+=2)l=U+q|0,K^=l<<7|l>>>25,l=K+U|0,w^=l<<9|l>>>23,l=w+K|0,q^=l<<13|l>>>19,l=q+w|0,U^=l<<18|l>>>14,l=N+j|0,m^=l<<7|l>>>25,l=m+N|0,J^=l<<9|l>>>23,l=J+m|0,j^=l<<13|l>>>19,l=j+J|0,N^=l<<18|l>>>14,l=b+x|0,Q^=l<<7|l>>>25,l=Q+b|0,T^=l<<9|l>>>23,l=T+Q|0,x^=l<<13|l>>>19,l=x+T|0,b^=l<<18|l>>>14,l=Z+C|0,O^=l<<7|l>>>25,l=O+Z|0,y^=l<<9|l>>>23,l=y+O|0,C^=l<<13|l>>>19,l=C+y|0,Z^=l<<18|l>>>14,l=U+O|0,j^=l<<7|l>>>25,l=j+U|0,T^=l<<9|l>>>23,l=T+j|0,O^=l<<13|l>>>19,l=O+T|0,U^=l<<18|l>>>14,l=N+K|0,x^=l<<7|l>>>25,l=x+N|0,y^=l<<9|l>>>23,l=y+x|0,K^=l<<13|l>>>19,l=K+y|0,N^=l<<18|l>>>14,l=b+m|0,C^=l<<7|l>>>25,l=C+b|0,w^=l<<9|l>>>23,l=w+C|0,m^=l<<13|l>>>19,l=m+w|0,b^=l<<18|l>>>14,l=Z+Q|0,q^=l<<7|l>>>25,l=q+Z|0,J^=l<<9|l>>>23,l=J+q|0,Q^=l<<13|l>>>19,l=Q+J|0,Z^=l<<18|l>>>14;n[0]=U>>>0&255,n[1]=U>>>8&255,n[2]=U>>>16&255,n[3]=U>>>24&255,n[4]=N>>>0&255,n[5]=N>>>8&255,n[6]=N>>>16&255,n[7]=N>>>24&255,n[8]=b>>>0&255,n[9]=b>>>8&255,n[10]=b>>>16&255,n[11]=b>>>24&255,n[12]=Z>>>0&255,n[13]=Z>>>8&255,n[14]=Z>>>16&255,n[15]=Z>>>24&255,n[16]=x>>>0&255,n[17]=x>>>8&255,n[18]=x>>>16&255,n[19]=x>>>24&255,n[20]=y>>>0&255,n[21]=y>>>8&255,n[22]=y>>>16&255,n[23]=y>>>24&255,n[24]=w>>>0&255,n[25]=w>>>8&255,n[26]=w>>>16&255,n[27]=w>>>24&255,n[28]=m>>>0&255,n[29]=m>>>8&255,n[30]=m>>>16&255,n[31]=m>>>24&255}function ve(n,a,s,e){fe(n,a,s,e)}function be(n,a,s,e){xe(n,a,s,e)}var we=new Uint8Array([101,120,112,97,110,100,32,51,50,45,98,121,116,101,32,107]);function Ae(n,a,s,e,c,u,p){var g=new Uint8Array(16),E=new Uint8Array(64),$,L;for(L=0;L<16;L++)g[L]=0;for(L=0;L<8;L++)g[L]=u[L];for(;c>=64;){for(ve(E,g,p,we),L=0;L<64;L++)n[a+L]=s[e+L]^E[L];for($=1,L=8;L<16;L++)$=$+(g[L]&255)|0,g[L]=$&255,$>>>=8;c-=64,a+=64,e+=64}if(c>0)for(ve(E,g,p,we),L=0;L<c;L++)n[a+L]=s[e+L]^E[L];return 0}function Ne(n,a,s,e,c){var u=new Uint8Array(16),p=new Uint8Array(64),g,E;for(E=0;E<16;E++)u[E]=0;for(E=0;E<8;E++)u[E]=e[E];for(;s>=64;){for(ve(p,u,c,we),E=0;E<64;E++)n[a+E]=p[E];for(g=1,E=8;E<16;E++)g=g+(u[E]&255)|0,u[E]=g&255,g>>>=8;s-=64,a+=64}if(s>0)for(ve(p,u,c,we),E=0;E<s;E++)n[a+E]=p[E];return 0}function Ht(n,a,s,e,c){var u=new Uint8Array(32);be(u,e,c,we);for(var p=new Uint8Array(8),g=0;g<8;g++)p[g]=e[g+16];return Ne(n,a,s,p,u)}function mt(n,a,s,e,c,u,p){var g=new Uint8Array(32);be(g,u,p,we);for(var E=new Uint8Array(8),$=0;$<8;$++)E[$]=u[$+16];return Ae(n,a,s,e,c,E,g)}var Ze=function(n){this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.leftover=0,this.fin=0;var a,s,e,c,u,p,g,E;a=n[0]&255|(n[1]&255)<<8,this.r[0]=a&8191,s=n[2]&255|(n[3]&255)<<8,this.r[1]=(a>>>13|s<<3)&8191,e=n[4]&255|(n[5]&255)<<8,this.r[2]=(s>>>10|e<<6)&7939,c=n[6]&255|(n[7]&255)<<8,this.r[3]=(e>>>7|c<<9)&8191,u=n[8]&255|(n[9]&255)<<8,this.r[4]=(c>>>4|u<<12)&255,this.r[5]=u>>>1&8190,p=n[10]&255|(n[11]&255)<<8,this.r[6]=(u>>>14|p<<2)&8191,g=n[12]&255|(n[13]&255)<<8,this.r[7]=(p>>>11|g<<5)&8065,E=n[14]&255|(n[15]&255)<<8,this.r[8]=(g>>>8|E<<8)&8191,this.r[9]=E>>>5&127,this.pad[0]=n[16]&255|(n[17]&255)<<8,this.pad[1]=n[18]&255|(n[19]&255)<<8,this.pad[2]=n[20]&255|(n[21]&255)<<8,this.pad[3]=n[22]&255|(n[23]&255)<<8,this.pad[4]=n[24]&255|(n[25]&255)<<8,this.pad[5]=n[26]&255|(n[27]&255)<<8,this.pad[6]=n[28]&255|(n[29]&255)<<8,this.pad[7]=n[30]&255|(n[31]&255)<<8};Ze.prototype.blocks=function(n,a,s){for(var e=this.fin?0:2048,c,u,p,g,E,$,L,oe,P,k,H,z,G,Y,F,V,U,j,T,O=this.h[0],K=this.h[1],N=this.h[2],x=this.h[3],y=this.h[4],w=this.h[5],m=this.h[6],b=this.h[7],C=this.h[8],q=this.h[9],J=this.r[0],Q=this.r[1],Z=this.r[2],l=this.r[3],ee=this.r[4],se=this.r[5],ae=this.r[6],X=this.r[7],ne=this.r[8],re=this.r[9];s>=16;)c=n[a+0]&255|(n[a+1]&255)<<8,O+=c&8191,u=n[a+2]&255|(n[a+3]&255)<<8,K+=(c>>>13|u<<3)&8191,p=n[a+4]&255|(n[a+5]&255)<<8,N+=(u>>>10|p<<6)&8191,g=n[a+6]&255|(n[a+7]&255)<<8,x+=(p>>>7|g<<9)&8191,E=n[a+8]&255|(n[a+9]&255)<<8,y+=(g>>>4|E<<12)&8191,w+=E>>>1&8191,$=n[a+10]&255|(n[a+11]&255)<<8,m+=(E>>>14|$<<2)&8191,L=n[a+12]&255|(n[a+13]&255)<<8,b+=($>>>11|L<<5)&8191,oe=n[a+14]&255|(n[a+15]&255)<<8,C+=(L>>>8|oe<<8)&8191,q+=oe>>>5|e,P=0,k=P,k+=O*J,k+=K*(5*re),k+=N*(5*ne),k+=x*(5*X),k+=y*(5*ae),P=k>>>13,k&=8191,k+=w*(5*se),k+=m*(5*ee),k+=b*(5*l),k+=C*(5*Z),k+=q*(5*Q),P+=k>>>13,k&=8191,H=P,H+=O*Q,H+=K*J,H+=N*(5*re),H+=x*(5*ne),H+=y*(5*X),P=H>>>13,H&=8191,H+=w*(5*ae),H+=m*(5*se),H+=b*(5*ee),H+=C*(5*l),H+=q*(5*Z),P+=H>>>13,H&=8191,z=P,z+=O*Z,z+=K*Q,z+=N*J,z+=x*(5*re),z+=y*(5*ne),P=z>>>13,z&=8191,z+=w*(5*X),z+=m*(5*ae),z+=b*(5*se),z+=C*(5*ee),z+=q*(5*l),P+=z>>>13,z&=8191,G=P,G+=O*l,G+=K*Z,G+=N*Q,G+=x*J,G+=y*(5*re),P=G>>>13,G&=8191,G+=w*(5*ne),G+=m*(5*X),G+=b*(5*ae),G+=C*(5*se),G+=q*(5*ee),P+=G>>>13,G&=8191,Y=P,Y+=O*ee,Y+=K*l,Y+=N*Z,Y+=x*Q,Y+=y*J,P=Y>>>13,Y&=8191,Y+=w*(5*re),Y+=m*(5*ne),Y+=b*(5*X),Y+=C*(5*ae),Y+=q*(5*se),P+=Y>>>13,Y&=8191,F=P,F+=O*se,F+=K*ee,F+=N*l,F+=x*Z,F+=y*Q,P=F>>>13,F&=8191,F+=w*J,F+=m*(5*re),F+=b*(5*ne),F+=C*(5*X),F+=q*(5*ae),P+=F>>>13,F&=8191,V=P,V+=O*ae,V+=K*se,V+=N*ee,V+=x*l,V+=y*Z,P=V>>>13,V&=8191,V+=w*Q,V+=m*J,V+=b*(5*re),V+=C*(5*ne),V+=q*(5*X),P+=V>>>13,V&=8191,U=P,U+=O*X,U+=K*ae,U+=N*se,U+=x*ee,U+=y*l,P=U>>>13,U&=8191,U+=w*Z,U+=m*Q,U+=b*J,U+=C*(5*re),U+=q*(5*ne),P+=U>>>13,U&=8191,j=P,j+=O*ne,j+=K*X,j+=N*ae,j+=x*se,j+=y*ee,P=j>>>13,j&=8191,j+=w*l,j+=m*Z,j+=b*Q,j+=C*J,j+=q*(5*re),P+=j>>>13,j&=8191,T=P,T+=O*re,T+=K*ne,T+=N*X,T+=x*ae,T+=y*se,P=T>>>13,T&=8191,T+=w*ee,T+=m*l,T+=b*Z,T+=C*Q,T+=q*J,P+=T>>>13,T&=8191,P=(P<<2)+P|0,P=P+k|0,k=P&8191,P=P>>>13,H+=P,O=k,K=H,N=z,x=G,y=Y,w=F,m=V,b=U,C=j,q=T,a+=16,s-=16;this.h[0]=O,this.h[1]=K,this.h[2]=N,this.h[3]=x,this.h[4]=y,this.h[5]=w,this.h[6]=m,this.h[7]=b,this.h[8]=C,this.h[9]=q},Ze.prototype.finish=function(n,a){var s=new Uint16Array(10),e,c,u,p;if(this.leftover){for(p=this.leftover,this.buffer[p++]=1;p<16;p++)this.buffer[p]=0;this.fin=1,this.blocks(this.buffer,0,16)}for(e=this.h[1]>>>13,this.h[1]&=8191,p=2;p<10;p++)this.h[p]+=e,e=this.h[p]>>>13,this.h[p]&=8191;for(this.h[0]+=e*5,e=this.h[0]>>>13,this.h[0]&=8191,this.h[1]+=e,e=this.h[1]>>>13,this.h[1]&=8191,this.h[2]+=e,s[0]=this.h[0]+5,e=s[0]>>>13,s[0]&=8191,p=1;p<10;p++)s[p]=this.h[p]+e,e=s[p]>>>13,s[p]&=8191;for(s[9]-=8192,c=(e^1)-1,p=0;p<10;p++)s[p]&=c;for(c=~c,p=0;p<10;p++)this.h[p]=this.h[p]&c|s[p];for(this.h[0]=(this.h[0]|this.h[1]<<13)&65535,this.h[1]=(this.h[1]>>>3|this.h[2]<<10)&65535,this.h[2]=(this.h[2]>>>6|this.h[3]<<7)&65535,this.h[3]=(this.h[3]>>>9|this.h[4]<<4)&65535,this.h[4]=(this.h[4]>>>12|this.h[5]<<1|this.h[6]<<14)&65535,this.h[5]=(this.h[6]>>>2|this.h[7]<<11)&65535,this.h[6]=(this.h[7]>>>5|this.h[8]<<8)&65535,this.h[7]=(this.h[8]>>>8|this.h[9]<<5)&65535,u=this.h[0]+this.pad[0],this.h[0]=u&65535,p=1;p<8;p++)u=(this.h[p]+this.pad[p]|0)+(u>>>16)|0,this.h[p]=u&65535;n[a+0]=this.h[0]>>>0&255,n[a+1]=this.h[0]>>>8&255,n[a+2]=this.h[1]>>>0&255,n[a+3]=this.h[1]>>>8&255,n[a+4]=this.h[2]>>>0&255,n[a+5]=this.h[2]>>>8&255,n[a+6]=this.h[3]>>>0&255,n[a+7]=this.h[3]>>>8&255,n[a+8]=this.h[4]>>>0&255,n[a+9]=this.h[4]>>>8&255,n[a+10]=this.h[5]>>>0&255,n[a+11]=this.h[5]>>>8&255,n[a+12]=this.h[6]>>>0&255,n[a+13]=this.h[6]>>>8&255,n[a+14]=this.h[7]>>>0&255,n[a+15]=this.h[7]>>>8&255},Ze.prototype.update=function(n,a,s){var e,c;if(this.leftover){for(c=16-this.leftover,c>s&&(c=s),e=0;e<c;e++)this.buffer[this.leftover+e]=n[a+e];if(s-=c,a+=c,this.leftover+=c,this.leftover<16)return;this.blocks(this.buffer,0,16),this.leftover=0}if(s>=16&&(c=s-s%16,this.blocks(n,a,c),a+=c,s-=c),s){for(e=0;e<s;e++)this.buffer[this.leftover+e]=n[a+e];this.leftover+=s}};function gt(n,a,s,e,c,u){var p=new Ze(u);return p.update(s,e,c),p.finish(n,a),0}function Yt(n,a,s,e,c,u){var p=new Uint8Array(16);return gt(p,0,s,e,c,u),W(n,a,p,0)}function bt(n,a,s,e,c){var u;if(s<32)return-1;for(mt(n,0,a,0,s,e,c),gt(n,16,n,32,s-32,n),u=0;u<16;u++)n[u]=0;return 0}function vt(n,a,s,e,c){var u,p=new Uint8Array(32);if(s<32||(Ht(p,0,32,e,c),Yt(a,16,a,32,s-32,p)!==0))return-1;for(mt(n,0,a,0,s,e,c),u=0;u<32;u++)n[u]=0;return 0}function Te(n,a){var s;for(s=0;s<16;s++)n[s]=a[s]|0}function wt(n){var a,s,e=1;for(a=0;a<16;a++)s=n[a]+e+65535,e=Math.floor(s/65536),n[a]=s-e*65536;n[0]+=e-1+37*(e-1)}function Oe(n,a,s){for(var e,c=~(s-1),u=0;u<16;u++)e=c&(n[u]^a[u]),n[u]^=e,a[u]^=e}function Ke(n,a){var s,e,c,u=r(),p=r();for(s=0;s<16;s++)p[s]=a[s];for(wt(p),wt(p),wt(p),e=0;e<2;e++){for(u[0]=p[0]-65517,s=1;s<15;s++)u[s]=p[s]-65535-(u[s-1]>>16&1),u[s-1]&=65535;u[15]=p[15]-32767-(u[14]>>16&1),c=u[15]>>16&1,u[14]&=65535,Oe(p,u,1-c)}for(s=0;s<16;s++)n[2*s]=p[s]&255,n[2*s+1]=p[s]>>8}function Vt(n,a){var s=new Uint8Array(32),e=new Uint8Array(32);return Ke(s,n),Ke(e,a),ie(s,0,e,0)}function Ft(n){var a=new Uint8Array(32);return Ke(a,n),a[0]&1}function St(n,a){var s;for(s=0;s<16;s++)n[s]=a[2*s]+(a[2*s+1]<<8);n[15]&=32767}function Ie(n,a,s){for(var e=0;e<16;e++)n[e]=a[e]+s[e]}function _e(n,a,s){for(var e=0;e<16;e++)n[e]=a[e]-s[e]}function te(n,a,s){var e,c,u=0,p=0,g=0,E=0,$=0,L=0,oe=0,P=0,k=0,H=0,z=0,G=0,Y=0,F=0,V=0,U=0,j=0,T=0,O=0,K=0,N=0,x=0,y=0,w=0,m=0,b=0,C=0,q=0,J=0,Q=0,Z=0,l=s[0],ee=s[1],se=s[2],ae=s[3],X=s[4],ne=s[5],re=s[6],pe=s[7],ce=s[8],le=s[9],de=s[10],ue=s[11],he=s[12],ye=s[13],me=s[14],ge=s[15];e=a[0],u+=e*l,p+=e*ee,g+=e*se,E+=e*ae,$+=e*X,L+=e*ne,oe+=e*re,P+=e*pe,k+=e*ce,H+=e*le,z+=e*de,G+=e*ue,Y+=e*he,F+=e*ye,V+=e*me,U+=e*ge,e=a[1],p+=e*l,g+=e*ee,E+=e*se,$+=e*ae,L+=e*X,oe+=e*ne,P+=e*re,k+=e*pe,H+=e*ce,z+=e*le,G+=e*de,Y+=e*ue,F+=e*he,V+=e*ye,U+=e*me,j+=e*ge,e=a[2],g+=e*l,E+=e*ee,$+=e*se,L+=e*ae,oe+=e*X,P+=e*ne,k+=e*re,H+=e*pe,z+=e*ce,G+=e*le,Y+=e*de,F+=e*ue,V+=e*he,U+=e*ye,j+=e*me,T+=e*ge,e=a[3],E+=e*l,$+=e*ee,L+=e*se,oe+=e*ae,P+=e*X,k+=e*ne,H+=e*re,z+=e*pe,G+=e*ce,Y+=e*le,F+=e*de,V+=e*ue,U+=e*he,j+=e*ye,T+=e*me,O+=e*ge,e=a[4],$+=e*l,L+=e*ee,oe+=e*se,P+=e*ae,k+=e*X,H+=e*ne,z+=e*re,G+=e*pe,Y+=e*ce,F+=e*le,V+=e*de,U+=e*ue,j+=e*he,T+=e*ye,O+=e*me,K+=e*ge,e=a[5],L+=e*l,oe+=e*ee,P+=e*se,k+=e*ae,H+=e*X,z+=e*ne,G+=e*re,Y+=e*pe,F+=e*ce,V+=e*le,U+=e*de,j+=e*ue,T+=e*he,O+=e*ye,K+=e*me,N+=e*ge,e=a[6],oe+=e*l,P+=e*ee,k+=e*se,H+=e*ae,z+=e*X,G+=e*ne,Y+=e*re,F+=e*pe,V+=e*ce,U+=e*le,j+=e*de,T+=e*ue,O+=e*he,K+=e*ye,N+=e*me,x+=e*ge,e=a[7],P+=e*l,k+=e*ee,H+=e*se,z+=e*ae,G+=e*X,Y+=e*ne,F+=e*re,V+=e*pe,U+=e*ce,j+=e*le,T+=e*de,O+=e*ue,K+=e*he,N+=e*ye,x+=e*me,y+=e*ge,e=a[8],k+=e*l,H+=e*ee,z+=e*se,G+=e*ae,Y+=e*X,F+=e*ne,V+=e*re,U+=e*pe,j+=e*ce,T+=e*le,O+=e*de,K+=e*ue,N+=e*he,x+=e*ye,y+=e*me,w+=e*ge,e=a[9],H+=e*l,z+=e*ee,G+=e*se,Y+=e*ae,F+=e*X,V+=e*ne,U+=e*re,j+=e*pe,T+=e*ce,O+=e*le,K+=e*de,N+=e*ue,x+=e*he,y+=e*ye,w+=e*me,m+=e*ge,e=a[10],z+=e*l,G+=e*ee,Y+=e*se,F+=e*ae,V+=e*X,U+=e*ne,j+=e*re,T+=e*pe,O+=e*ce,K+=e*le,N+=e*de,x+=e*ue,y+=e*he,w+=e*ye,m+=e*me,b+=e*ge,e=a[11],G+=e*l,Y+=e*ee,F+=e*se,V+=e*ae,U+=e*X,j+=e*ne,T+=e*re,O+=e*pe,K+=e*ce,N+=e*le,x+=e*de,y+=e*ue,w+=e*he,m+=e*ye,b+=e*me,C+=e*ge,e=a[12],Y+=e*l,F+=e*ee,V+=e*se,U+=e*ae,j+=e*X,T+=e*ne,O+=e*re,K+=e*pe,N+=e*ce,x+=e*le,y+=e*de,w+=e*ue,m+=e*he,b+=e*ye,C+=e*me,q+=e*ge,e=a[13],F+=e*l,V+=e*ee,U+=e*se,j+=e*ae,T+=e*X,O+=e*ne,K+=e*re,N+=e*pe,x+=e*ce,y+=e*le,w+=e*de,m+=e*ue,b+=e*he,C+=e*ye,q+=e*me,J+=e*ge,e=a[14],V+=e*l,U+=e*ee,j+=e*se,T+=e*ae,O+=e*X,K+=e*ne,N+=e*re,x+=e*pe,y+=e*ce,w+=e*le,m+=e*de,b+=e*ue,C+=e*he,q+=e*ye,J+=e*me,Q+=e*ge,e=a[15],U+=e*l,j+=e*ee,T+=e*se,O+=e*ae,K+=e*X,N+=e*ne,x+=e*re,y+=e*pe,w+=e*ce,m+=e*le,b+=e*de,C+=e*ue,q+=e*he,J+=e*ye,Q+=e*me,Z+=e*ge,u+=38*j,p+=38*T,g+=38*O,E+=38*K,$+=38*N,L+=38*x,oe+=38*y,P+=38*w,k+=38*m,H+=38*b,z+=38*C,G+=38*q,Y+=38*J,F+=38*Q,V+=38*Z,c=1,e=u+c+65535,c=Math.floor(e/65536),u=e-c*65536,e=p+c+65535,c=Math.floor(e/65536),p=e-c*65536,e=g+c+65535,c=Math.floor(e/65536),g=e-c*65536,e=E+c+65535,c=Math.floor(e/65536),E=e-c*65536,e=$+c+65535,c=Math.floor(e/65536),$=e-c*65536,e=L+c+65535,c=Math.floor(e/65536),L=e-c*65536,e=oe+c+65535,c=Math.floor(e/65536),oe=e-c*65536,e=P+c+65535,c=Math.floor(e/65536),P=e-c*65536,e=k+c+65535,c=Math.floor(e/65536),k=e-c*65536,e=H+c+65535,c=Math.floor(e/65536),H=e-c*65536,e=z+c+65535,c=Math.floor(e/65536),z=e-c*65536,e=G+c+65535,c=Math.floor(e/65536),G=e-c*65536,e=Y+c+65535,c=Math.floor(e/65536),Y=e-c*65536,e=F+c+65535,c=Math.floor(e/65536),F=e-c*65536,e=V+c+65535,c=Math.floor(e/65536),V=e-c*65536,e=U+c+65535,c=Math.floor(e/65536),U=e-c*65536,u+=c-1+37*(c-1),c=1,e=u+c+65535,c=Math.floor(e/65536),u=e-c*65536,e=p+c+65535,c=Math.floor(e/65536),p=e-c*65536,e=g+c+65535,c=Math.floor(e/65536),g=e-c*65536,e=E+c+65535,c=Math.floor(e/65536),E=e-c*65536,e=$+c+65535,c=Math.floor(e/65536),$=e-c*65536,e=L+c+65535,c=Math.floor(e/65536),L=e-c*65536,e=oe+c+65535,c=Math.floor(e/65536),oe=e-c*65536,e=P+c+65535,c=Math.floor(e/65536),P=e-c*65536,e=k+c+65535,c=Math.floor(e/65536),k=e-c*65536,e=H+c+65535,c=Math.floor(e/65536),H=e-c*65536,e=z+c+65535,c=Math.floor(e/65536),z=e-c*65536,e=G+c+65535,c=Math.floor(e/65536),G=e-c*65536,e=Y+c+65535,c=Math.floor(e/65536),Y=e-c*65536,e=F+c+65535,c=Math.floor(e/65536),F=e-c*65536,e=V+c+65535,c=Math.floor(e/65536),V=e-c*65536,e=U+c+65535,c=Math.floor(e/65536),U=e-c*65536,u+=c-1+37*(c-1),n[0]=u,n[1]=p,n[2]=g,n[3]=E,n[4]=$,n[5]=L,n[6]=oe,n[7]=P,n[8]=k,n[9]=H,n[10]=z,n[11]=G,n[12]=Y,n[13]=F,n[14]=V,n[15]=U}function Ee(n,a){te(n,a,a)}function Gt(n,a){var s=r(),e;for(e=0;e<16;e++)s[e]=a[e];for(e=253;e>=0;e--)Ee(s,s),e!==2&&e!==4&&te(s,s,a);for(e=0;e<16;e++)n[e]=s[e]}function zt(n,a){var s=r(),e;for(e=0;e<16;e++)s[e]=a[e];for(e=250;e>=0;e--)Ee(s,s),e!==1&&te(s,s,a);for(e=0;e<16;e++)n[e]=s[e]}function We(n,a,s){var e=new Uint8Array(32),c=new Float64Array(80),u,p,g=r(),E=r(),$=r(),L=r(),oe=r(),P=r();for(p=0;p<31;p++)e[p]=a[p];for(e[31]=a[31]&127|64,e[0]&=248,St(c,s),p=0;p<16;p++)E[p]=c[p],L[p]=g[p]=$[p]=0;for(g[0]=L[0]=1,p=254;p>=0;--p)u=e[p>>>3]>>>(p&7)&1,Oe(g,E,u),Oe($,L,u),Ie(oe,g,$),_e(g,g,$),Ie($,E,L),_e(E,E,L),Ee(L,oe),Ee(P,g),te(g,$,g),te($,E,oe),Ie(oe,g,$),_e(g,g,$),Ee(E,g),_e($,L,P),te(g,$,S),Ie(g,g,L),te($,$,g),te(g,L,P),te(L,E,c),Ee(E,oe),Oe(g,E,u),Oe($,L,u);for(p=0;p<16;p++)c[p+16]=g[p],c[p+32]=$[p],c[p+48]=E[p],c[p+64]=L[p];var k=c.subarray(32),H=c.subarray(16);return Gt(k,k),te(H,H,k),Ke(n,H),0}function Qe(n,a){return We(n,a,d)}function Jt(n,a){return o(a,32),Qe(n,a)}function Xe(n,a,s){var e=new Uint8Array(32);return We(e,s,a),be(n,i,e,we)}var Zt=bt,An=vt;function En(n,a,s,e,c,u){var p=new Uint8Array(32);return Xe(p,c,u),Zt(n,a,s,e,p)}function In(n,a,s,e,c,u){var p=new Uint8Array(32);return Xe(p,c,u),An(n,a,s,e,p)}var Wt=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function Qt(n,a,s,e){for(var c=new Int32Array(16),u=new Int32Array(16),p,g,E,$,L,oe,P,k,H,z,G,Y,F,V,U,j,T,O,K,N,x,y,w,m,b,C,q=n[0],J=n[1],Q=n[2],Z=n[3],l=n[4],ee=n[5],se=n[6],ae=n[7],X=a[0],ne=a[1],re=a[2],pe=a[3],ce=a[4],le=a[5],de=a[6],ue=a[7],he=0;e>=128;){for(K=0;K<16;K++)N=8*K+he,c[K]=s[N+0]<<24|s[N+1]<<16|s[N+2]<<8|s[N+3],u[K]=s[N+4]<<24|s[N+5]<<16|s[N+6]<<8|s[N+7];for(K=0;K<80;K++)if(p=q,g=J,E=Q,$=Z,L=l,oe=ee,P=se,k=ae,H=X,z=ne,G=re,Y=pe,F=ce,V=le,U=de,j=ue,x=ae,y=ue,w=y&65535,m=y>>>16,b=x&65535,C=x>>>16,x=(l>>>14|ce<<18)^(l>>>18|ce<<14)^(ce>>>9|l<<23),y=(ce>>>14|l<<18)^(ce>>>18|l<<14)^(l>>>9|ce<<23),w+=y&65535,m+=y>>>16,b+=x&65535,C+=x>>>16,x=l&ee^~l&se,y=ce&le^~ce&de,w+=y&65535,m+=y>>>16,b+=x&65535,C+=x>>>16,x=Wt[K*2],y=Wt[K*2+1],w+=y&65535,m+=y>>>16,b+=x&65535,C+=x>>>16,x=c[K%16],y=u[K%16],w+=y&65535,m+=y>>>16,b+=x&65535,C+=x>>>16,m+=w>>>16,b+=m>>>16,C+=b>>>16,T=b&65535|C<<16,O=w&65535|m<<16,x=T,y=O,w=y&65535,m=y>>>16,b=x&65535,C=x>>>16,x=(q>>>28|X<<4)^(X>>>2|q<<30)^(X>>>7|q<<25),y=(X>>>28|q<<4)^(q>>>2|X<<30)^(q>>>7|X<<25),w+=y&65535,m+=y>>>16,b+=x&65535,C+=x>>>16,x=q&J^q&Q^J&Q,y=X&ne^X&re^ne&re,w+=y&65535,m+=y>>>16,b+=x&65535,C+=x>>>16,m+=w>>>16,b+=m>>>16,C+=b>>>16,k=b&65535|C<<16,j=w&65535|m<<16,x=$,y=Y,w=y&65535,m=y>>>16,b=x&65535,C=x>>>16,x=T,y=O,w+=y&65535,m+=y>>>16,b+=x&65535,C+=x>>>16,m+=w>>>16,b+=m>>>16,C+=b>>>16,$=b&65535|C<<16,Y=w&65535|m<<16,J=p,Q=g,Z=E,l=$,ee=L,se=oe,ae=P,q=k,ne=H,re=z,pe=G,ce=Y,le=F,de=V,ue=U,X=j,K%16===15)for(N=0;N<16;N++)x=c[N],y=u[N],w=y&65535,m=y>>>16,b=x&65535,C=x>>>16,x=c[(N+9)%16],y=u[(N+9)%16],w+=y&65535,m+=y>>>16,b+=x&65535,C+=x>>>16,T=c[(N+1)%16],O=u[(N+1)%16],x=(T>>>1|O<<31)^(T>>>8|O<<24)^T>>>7,y=(O>>>1|T<<31)^(O>>>8|T<<24)^(O>>>7|T<<25),w+=y&65535,m+=y>>>16,b+=x&65535,C+=x>>>16,T=c[(N+14)%16],O=u[(N+14)%16],x=(T>>>19|O<<13)^(O>>>29|T<<3)^T>>>6,y=(O>>>19|T<<13)^(T>>>29|O<<3)^(O>>>6|T<<26),w+=y&65535,m+=y>>>16,b+=x&65535,C+=x>>>16,m+=w>>>16,b+=m>>>16,C+=b>>>16,c[N]=b&65535|C<<16,u[N]=w&65535|m<<16;x=q,y=X,w=y&65535,m=y>>>16,b=x&65535,C=x>>>16,x=n[0],y=a[0],w+=y&65535,m+=y>>>16,b+=x&65535,C+=x>>>16,m+=w>>>16,b+=m>>>16,C+=b>>>16,n[0]=q=b&65535|C<<16,a[0]=X=w&65535|m<<16,x=J,y=ne,w=y&65535,m=y>>>16,b=x&65535,C=x>>>16,x=n[1],y=a[1],w+=y&65535,m+=y>>>16,b+=x&65535,C+=x>>>16,m+=w>>>16,b+=m>>>16,C+=b>>>16,n[1]=J=b&65535|C<<16,a[1]=ne=w&65535|m<<16,x=Q,y=re,w=y&65535,m=y>>>16,b=x&65535,C=x>>>16,x=n[2],y=a[2],w+=y&65535,m+=y>>>16,b+=x&65535,C+=x>>>16,m+=w>>>16,b+=m>>>16,C+=b>>>16,n[2]=Q=b&65535|C<<16,a[2]=re=w&65535|m<<16,x=Z,y=pe,w=y&65535,m=y>>>16,b=x&65535,C=x>>>16,x=n[3],y=a[3],w+=y&65535,m+=y>>>16,b+=x&65535,C+=x>>>16,m+=w>>>16,b+=m>>>16,C+=b>>>16,n[3]=Z=b&65535|C<<16,a[3]=pe=w&65535|m<<16,x=l,y=ce,w=y&65535,m=y>>>16,b=x&65535,C=x>>>16,x=n[4],y=a[4],w+=y&65535,m+=y>>>16,b+=x&65535,C+=x>>>16,m+=w>>>16,b+=m>>>16,C+=b>>>16,n[4]=l=b&65535|C<<16,a[4]=ce=w&65535|m<<16,x=ee,y=le,w=y&65535,m=y>>>16,b=x&65535,C=x>>>16,x=n[5],y=a[5],w+=y&65535,m+=y>>>16,b+=x&65535,C+=x>>>16,m+=w>>>16,b+=m>>>16,C+=b>>>16,n[5]=ee=b&65535|C<<16,a[5]=le=w&65535|m<<16,x=se,y=de,w=y&65535,m=y>>>16,b=x&65535,C=x>>>16,x=n[6],y=a[6],w+=y&65535,m+=y>>>16,b+=x&65535,C+=x>>>16,m+=w>>>16,b+=m>>>16,C+=b>>>16,n[6]=se=b&65535|C<<16,a[6]=de=w&65535|m<<16,x=ae,y=ue,w=y&65535,m=y>>>16,b=x&65535,C=x>>>16,x=n[7],y=a[7],w+=y&65535,m+=y>>>16,b+=x&65535,C+=x>>>16,m+=w>>>16,b+=m>>>16,C+=b>>>16,n[7]=ae=b&65535|C<<16,a[7]=ue=w&65535|m<<16,he+=128,e-=128}return e}function Be(n,a,s){var e=new Int32Array(8),c=new Int32Array(8),u=new Uint8Array(256),p,g=s;for(e[0]=1779033703,e[1]=3144134277,e[2]=1013904242,e[3]=2773480762,e[4]=1359893119,e[5]=2600822924,e[6]=528734635,e[7]=1541459225,c[0]=4089235720,c[1]=2227873595,c[2]=4271175723,c[3]=1595750129,c[4]=2917565137,c[5]=725511199,c[6]=4215389547,c[7]=327033209,Qt(e,c,a,s),s%=128,p=0;p<s;p++)u[p]=a[g-s+p];for(u[s]=128,s=256-128*(s<112?1:0),u[s-9]=0,D(u,s-8,g/536870912|0,g<<3),Qt(e,c,u,s),p=0;p<8;p++)D(n,8*p,e[p],c[p]);return 0}function et(n,a){var s=r(),e=r(),c=r(),u=r(),p=r(),g=r(),E=r(),$=r(),L=r();_e(s,n[1],n[0]),_e(L,a[1],a[0]),te(s,s,L),Ie(e,n[0],n[1]),Ie(L,a[0],a[1]),te(e,e,L),te(c,n[3],a[3]),te(c,c,A),te(u,n[2],a[2]),Ie(u,u,u),_e(p,e,s),_e(g,u,c),Ie(E,u,c),Ie($,e,s),te(n[0],p,g),te(n[1],$,E),te(n[2],E,g),te(n[3],p,$)}function Xt(n,a,s){var e;for(e=0;e<4;e++)Oe(n[e],a[e],s)}function Ct(n,a){var s=r(),e=r(),c=r();Gt(c,a[2]),te(s,a[0],c),te(e,a[1],c),Ke(n,e),n[31]^=Ft(s)<<7}function At(n,a,s){var e,c;for(Te(n[0],h),Te(n[1],v),Te(n[2],v),Te(n[3],h),c=255;c>=0;--c)e=s[c/8|0]>>(c&7)&1,Xt(n,a,e),et(a,n),et(n,n),Xt(n,a,e)}function tt(n,a){var s=[r(),r(),r(),r()];Te(s[0],B),Te(s[1],_),Te(s[2],v),te(s[3],B,_),At(n,s,a)}function Et(n,a,s){var e=new Uint8Array(64),c=[r(),r(),r(),r()],u;for(s||o(a,32),Be(e,a,32),e[0]&=248,e[31]&=127,e[31]|=64,tt(c,e),Ct(n,c),u=0;u<32;u++)a[u+32]=n[u];return 0}var nt=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function It(n,a){var s,e,c,u;for(e=63;e>=32;--e){for(s=0,c=e-32,u=e-12;c<u;++c)a[c]+=s-16*a[e]*nt[c-(e-32)],s=Math.floor((a[c]+128)/256),a[c]-=s*256;a[c]+=s,a[e]=0}for(s=0,c=0;c<32;c++)a[c]+=s-(a[31]>>4)*nt[c],s=a[c]>>8,a[c]&=255;for(c=0;c<32;c++)a[c]-=s*nt[c];for(e=0;e<32;e++)a[e+1]+=a[e]>>8,n[e]=a[e]&255}function _t(n){var a=new Float64Array(64),s;for(s=0;s<64;s++)a[s]=n[s];for(s=0;s<64;s++)n[s]=0;It(n,a)}function en(n,a,s,e){var c=new Uint8Array(64),u=new Uint8Array(64),p=new Uint8Array(64),g,E,$=new Float64Array(64),L=[r(),r(),r(),r()];Be(c,e,32),c[0]&=248,c[31]&=127,c[31]|=64;var oe=s+64;for(g=0;g<s;g++)n[64+g]=a[g];for(g=0;g<32;g++)n[32+g]=c[32+g];for(Be(p,n.subarray(32),s+32),_t(p),tt(L,p),Ct(n,L),g=32;g<64;g++)n[g]=e[g];for(Be(u,n,s+64),_t(u),g=0;g<64;g++)$[g]=0;for(g=0;g<32;g++)$[g]=p[g];for(g=0;g<32;g++)for(E=0;E<32;E++)$[g+E]+=u[g]*c[E];return It(n.subarray(32),$),oe}function _n(n,a){var s=r(),e=r(),c=r(),u=r(),p=r(),g=r(),E=r();return Te(n[2],v),St(n[1],a),Ee(c,n[1]),te(u,c,M),_e(c,c,n[2]),Ie(u,n[2],u),Ee(p,u),Ee(g,p),te(E,g,p),te(s,E,c),te(s,s,u),zt(s,s),te(s,s,c),te(s,s,u),te(s,s,u),te(n[0],s,u),Ee(e,n[0]),te(e,e,u),Vt(e,c)&&te(n[0],n[0],I),Ee(e,n[0]),te(e,e,u),Vt(e,c)?-1:(Ft(n[0])===a[31]>>7&&_e(n[0],h,n[0]),te(n[3],n[0],n[1]),0)}function Nt(n,a,s,e){var c,u=new Uint8Array(32),p=new Uint8Array(64),g=[r(),r(),r(),r()],E=[r(),r(),r(),r()];if(s<64||_n(E,e))return-1;for(c=0;c<s;c++)n[c]=a[c];for(c=0;c<32;c++)n[c+32]=e[c];if(Be(p,n,s),_t(p),At(g,E,p),tt(E,a.subarray(32)),et(g,E),Ct(u,g),s-=64,ie(a,0,u,0)){for(c=0;c<s;c++)n[c]=0;return-1}for(c=0;c<s;c++)n[c]=a[c+64];return s}var Lt=32,rt=24,qe=32,$e=16,De=32,ot=32,ke=32,He=32,Tt=32,tn=rt,Nn=qe,Ln=$e,Me=64,Pe=32,je=64,Mt=32,Bt=64;t.lowlevel={crypto_core_hsalsa20:be,crypto_stream_xor:mt,crypto_stream:Ht,crypto_stream_salsa20_xor:Ae,crypto_stream_salsa20:Ne,crypto_onetimeauth:gt,crypto_onetimeauth_verify:Yt,crypto_verify_16:W,crypto_verify_32:ie,crypto_secretbox:bt,crypto_secretbox_open:vt,crypto_scalarmult:We,crypto_scalarmult_base:Qe,crypto_box_beforenm:Xe,crypto_box_afternm:Zt,crypto_box:En,crypto_box_open:In,crypto_box_keypair:Jt,crypto_hash:Be,crypto_sign:en,crypto_sign_keypair:Et,crypto_sign_open:Nt,crypto_secretbox_KEYBYTES:Lt,crypto_secretbox_NONCEBYTES:rt,crypto_secretbox_ZEROBYTES:qe,crypto_secretbox_BOXZEROBYTES:$e,crypto_scalarmult_BYTES:De,crypto_scalarmult_SCALARBYTES:ot,crypto_box_PUBLICKEYBYTES:ke,crypto_box_SECRETKEYBYTES:He,crypto_box_BEFORENMBYTES:Tt,crypto_box_NONCEBYTES:tn,crypto_box_ZEROBYTES:Nn,crypto_box_BOXZEROBYTES:Ln,crypto_sign_BYTES:Me,crypto_sign_PUBLICKEYBYTES:Pe,crypto_sign_SECRETKEYBYTES:je,crypto_sign_SEEDBYTES:Mt,crypto_hash_BYTES:Bt,gf:r,D:M,L:nt,pack25519:Ke,unpack25519:St,M:te,A:Ie,S:Ee,Z:_e,pow2523:zt,add:et,set25519:Te,modL:It,scalarmult:At,scalarbase:tt};function nn(n,a){if(n.length!==Lt)throw new Error("bad key size");if(a.length!==rt)throw new Error("bad nonce size")}function Tn(n,a){if(n.length!==ke)throw new Error("bad public key size");if(a.length!==He)throw new Error("bad secret key size")}function Se(){for(var n=0;n<arguments.length;n++)if(!(arguments[n]instanceof Uint8Array))throw new TypeError("unexpected type, use Uint8Array")}function rn(n){for(var a=0;a<n.length;a++)n[a]=0}t.randomBytes=function(n){var a=new Uint8Array(n);return o(a,n),a},t.secretbox=function(n,a,s){Se(n,a,s),nn(s,a);for(var e=new Uint8Array(qe+n.length),c=new Uint8Array(e.length),u=0;u<n.length;u++)e[u+qe]=n[u];return bt(c,e,e.length,a,s),c.subarray($e)},t.secretbox.open=function(n,a,s){Se(n,a,s),nn(s,a);for(var e=new Uint8Array($e+n.length),c=new Uint8Array(e.length),u=0;u<n.length;u++)e[u+$e]=n[u];return e.length<32||vt(c,e,e.length,a,s)!==0?null:c.subarray(qe)},t.secretbox.keyLength=Lt,t.secretbox.nonceLength=rt,t.secretbox.overheadLength=$e,t.scalarMult=function(n,a){if(Se(n,a),n.length!==ot)throw new Error("bad n size");if(a.length!==De)throw new Error("bad p size");var s=new Uint8Array(De);return We(s,n,a),s},t.scalarMult.base=function(n){if(Se(n),n.length!==ot)throw new Error("bad n size");var a=new Uint8Array(De);return Qe(a,n),a},t.scalarMult.scalarLength=ot,t.scalarMult.groupElementLength=De,t.box=function(n,a,s,e){var c=t.box.before(s,e);return t.secretbox(n,a,c)},t.box.before=function(n,a){Se(n,a),Tn(n,a);var s=new Uint8Array(Tt);return Xe(s,n,a),s},t.box.after=t.secretbox,t.box.open=function(n,a,s,e){var c=t.box.before(s,e);return t.secretbox.open(n,a,c)},t.box.open.after=t.secretbox.open,t.box.keyPair=function(){var n=new Uint8Array(ke),a=new Uint8Array(He);return Jt(n,a),{publicKey:n,secretKey:a}},t.box.keyPair.fromSecretKey=function(n){if(Se(n),n.length!==He)throw new Error("bad secret key size");var a=new Uint8Array(ke);return Qe(a,n),{publicKey:a,secretKey:new Uint8Array(n)}},t.box.publicKeyLength=ke,t.box.secretKeyLength=He,t.box.sharedKeyLength=Tt,t.box.nonceLength=tn,t.box.overheadLength=t.secretbox.overheadLength,t.sign=function(n,a){if(Se(n,a),a.length!==je)throw new Error("bad secret key size");var s=new Uint8Array(Me+n.length);return en(s,n,n.length,a),s},t.sign.open=function(n,a){if(Se(n,a),a.length!==Pe)throw new Error("bad public key size");var s=new Uint8Array(n.length),e=Nt(s,n,n.length,a);if(e<0)return null;for(var c=new Uint8Array(e),u=0;u<c.length;u++)c[u]=s[u];return c},t.sign.detached=function(n,a){for(var s=t.sign(n,a),e=new Uint8Array(Me),c=0;c<e.length;c++)e[c]=s[c];return e},t.sign.detached.verify=function(n,a,s){if(Se(n,a,s),a.length!==Me)throw new Error("bad signature size");if(s.length!==Pe)throw new Error("bad public key size");var e=new Uint8Array(Me+n.length),c=new Uint8Array(Me+n.length),u;for(u=0;u<Me;u++)e[u]=a[u];for(u=0;u<n.length;u++)e[u+Me]=n[u];return Nt(c,e,e.length,s)>=0},t.sign.keyPair=function(){var n=new Uint8Array(Pe),a=new Uint8Array(je);return Et(n,a),{publicKey:n,secretKey:a}},t.sign.keyPair.fromSecretKey=function(n){if(Se(n),n.length!==je)throw new Error("bad secret key size");for(var a=new Uint8Array(Pe),s=0;s<a.length;s++)a[s]=n[32+s];return{publicKey:a,secretKey:new Uint8Array(n)}},t.sign.keyPair.fromSeed=function(n){if(Se(n),n.length!==Mt)throw new Error("bad seed size");for(var a=new Uint8Array(Pe),s=new Uint8Array(je),e=0;e<32;e++)s[e]=n[e];return Et(a,s,!0),{publicKey:a,secretKey:s}},t.sign.publicKeyLength=Pe,t.sign.secretKeyLength=je,t.sign.seedLength=Mt,t.sign.signatureLength=Me,t.hash=function(n){Se(n);var a=new Uint8Array(Bt);return Be(a,n,n.length),a},t.hash.hashLength=Bt,t.verify=function(n,a){return Se(n,a),n.length===0||a.length===0||n.length!==a.length?!1:R(n,0,a,0,n.length)===0},t.setPRNG=function(n){o=n},function(){var n=typeof self<"u"?self.crypto||self.msCrypto:null;if(n&&n.getRandomValues){var a=65536;t.setPRNG(function(s,e){var c,u=new Uint8Array(e);for(c=0;c<e;c+=a)n.getRandomValues(u.subarray(c,c+Math.min(e-c,a)));for(c=0;c<e;c++)s[c]=u[c];rn(u)})}else typeof Un<"u"&&(n=$n,n&&n.randomBytes&&t.setPRNG(function(s,e){var c,u=n.randomBytes(e);for(c=0;c<e;c++)s[c]=u[c];rn(u)}))}()})(f.exports?f.exports:self.nacl=self.nacl||{})})(xn);var jn=xn.exports;const yn=Bn(jn);var mn={exports:{}};(function(f){(function(t,r){f.exports?f.exports=r():(t.nacl||(t.nacl={}),t.nacl.util=r())})(Mn,function(){var t={};function r(o){if(!/^(?:[A-Za-z0-9+\/]{2}[A-Za-z0-9+\/]{2})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?$/.test(o))throw new TypeError("invalid encoding")}return t.decodeUTF8=function(o){if(typeof o!="string")throw new TypeError("expected string");var i,d=unescape(encodeURIComponent(o)),h=new Uint8Array(d.length);for(i=0;i<d.length;i++)h[i]=d.charCodeAt(i);return h},t.encodeUTF8=function(o){var i,d=[];for(i=0;i<o.length;i++)d.push(String.fromCharCode(o[i]));return decodeURIComponent(escape(d.join("")))},typeof atob>"u"?typeof Buffer.from<"u"?(t.encodeBase64=function(o){return Buffer.from(o).toString("base64")},t.decodeBase64=function(o){return r(o),new Uint8Array(Array.prototype.slice.call(Buffer.from(o,"base64"),0))}):(t.encodeBase64=function(o){return new Buffer(o).toString("base64")},t.decodeBase64=function(o){return r(o),new Uint8Array(Array.prototype.slice.call(new Buffer(o,"base64"),0))}):(t.encodeBase64=function(o){var i,d=[],h=o.length;for(i=0;i<h;i++)d.push(String.fromCharCode(o[i]));return btoa(d.join(""))},t.decodeBase64=function(o){r(o);var i,d=atob(o),h=new Uint8Array(d.length);for(i=0;i<d.length;i++)h[i]=d.charCodeAt(i);return h}),t})})(mn);var gn=mn.exports;const Ut="meshlang_actors",Fe="meshlang_active_actor",on="meshlang_keys",st="meshlang_active_key";function ze(){const f=localStorage.getItem(Ut);if(f)try{const r=JSON.parse(f);return{actors:r.actors||r.keys||[]}}catch{return{actors:[]}}const t=localStorage.getItem(on);if(t)try{const o={actors:JSON.parse(t).keys||[]};localStorage.setItem(Ut,JSON.stringify(o)),localStorage.removeItem(on);const i=localStorage.getItem(st);return i&&(localStorage.setItem(Fe,i),localStorage.removeItem(st)),o}catch{return{actors:[]}}return{actors:[]}}function Rt(f){localStorage.setItem(Ut,JSON.stringify(f))}function qt(){const f=localStorage.getItem(Fe);if(f)return f;const t=localStorage.getItem(st);return t?(localStorage.setItem(Fe,t),localStorage.removeItem(st),t):null}function ft(f){localStorage.setItem(Fe,f)}function bn(){return ze().actors}function Dt(f){return ze().actors.find(r=>r.id===f)||null}function vn(f,t,r){const o=ze(),i=o.actors.findIndex(h=>h.id===f),d={id:f,name:t,publicKey:Array.from(r.publicKey),secretKey:Array.from(r.secretKey),createdAt:Date.now()};i>=0?o.actors[i]=d:o.actors.push(d),Rt(o)}function Rn(f){const t=ze();t.actors=t.actors.filter(r=>r.id!==f),Rt(t),qt()===f&&localStorage.removeItem(Fe)}function qn(f,t){const r=ze(),o=r.actors.find(i=>i.id===f);o&&(o.name=t,Rt(r))}function Ot(f){return{publicKey:new Uint8Array(f.publicKey),secretKey:new Uint8Array(f.secretKey)}}function Dn(){const{publicKey:f,secretKey:t}=yn.sign.keyPair();return{publicKey:f,secretKey:t}}function kt(f){const t=yn.hash(f);return gn.encodeBase64(t.slice(0,16)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function Ge(f){return{keyPair:f,nodeId:kt(f.publicKey),publicKeyBase64:gn.encodeBase64(f.publicKey)}}function wn(f){const t=Dn(),r=kt(t.publicKey),o=f||`Actor ${new Date().toLocaleString()}`;return vn(r,o,t),ft(r),Ge(t)}function kn(f){const t=Dt(f);return t?(ft(f),Ge(Ot(t))):null}function Hn(){const f=bn(),t=qt();if(t){const r=Dt(t);if(r)return Ge(Ot(r))}return f.length>0?(ft(f[0].id),Ge(Ot(f[0]))):wn("Default Actor")}function Ue(){return bn()}function ct(){return qt()}function Yn(f){try{const t=JSON.parse(atob(f));if(!t.publicKey||!t.secretKey)return null;const r={publicKey:new Uint8Array(t.publicKey),secretKey:new Uint8Array(t.secretKey)},o=kt(r.publicKey),i=t.name||`Imported ${new Date().toLocaleString()}`;return vn(o,i,r),ft(o),Ge(r)}catch{return null}}function Vn(f){const t=Dt(f);if(!t)return null;const r={name:t.name,publicKey:t.publicKey,secretKey:t.secretKey};return btoa(JSON.stringify(r))}function Fn(f){let t=5381;for(let r=0;r<f.length;r++)t=(t<<5)+t^f.charCodeAt(r);return(t>>>0).toString(16).padStart(8,"0")}class Gn{facts=new Map;byScope=new Map;byKey=new Map;byValue=new Map;listeners=new Set;scopeMeta=new Map;hashChangeListeners=new Set;valueKey(t){return JSON.stringify(t)}factId(t,r){return`${r}:${t[0]}:${this.valueKey(t[1])}`}add(t,r,o){const i=o??r,d=this.factId(t,i);if(this.facts.has(d))return null;const h={id:d,fact:t,scope:i,timestamp:Date.now(),source:r};this.facts.set(d,h),this.byScope.has(i)||this.byScope.set(i,new Set),this.byScope.get(i).add(d),this.byKey.has(t[0])||this.byKey.set(t[0],new Set),this.byKey.get(t[0]).add(d);const v=this.valueKey(t[1]);this.byValue.has(v)||this.byValue.set(v,new Set),this.byValue.get(v).add(d),this.updateScopeHash(i);for(const S of this.listeners)S(h);return h}get(t){return this.facts.get(t)}has(t,r){return this.facts.has(this.factId(t,r))}retract(t,r){const o=this.factId(t,r);if(!this.facts.get(o))return!1;this.facts.delete(o);const d=this.byScope.get(r);d&&(d.delete(o),d.size===0&&this.byScope.delete(r));const h=this.byKey.get(t[0]);h&&(h.delete(o),h.size===0&&this.byKey.delete(t[0]));const v=this.valueKey(t[1]),S=this.byValue.get(v);return S&&(S.delete(o),S.size===0&&this.byValue.delete(v)),this.updateScopeHash(r),!0}all(){return Array.from(this.facts.values())}allIds(){return new Set(this.facts.keys())}findByScope(t){const r=this.byScope.get(t);return r?Array.from(r).map(o=>this.facts.get(o)):[]}findByKey(t){const r=this.byKey.get(t);return r?Array.from(r).map(o=>this.facts.get(o)):[]}findByValue(t){const r=this.byValue.get(this.valueKey(t));return r?Array.from(r).map(o=>this.facts.get(o)):[]}onAdd(t){return this.listeners.add(t),()=>this.listeners.delete(t)}addStored(t){if(this.facts.has(t.id))return!1;this.facts.set(t.id,t);const r=t.fact,o=t.scope;this.byScope.has(o)||this.byScope.set(o,new Set),this.byScope.get(o).add(t.id),this.byKey.has(r[0])||this.byKey.set(r[0],new Set),this.byKey.get(r[0]).add(t.id);const i=this.valueKey(r[1]);this.byValue.has(i)||this.byValue.set(i,new Set),this.byValue.get(i).add(t.id),this.updateScopeHash(o);for(const d of this.listeners)d(t);return!0}computeScopeHash(t){const r=this.findByScope(t);if(r.length===0)return"00000000";const o=r.map(i=>i.id).sort();return Fn(o.join("|"))}updateScopeHash(t){const r=this.computeScopeHash(t),o=this.scopeMeta.get(t),i=o?.hash??"00000000";if(i!==r){o?(o.hash=r,o.lastModified=Date.now()):this.scopeMeta.set(t,{hash:r,visibleTo:new Set,lastModified:Date.now()});for(const d of this.hashChangeListeners)d(t,i,r)}}getScopeHash(t){return this.scopeMeta.get(t)?.hash??this.computeScopeHash(t)}getScopeMeta(t){return this.scopeMeta.get(t)}onHashChange(t){return this.hashChangeListeners.add(t),()=>this.hashChangeListeners.delete(t)}setVisibleTo(t,r){let o=this.scopeMeta.get(t);o||(o={hash:this.computeScopeHash(t),visibleTo:new Set,lastModified:Date.now()},this.scopeMeta.set(t,o)),o.visibleTo.add(r)}removeVisibility(t,r){const o=this.scopeMeta.get(t);o&&o.visibleTo.delete(r)}isVisibleTo(t,r){const o=this.scopeMeta.get(t);return o?o.visibleTo.has(r):!1}getScopesVisibleTo(t){const r=[];for(const[o,i]of this.scopeMeta)i.visibleTo.has(t)&&r.push(o);return r}getFactsVisibleTo(t){const r=this.getScopesVisibleTo(t),o=[];for(const i of r)o.push(...this.findByScope(i));return o}getAllScopes(){return Array.from(this.byScope.keys())}getScopeHashes(){const t=new Map;for(const r of this.byScope.keys())t.set(r,this.getScopeHash(r));return t}}function Ye(f){return{id:f.id,k:f.fact[0],v:f.fact[1],sc:f.scope,t:f.timestamp,s:f.source}}function Ve(f){if("e"in f&&"a"in f){const r=f;return{id:r.id,fact:[r.a,r.v],scope:r.e,timestamp:r.t,source:r.s}}const t=f;return{id:t.id,fact:[t.k,t.v],scope:t.sc,timestamp:t.t,source:t.s}}function zn(f){return JSON.stringify(f)}function Jn(f){return JSON.parse(f)}class sn{constructor(t,r={iceServers:[{urls:"stun:stun.l.google.com:19302"}]}){this.isInitiator=t,this.config=r,this.connection=new RTCPeerConnection(this.config),this.connection.oniceconnectionstatechange=()=>{console.log("[Peer] ICE connection state:",this.connection.iceConnectionState),(this.connection.iceConnectionState==="disconnected"||this.connection.iceConnectionState==="failed")&&this.setState("disconnected")},this.connection.onconnectionstatechange=()=>{console.log("[Peer] Connection state:",this.connection.connectionState)},this.connection.onsignalingstatechange=()=>{console.log("[Peer] Signaling state:",this.connection.signalingState)},t?(this.channel=this.connection.createDataChannel("meshlang"),this.setupChannel(this.channel)):this.connection.ondatachannel=o=>{this.channel=o.channel,this.setupChannel(this.channel)}}connection;channel=null;state="connecting";messageHandlers=new Set;stateHandlers=new Set;pendingCandidates=[];remoteDescriptionSet=!1;remoteInfo=null;setupChannel(t){console.log("[Peer] Setting up data channel:",t.label),t.onopen=()=>{console.log("[Peer] Data channel opened"),this.setState("connected")},t.onclose=()=>{console.log("[Peer] Data channel closed"),this.setState("disconnected")},t.onerror=r=>{console.error("[Peer] Data channel error:",r)},t.onmessage=r=>{try{const o=Jn(r.data);console.log("[Peer] Received message:",o.type),o.type==="hello"&&(this.remoteInfo={nodeId:o.nodeId,publicKey:o.publicKey});for(const i of this.messageHandlers)i(o)}catch(o){console.error("Failed to decode message:",o)}}}setState(t){this.state=t;for(const r of this.stateHandlers)r(t)}getState(){return this.state}async createOffer(){console.log("[Peer] Creating offer");const t=await this.connection.createOffer();return await this.connection.setLocalDescription(t),console.log("[Peer] Offer created and local description set"),t}async acceptOffer(t){console.log("[Peer] Accepting offer"),await this.connection.setRemoteDescription(t),this.remoteDescriptionSet=!0,await this.flushPendingCandidates();const r=await this.connection.createAnswer();return await this.connection.setLocalDescription(r),console.log("[Peer] Answer created and local description set"),r}async acceptAnswer(t){console.log("[Peer] Accepting answer"),await this.connection.setRemoteDescription(t),this.remoteDescriptionSet=!0,await this.flushPendingCandidates(),console.log("[Peer] Answer accepted, remote description set")}async flushPendingCandidates(){for(const t of this.pendingCandidates)await this.connection.addIceCandidate(t);this.pendingCandidates=[]}async addIceCandidate(t){this.remoteDescriptionSet?await this.connection.addIceCandidate(t):this.pendingCandidates.push(t)}onIceCandidate(t){const r=this.connection.onicecandidate;this.connection.onicecandidate=o=>{o.candidate&&(console.log("[Peer] ICE candidate:",o.candidate.candidate?.substring(0,50)),t(o.candidate)),r&&r.call(this.connection,o)}}onIceGatheringComplete(t){const r=this.connection.onicecandidate;this.connection.onicecandidate=o=>{r&&r.call(this.connection,o),o.candidate||(console.log("[Peer] ICE gathering complete"),t())}}send(t){this.channel&&this.channel.readyState==="open"&&this.channel.send(zn(t))}onMessage(t){return this.messageHandlers.add(t),()=>this.messageHandlers.delete(t)}onStateChange(t){return this.stateHandlers.add(t),()=>this.stateHandlers.delete(t)}close(){this.channel?.close(),this.connection.close(),this.setState("disconnected")}}class Zn{constructor(t,r,o){this.nodeId=t,this.store=r,this.sendToNode=o}groups=new Map;proposals=new Map;pendingInvites=new Map;listeners=new Set;createGroup(t,r,o="unanimous"){const i={id:t,name:r,members:[this.nodeId],consensus:o};return this.groups.set(t,i),this.notifyListeners(),i}invitePeer(t,r){const o=this.groups.get(t);return!o||o.members.includes(r)?!1:(this.sendToNode(r,{type:"group-invite",groupId:o.id,groupName:o.name,from:this.nodeId,members:o.members}),!0)}handleInvite(t){this.pendingInvites.set(t.groupId,{groupId:t.groupId,groupName:t.groupName,from:t.from,members:t.members,timestamp:Date.now()}),this.notifyListeners()}respondToInvite(t,r){const o=this.pendingInvites.get(t);if(o){if(this.pendingInvites.delete(t),r){const i={id:t,name:o.groupName,members:[...o.members,this.nodeId],consensus:"unanimous"};this.groups.set(t,i);for(const d of o.members)this.sendToNode(d,{type:"group-sync-request",groupId:t,haveIds:[]})}for(const i of o.members)this.sendToNode(i,{type:"group-invite-response",groupId:t,accepted:r,from:this.nodeId});this.notifyListeners()}}handleInviteResponse(t){if(!t.accepted)return;const r=this.groups.get(t.groupId);r&&(r.members.includes(t.from)||(r.members.push(t.from),this.notifyListeners()))}proposeFact(t,r){const o=this.groups.get(t);if(!o)return null;const i=`proposal_${Date.now()}_${Math.random().toString(36).slice(2,8)}`,d={id:i,groupId:t,fact:r,from:this.nodeId,votes:new Map([[this.nodeId,!0]]),timestamp:Date.now()};this.proposals.set(i,d);const h=Ye(r);for(const v of o.members)v!==this.nodeId&&this.sendToNode(v,{type:"group-proposal",groupId:t,proposalId:i,fact:h,from:this.nodeId});return this.checkProposalConsensus(i),i}handleProposal(t){if(!this.groups.get(t.groupId))return;const o=Ve(t.fact),i={id:t.proposalId,groupId:t.groupId,fact:o,from:t.from,votes:new Map([[t.from,!0]]),timestamp:Date.now()};this.proposals.set(t.proposalId,i),this.notifyListeners()}vote(t,r){const o=this.proposals.get(t);if(!o)return;o.votes.set(this.nodeId,r);const i=this.groups.get(o.groupId);if(i)for(const d of i.members)d!==this.nodeId&&this.sendToNode(d,{type:"group-vote",groupId:o.groupId,proposalId:t,vote:r,from:this.nodeId});this.checkProposalConsensus(t)}handleVote(t){const r=this.proposals.get(t.proposalId);r&&(r.votes.set(t.from,t.vote),this.checkProposalConsensus(t.proposalId),this.notifyListeners())}checkProposalConsensus(t){const r=this.proposals.get(t);if(!r)return;const o=this.groups.get(r.groupId);if(!o)return;const i=o.members.length,d=Array.from(r.votes.values()),h=d.filter(A=>A).length,v=d.filter(A=>!A).length;let S=!1,M=!1;o.consensus==="unanimous"?(S=h===i,M=v>0):o.consensus==="majority"?(S=h>i/2,M=v>i/2):typeof o.consensus=="object"&&"threshold"in o.consensus&&(S=h>=o.consensus.threshold,M=v>i-o.consensus.threshold),S?(this.store.addStored(r.fact),this.proposals.delete(t),this.notifyListeners()):M&&(this.proposals.delete(t),this.notifyListeners())}handleSyncRequest(t){const r=this.groups.get(t.groupId);if(!r)return;const o=`${t.groupId}:root`,i=new Set(t.haveIds),d=this.store.findByScope(o).filter(h=>!i.has(h.id)).map(Ye);for(const h of r.members)this.sendToNode(h,{type:"group-sync-response",groupId:t.groupId,facts:d})}handleSyncResponse(t){for(const r of t.facts){const o=Ve(r);this.store.addStored(o)}this.notifyListeners()}getGroups(){return Array.from(this.groups.values())}getPendingInvites(){return Array.from(this.pendingInvites.values())}getProposals(t){const r=Array.from(this.proposals.values());return t?r.filter(o=>o.groupId===t):r}getGroup(t){return this.groups.get(t)}isInGroup(t){return this.groups.has(t)}getGroupRootScope(t){return`${t}:root`}onChange(t){return this.listeners.add(t),()=>this.listeners.delete(t)}notifyListeners(){for(const t of this.listeners)t()}}class Wn{constructor(t,r){this.identity=t,this.store=r,this.groups=new Zn(t.nodeId,r,(o,i)=>this.sendToNode(o,i)),r.onAdd(o=>{const i={type:"fact-add",fact:Ye(o)};this.broadcast(i)})}peers=new Map;listeners=new Set;groups;sendToNode(t,r){const o=this.peers.get(t);o&&o.getState()==="connected"&&o.send(r)}broadcast(t,r){for(const[o,i]of this.peers)o!==r&&i.getState()==="connected"&&i.send(t)}notifyListeners(){for(const t of this.listeners)t()}setupPeer(t){t.onStateChange(r=>{if(console.log("[Mesh] Peer state changed:",r,"remoteInfo:",t.remoteInfo?.nodeId),r==="connected"){console.log("[Mesh] Sending hello to peer"),t.send({type:"hello",nodeId:this.identity.nodeId,publicKey:this.identity.publicKeyBase64});const o=Array.from(this.store.allIds());console.log("[Mesh] Sending sync request with",o.length,"known facts"),t.send({type:"sync-request",haveIds:o}),this.notifyListeners()}r==="disconnected"&&t.remoteInfo&&(console.log("[Mesh] Peer disconnected:",t.remoteInfo.nodeId),this.peers.delete(t.remoteInfo.nodeId),this.notifyListeners())}),t.onMessage(r=>{console.log("[Mesh] Received message:",r.type),this.handleMessage(t,r)})}handleMessage(t,r){switch(r.type){case"hello":t.remoteInfo={nodeId:r.nodeId,publicKey:r.publicKey},this.peers.set(r.nodeId,t),this.notifyListeners();break;case"sync-request":{const o=new Set(r.haveIds),i=this.store.all().filter(d=>!o.has(d.id)).map(Ye);t.send({type:"sync-response",facts:i});break}case"sync-response":for(const o of r.facts){const i=Ve(o);this.store.addStored(i)}break;case"fact-add":{const o=Ve(r.fact);this.store.addStored(o)&&this.broadcast(r,t.remoteInfo?.nodeId);break}case"peer-announce":break;case"group-invite":this.groups.handleInvite(r),this.notifyListeners();break;case"group-invite-response":this.groups.handleInviteResponse(r),this.notifyListeners();break;case"group-proposal":this.groups.handleProposal(r),this.notifyListeners();break;case"group-vote":this.groups.handleVote(r),this.notifyListeners();break;case"group-sync-request":this.groups.handleSyncRequest(r);break;case"group-sync-response":this.groups.handleSyncResponse(r),this.notifyListeners();break;case"scope-query":this.handleScopeQuery(t,r.scopes);break;case"scope-response":this.handleScopeResponse(r.scopes);break;case"scope-hashes":this.handleScopeHashes(t,r.hashes);break}}handleScopeQuery(t,r){if(!t.remoteInfo)return;const o=t.remoteInfo.nodeId,i=[];for(const d of r){if(!this.store.isVisibleTo(d.scope,o))continue;const h=this.store.getScopeHash(d.scope);if(h!==d.knownHash){const v=this.store.findByScope(d.scope);i.push({scope:d.scope,hash:h,facts:v.map(Ye)})}}i.length>0&&t.send({type:"scope-response",scopes:i})}handleScopeResponse(t){for(const r of t)for(const o of r.facts){const i=Ve(o);this.store.addStored(i)}this.notifyListeners()}handleScopeHashes(t,r){if(!t.remoteInfo)return;const o=[],i=this.store.getScopeHashes();for(const[d,h]of Object.entries(r)){const v=i.get(d)??"";v!==h&&o.push({scope:d,knownHash:v})}o.length>0&&t.send({type:"scope-query",scopes:o})}queryPeer(t,r){const o=this.peers.get(t);if(!o||o.getState()!=="connected")return;const i=r.map(d=>({scope:d,knownHash:this.store.getScopeHash(d)}));o.send({type:"scope-query",scopes:i})}broadcastScopeHashes(){const t={};for(const[r,o]of this.store.getScopeHashes())t[r]=o;this.broadcast({type:"scope-hashes",hashes:t})}async createOffer(){console.log("[Mesh] Creating offer");const t=new sn(!0),r=[],o=new Promise(h=>{t.onIceCandidate(v=>{r.push(v)}),t.onIceGatheringComplete(()=>h())}),i=await t.createOffer();console.log("[Mesh] Waiting for ICE candidates..."),await o,console.log("[Mesh] Got",r.length,"ICE candidates");const d={type:"offer",nodeId:this.identity.nodeId,publicKey:this.identity.publicKeyBase64,sdp:i,candidates:r.map(h=>h.toJSON())};return this.peers.set("pending-offer",t),this.setupPeer(t),console.log("[Mesh] Offer created, waiting for answer"),btoa(JSON.stringify(d))}async acceptOffer(t){console.log("[Mesh] Accepting offer");const r=JSON.parse(atob(t));console.log("[Mesh] Offer from:",r.nodeId,"with",r.candidates.length,"candidates");const o=new sn(!1);o.remoteInfo={nodeId:r.nodeId,publicKey:r.publicKey};const i=[],d=new Promise(S=>{o.onIceCandidate(M=>{i.push(M)}),o.onIceGatheringComplete(()=>S())}),h=await o.acceptOffer(r.sdp);console.log("[Mesh] Adding",r.candidates.length,"remote ICE candidates");for(const S of r.candidates)await o.addIceCandidate(S);console.log("[Mesh] Waiting for local ICE candidates..."),await d,console.log("[Mesh] Got",i.length,"local ICE candidates"),this.peers.set(r.nodeId,o),this.setupPeer(o);const v={type:"answer",nodeId:this.identity.nodeId,publicKey:this.identity.publicKeyBase64,sdp:h,candidates:i.map(S=>S.toJSON())};return console.log("[Mesh] Answer created"),btoa(JSON.stringify(v))}async acceptAnswer(t){console.log("[Mesh] Accepting answer");const r=JSON.parse(atob(t));console.log("[Mesh] Answer from:",r.nodeId,"with",r.candidates.length,"candidates");const o=this.peers.get("pending-offer");if(!o)throw new Error("No pending offer to accept answer for");this.peers.delete("pending-offer"),o.remoteInfo={nodeId:r.nodeId,publicKey:r.publicKey},this.peers.set(r.nodeId,o),await o.acceptAnswer(r.sdp),console.log("[Mesh] Adding",r.candidates.length,"remote ICE candidates");for(const i of r.candidates)await o.addIceCandidate(i);console.log("[Mesh] Connection established")}getPeers(){const t=[];for(const r of this.peers.values())r.remoteInfo&&r.getState()==="connected"&&t.push(r.remoteInfo);return t}getPeerCount(){return this.getPeers().length}onChange(t){return this.listeners.add(t),()=>this.listeners.delete(t)}}class Re{constructor(t){this.name=t}static isVar(t){return t instanceof Re}}function Pt(f,t,r){if(Re.isVar(f)){const o=r.get(f.name);if(o!==void 0)return o===t?r:null;const i=new Map(r);return i.set(f.name,t),i}return f===t?r:null}function Qn(f,t,r,o){let i=r;return o!==void 0&&(i=Pt(o,t.scope,i),!i)||(i=Pt(f[0],t.fact[0],i),!i)?null:(i=Pt(f[1],t.fact[1],i),i)}function Xn(f,t,r){if(t.length===0)return[new Map];let o=[new Map];for(const i of t){const d=[];for(const h of o){let v;const[S,M]=i;r?.scope?v=f.findByScope(r.scope):!Re.isVar(S)&&typeof S=="string"?v=f.findByKey(S):v=f.all(),r?.scope&&!Re.isVar(S)&&(v=v.filter(A=>A.fact[0]===S));for(const A of v){const B=Qn(i,A,h,r?.scopePattern);B&&d.push(B)}}o=d}return o}function an(f){return new Re(f)}function er(f){const t={};for(const[r,o]of f)t[`?${r}`]=o;return t}async function fn(f){await navigator.clipboard.writeText(f)}function tr(f,t,r){f.innerHTML=`
    <div class="exchange">
      <h3>Connect to Peer</h3>
      <div class="exchange-tabs">
        <button class="tab active" data-tab="initiate">Create Invite</button>
        <button class="tab" data-tab="join">Join with Invite</button>
      </div>

      <div class="tab-content" id="initiate-tab">
        <p>1. Click "Generate" to create an invite code</p>
        <button id="generate-offer">Generate Invite</button>
        <textarea id="offer-output" readonly placeholder="Invite code will appear here..."></textarea>
        <button id="copy-offer" disabled>Copy to Clipboard</button>

        <p>2. Share the code with peer, then paste their response:</p>
        <textarea id="answer-input" placeholder="Paste peer's response here..."></textarea>
        <button id="accept-answer" disabled>Connect</button>
      </div>

      <div class="tab-content hidden" id="join-tab">
        <p>1. Paste the invite code from your peer:</p>
        <textarea id="offer-input" placeholder="Paste invite code here..."></textarea>
        <button id="accept-offer">Accept Invite</button>

        <p>2. Copy the response and send it back:</p>
        <textarea id="answer-output" readonly placeholder="Response will appear here..."></textarea>
        <button id="copy-answer" disabled>Copy to Clipboard</button>
      </div>
    </div>
  `;const o=f.querySelectorAll(".tab"),i=f.querySelector("#initiate-tab"),d=f.querySelector("#join-tab");o.forEach(R=>{R.addEventListener("click",()=>{o.forEach(ie=>ie.classList.remove("active")),R.classList.add("active");const W=R.dataset.tab;i.classList.toggle("hidden",W!=="initiate"),d.classList.toggle("hidden",W!=="join")})});const h=f.querySelector("#generate-offer"),v=f.querySelector("#offer-output"),S=f.querySelector("#copy-offer"),M=f.querySelector("#answer-input"),A=f.querySelector("#accept-answer");h.addEventListener("click",async()=>{h.disabled=!0,h.textContent="Generating...";try{const R=await t.createOffer();v.value=R,S.disabled=!1,A.disabled=!1}catch(R){v.value=`Error: ${R}`}h.disabled=!1,h.textContent="Generate Invite"}),S.addEventListener("click",async()=>{await fn(v.value),S.textContent="Copied!",setTimeout(()=>S.textContent="Copy to Clipboard",2e3)}),A.addEventListener("click",async()=>{const R=M.value.trim();if(R)try{await t.acceptAnswer(R)}catch(W){alert(`Failed to connect: ${W}`)}});const B=f.querySelector("#offer-input"),_=f.querySelector("#accept-offer"),I=f.querySelector("#answer-output"),D=f.querySelector("#copy-answer");_.addEventListener("click",async()=>{const R=B.value.trim();if(R){_.disabled=!0,_.textContent="Processing...";try{const W=await t.acceptOffer(R);I.value=W,D.disabled=!1}catch(W){I.value=`Error: ${W}`}_.disabled=!1,_.textContent="Accept Invite"}}),D.addEventListener("click",async()=>{await fn(I.value),D.textContent="Copied!",setTimeout(()=>D.textContent="Copy to Clipboard",2e3)})}function cn(f,t){const o=f.findByScope(t).find(i=>i.fact[0]==="name");return o?String(o.fact[1]):t.slice(0,8)}function nr(f,t){const o=f.findByScope(t).find(d=>d.fact[0]==="parents");if(!o)return[];const i=o.fact[1];return Array.isArray(i)?i:typeof i=="string"?[i]:[]}function rr(f,t){const r=f.findByScope(t),o=[],i=/^(\w+)\((.+)\)$/;for(const d of r){const h=d.fact[0];if(h.match(i)){const S=d.id;let M=h;const A=h.match(/symbol\("([^"]+)"\)/);A&&(M=A[1]),o.push({id:S,key:h,displayName:M})}}return o}function or(f,t){return{currentScope:t,path:[...f.path,t]}}function sr(f){if(f.path.length<=1)return null;const t=f.path.slice(0,-1);return{currentScope:t[t.length-1],path:t}}function ar(f,t){return t<0||t>=f.path.length?f:{currentScope:f.path[t],path:f.path.slice(0,t+1)}}function fr(f,t,r){if(t<=0||t>=f.path.length)return f;const o=[...f.path];return o[t-1]=r,{currentScope:f.currentScope,path:o}}function cr(f){return{currentScope:f,path:[f]}}function ir(f){return typeof f=="object"&&f!==null&&"type"in f&&f.type==="var"}function Sn(f){return typeof f=="object"&&f!==null&&"type"in f&&f.type==="constructor"}function lr(f){return typeof f=="object"&&f!==null&&"type"in f&&f.type==="scope"}function dr(f){return{type:"var",name:f}}function ln(f,...t){return{type:"constructor",name:f,args:t}}function ur(f){return{type:"scope",id:f}}function Cn(f){if(f===null)return"null";if(typeof f=="string")return`"${f}"`;if(typeof f=="number"||typeof f=="boolean")return String(f);if(ir(f))return`?${f.name}`;if(Sn(f)){if(f.args.length===0)return f.name;const t=f.args.map(Cn).join(", ");return`${f.name}(${t})`}return lr(f)?`@${f.id}`:String(f)}class Le extends Error{constructor(t,r){super(t),this.position=r,this.name="ParseError"}}function pr(f){const t=[];let r=0;for(;r<f.length;){if(/\s/.test(f[r])){r++;continue}if(f[r]==="?"){r++;let o="";for(;r<f.length&&/[\w]/.test(f[r]);)o+=f[r++];if(o.length===0)throw new Le("Expected variable name after ?",r);t.push({type:"variable",name:o});continue}if(f[r]==="@"){r++;let o="";for(;r<f.length&&/[\w\-]/.test(f[r]);)o+=f[r++];if(o.length===0)throw new Le("Expected scope id after @",r);t.push({type:"scope",id:o});continue}if(f[r]==='"'||f[r]==="'"){const o=f[r++];let i="";for(;r<f.length&&f[r]!==o;){if(f[r]==="\\"&&r+1<f.length)switch(r++,f[r]){case"n":i+=`
`;break;case"t":i+="	";break;case"\\":i+="\\";break;default:i+=f[r]}else i+=f[r];r++}if(r>=f.length)throw new Le("Unterminated string",r);r++,t.push({type:"string",value:i});continue}if(/[\d\-]/.test(f[r])){let o="";for(f[r]==="-"&&(o+=f[r++]);r<f.length&&/[\d\.]/.test(f[r]);)o+=f[r++];if(o==="-"||o===".")throw new Le("Invalid number",r);t.push({type:"number",value:parseFloat(o)});continue}if(f[r]==="("){t.push({type:"lparen"}),r++;continue}if(f[r]===")"){t.push({type:"rparen"}),r++;continue}if(f[r]===","){t.push({type:"comma"}),r++;continue}if(/[a-zA-Z_]/.test(f[r])){let o="";for(;r<f.length&&/[\w]/.test(f[r]);)o+=f[r++];o==="true"?t.push({type:"boolean",value:!0}):o==="false"?t.push({type:"boolean",value:!1}):o==="null"?t.push({type:"null"}):t.push({type:"identifier",value:o});continue}throw new Le(`Unexpected character: ${f[r]}`,r)}return t}function hr(f){const t=f.trim();if(t.length===0)return"";const r=pr(t);if(r.length===0)return"";let o=0;function i(){return r[o]}function d(){return r[o++]}function h(){const S=i();if(!S)throw new Le("Unexpected end of input",o);switch(S.type){case"number":return d(),S.value;case"string":return d(),S.value;case"boolean":return d(),S.value;case"null":return d(),null;case"variable":return d(),dr(S.name);case"scope":return d(),ur(S.id);case"identifier":{d();const M=S.value;if(i()?.type==="lparen"){d();const A=[];for(;i()&&i().type!=="rparen";)if(A.push(h()),i()?.type==="comma")d();else if(i()?.type!=="rparen")throw new Le("Expected , or )",o);if(i()?.type!=="rparen")throw new Le("Expected )",o);return d(),ln(M,...A)}return ln(M)}default:throw new Le(`Unexpected token: ${S.type}`,o)}}const v=h();if(o<r.length)throw new Le("Unexpected tokens after expression",o);return v}function xr(f){try{return hr(f)}catch{return null}}function yr(f){const r=f.trim().match(/^([a-zA-Z_]\w*)\s*\((.*)$/);if(!r)return null;const o=r[1],i=r[2];let d=0,h=0,v=!1,S="";for(const _ of i){if(v){_===S&&(v=!1);continue}if(_==='"'||_==="'"){v=!0,S=_;continue}_==="("?h++:_===")"?h--:_===","&&h===0&&d++}const M=i.lastIndexOf(","),B=(M===-1?i:i.slice(M+1)).trim().length>0||i.length===0;return{name:o,argCount:d,inArg:B}}const mr=[{name:"group",params:[{name:"name",type:"string"}],description:"Group with consensus-based shared state",allowedChildren:["member","rule","state","proposal"]},{name:"member",params:[{name:"pubkey",type:"string"}],description:"Group member by public key",allowedChildren:[]},{name:"rule",params:[],description:"Consensus rule (default: unanimous)",allowedChildren:["unanimous","majority","threshold"]},{name:"state",params:[],description:"Current group state (content-addressed)",allowedChildren:void 0}],gr=[{name:"proposal",params:[{name:"id",type:"string"}],description:"Proposal to change group state",allowedChildren:["from","base","change","vote"]},{name:"from",params:[{name:"pubkey",type:"string"}],description:"Proposal author",allowedChildren:[]},{name:"base",params:[{name:"hash",type:"string"}],description:"Base state hash (current state when proposed)",allowedChildren:[]},{name:"change",params:[],description:"The proposed change to state",allowedChildren:void 0},{name:"vote",params:[{name:"voter",type:"string"}],description:"Vote on proposal (by public key)",allowedChildren:["approve","sig"]},{name:"approve",params:[{name:"value",type:"boolean"}],description:"Approval vote",allowedChildren:[]},{name:"sig",params:[{name:"signature",type:"string"}],description:"Cryptographic signature",allowedChildren:[]}],br=[{name:"outbox",params:[],description:"Messages to send to this peer",allowedChildren:["proposal","vote","msg"]},{name:"inbox",params:[],description:"Messages received from this peer",allowedChildren:["proposal","vote","msg"]},{name:"msg",params:[{name:"id",type:"string"}],description:"Generic message",allowedChildren:void 0}],vr=[...mr,...gr,...br];function dn(f,t){const r=f.findByScope(t),o=[];for(const i of r)if(i.fact[0]==="constructor"){const d=i.fact[1];if(typeof d=="object"&&d!==null){const h=d;typeof h.name=="string"&&o.push({name:h.name,params:h.params||[],description:h.description})}else typeof d=="string"&&o.push({name:d,params:[]})}return o}function wr(f,t){const r=f.findByScope(t),o=new Set;for(const i of r)o.add(i.fact[0]);return Array.from(o)}function Sr(f,t){const r=f.findByScope(t),o=new Set,i=[];for(const d of r){const h=d.fact[1];if(h!==null){const v=JSON.stringify(h);o.has(v)||(o.add(v),(typeof h=="string"||typeof h=="number"||typeof h=="boolean")&&i.push(h))}}return i}function Cr(f,t){const o=f.findByScope(t).find(d=>d.fact[0]==="children");if(!o)return[];const i=o.fact[1];return Array.isArray(i)?i.map(d=>{const v=f.findByScope(d).find(M=>M.fact[0]==="name"),S=v?String(v.fact[1]):d.slice(0,8);return{id:d,name:S}}):[]}function Ar(f){return at.find(t=>t.name===f)}function Er(f){const t=f.match(/^(\w+)\(/);if(t)return t[1];if(at.find(o=>o.name===f&&o.params.length===0))return f}function Ir(f,t,r,o){const i=[],d=r.toLowerCase();let h;if(o){const A=Ar(o);A&&(h=A.allowedChildren)}const v=h!==void 0&&h.length===0,S=wr(f,t);for(const A of S)A.toLowerCase().includes(d)&&i.push({text:A,display:A,type:"key"});if(!v){const A=dn(f,t),B=[...at,...A],_=new Set;for(const I of B)if(!_.has(I.name)&&(_.add(I.name),!(h!==void 0&&!h.includes(I.name))&&I.name.toLowerCase().includes(d)))if(I.params.length===0)i.push({text:I.name,display:I.name,description:I.description,type:"constructor"});else{const D=I.params.map(R=>R.name).join(", ");i.push({text:`${I.name}(`,display:`${I.name}(${D})`,description:I.description,type:"constructor",completion:`${I.name}()`})}}const M=yr(r);if(M){const B=[...at,...dn(f,t)].find(_=>_.name===M.name);if(B&&M.argCount<B.params.length){const _=B.params[M.argCount];i.push({text:"",display:`${_.name}: ${_.type}`,description:`Argument ${M.argCount+1} of ${B.name}`,type:"constructor"})}}return i}function _r(f,t,r,o){const i=[],d=r.toLowerCase();if(o){const v=f.findByScope(t),S=new Set;for(const M of v)if(M.fact[0]===o){const A=M.fact[1],B=A===null?"null":typeof A=="string"?A:JSON.stringify(A);!S.has(B)&&B.toLowerCase().includes(d)&&(S.add(B),i.push({text:B,display:B,type:"value"}))}}const h=Sr(f,t);for(const v of h){const S=typeof v=="string"?v:String(v);S.toLowerCase().includes(d)&&(i.some(A=>A.display===S)||i.push({text:S,display:S,type:"value"}))}if(r.startsWith("@")||r===""){const v=Cr(f,t);for(const S of v){const M=`@${S.id}`;M.toLowerCase().includes(d)&&i.push({text:M,display:`@${S.name}`,description:`Scope: ${S.id.slice(0,8)}`,type:"scope"})}}return"true".includes(d)&&i.push({text:"true",display:"true",type:"value"}),"false".includes(d)&&i.push({text:"false",display:"false",type:"value"}),"null".includes(d)&&i.push({text:"null",display:"null",type:"value"}),i}const Nr=[{name:"name",params:[],description:"Name attribute",allowedChildren:["string"]},{name:"type",params:[],description:"Type attribute",allowedChildren:["symbol"]},{name:"value",params:[],description:"Value attribute"},{name:"symbol",params:[{name:"name",type:"string"}],description:"Create a symbol",allowedChildren:[]},{name:"eq",params:[{name:"expr",type:"any"}],description:"Equality/binding scope"},{name:"lt",params:[{name:"num",type:"number"}],description:"Less than",allowedChildren:[]},{name:"gt",params:[{name:"num",type:"number"}],description:"Greater than",allowedChildren:[]},{name:"ref",params:[{name:"target",type:"any"}],description:"Reference to scope",allowedChildren:[]},{name:"list",params:[{name:"items",type:"any"}],description:"List of items",allowedChildren:["item","next"]},{name:"peer",params:[{name:"id",type:"string"}],description:"Peer connection",allowedChildren:[]},{name:"group",params:[{name:"name",type:"string"}],description:"Group with synced scope",allowedChildren:["peer","consensus","root"]},{name:"consensus",params:[],description:"Consensus rule (default: unanimous)",allowedChildren:["unanimous","majority","threshold"]},{name:"unanimous",params:[],description:"Require all peers to agree",allowedChildren:[]},{name:"majority",params:[],description:"Require majority to agree",allowedChildren:[]},{name:"threshold",params:[{name:"n",type:"number"}],description:"Require n peers to agree",allowedChildren:[]},{name:"root",params:[],description:"Group root scope (synced data)",allowedChildren:void 0},{name:"string",params:[],description:"String value",allowedChildren:["data","next"],requiredChildren:["data"]},{name:"data",params:[{name:"char",type:"number"}],description:"Character code",allowedChildren:[]},{name:"next",params:[{name:"rest",type:"scope"}],description:"Rest of string/list",allowedChildren:[]},{name:"item",params:[{name:"value",type:"any"}],description:"List item",allowedChildren:[]}],at=[...Nr,...vr];function Kt(f){const t=document.createElement("div");t.className="autocomplete-container";const r=document.createElement("input");r.type="text",r.className="autocomplete-input",r.placeholder=f.placeholder,r.autocomplete="off";const o=document.createElement("div");o.className="autocomplete-dropdown hidden",t.appendChild(r),t.appendChild(o);let i=-1,d=[];function h(){const A=r.getBoundingClientRect();o.style.top=`${A.bottom+2}px`,o.style.left=`${A.left}px`,o.style.width=`${A.width}px`}function v(){const A=r.value;if(f.type==="key"?d=Ir(f.store,f.scope,A,f.parentConstructor):d=_r(f.store,f.scope,A,f.forKey),d=d.slice(0,10),d.length===0||d.length===1&&d[0].text===A){o.classList.add("hidden");return}o.innerHTML="",i=-1,h(),d.forEach((B,_)=>{const I=document.createElement("div");I.className="autocomplete-item",I.dataset.index=String(_);const D=document.createElement("span");if(D.className="autocomplete-item-text",D.textContent=B.display,I.appendChild(D),B.description){const W=document.createElement("span");W.className="autocomplete-item-desc",W.textContent=B.description,I.appendChild(W)}const R=document.createElement("span");R.className=`autocomplete-item-type type-${B.type}`,R.textContent=B.type,I.appendChild(R),I.onclick=()=>M(_),I.onmouseenter=()=>{i=_,S()},o.appendChild(I)}),o.classList.remove("hidden")}function S(){o.querySelectorAll(".autocomplete-item").forEach((B,_)=>{B.classList.toggle("selected",_===i)})}function M(A){if(A<0||A>=d.length)return;const B=d[A],_=B.completion||B.text;r.value=_,o.classList.add("hidden"),_.endsWith("(")&&(r.value=_+")",r.setSelectionRange(_.length,_.length)),f.onSelect?.(r.value),f.onChange?.(r.value)}return r.oninput=()=>{v(),f.onChange?.(r.value)},r.onfocus=()=>{v()},r.onblur=()=>{setTimeout(()=>{o.classList.add("hidden")},200)},r.onkeydown=A=>{if(o.classList.contains("hidden")){A.key==="ArrowDown"&&(v(),A.preventDefault());return}switch(A.key){case"ArrowDown":A.preventDefault(),i=Math.min(i+1,d.length-1),S();break;case"ArrowUp":A.preventDefault(),i=Math.max(i-1,-1),S();break;case"Enter":i>=0&&(A.preventDefault(),M(i));break;case"Escape":o.classList.add("hidden");break;case"Tab":i>=0?M(i):d.length>0&&M(0);break}},t.getValue=()=>r.value,t.setValue=A=>{r.value=A,f.onChange?.(A)},t.clear=()=>{r.value="",f.onChange?.("")},t.focus=()=>r.focus(),t.getInput=()=>r,t}function un(f){return f.getValue?.()||""}function pn(f){f.clear?.()}function $t(f){f.focus?.()}function hn(f){return f.getInput?.()||null}function Lr(f,t){if(t.path.length<2)return;const r=t.path[t.path.length-2],o=t.currentScope,i=f.findByScope(r);for(const d of i)if(d.id===o)return Er(d.fact[0])}function Tr(f,t){if(t.path.length<2)return{isPeer:!1};const r=t.path[t.path.length-2],o=t.currentScope,i=f.findByScope(r);for(const d of i)if(d.id===o){const v=d.fact[0].match(/^peer\("([^"]+)"\)$/);if(v)return{isPeer:!0,peerId:v[1]}}return{isPeer:!1}}function Mr(f,t){if(t.path.length<2)return{isGroup:!1};const r=t.path[t.path.length-2],o=t.currentScope,i=f.findByScope(r);for(const d of i)if(d.id===o){const v=d.fact[0].match(/^group\("([^"]+)"\)$/);if(v)return{isGroup:!0,groupId:o,groupName:v[1]}}return{isGroup:!1}}function Br(f){return typeof f=="string"?`"${f}"`:f===null?"null":String(f)}function Pr(f,t,r){const o=document.createElement("div");o.className="scope-navigator";const i=document.createElement("div");i.className="breadcrumbs",t.path.forEach((h,v)=>{const S=document.createElement("div");S.className="breadcrumb";const M=cn(f,h),A=nr(f,h),B=v===t.path.length-1;if(v>0&&A.length>1){const I=document.createElement("select");I.className="breadcrumb-dropdown";const D=t.path[v-1];A.forEach(R=>{const W=document.createElement("option");W.value=R,W.textContent=cn(f,R),W.selected=R===D,I.appendChild(W)}),I.onchange=()=>{const R=fr(t,v,I.value);r(R)},S.appendChild(I),S.appendChild(document.createTextNode(" / "))}else v>0&&S.appendChild(document.createTextNode(" / "));const _=document.createElement("span");_.className=`breadcrumb-name ${B?"current":"clickable"}`,_.textContent=M,B||(_.onclick=()=>{const I=ar(t,v);r(I)}),S.appendChild(_),i.appendChild(S)}),o.appendChild(i);const d=rr(f,t.currentScope);if(d.length>0){const h=document.createElement("div");h.className="navigable-facts";const v=document.createElement("span");v.className="navigable-facts-label",v.textContent="Enter: ",h.appendChild(v),d.forEach(S=>{const M=document.createElement("button");M.className="navigable-fact-btn",M.textContent=S.displayName,M.title=S.key,M.onclick=()=>{const A=or(t,S.id);r(A)},h.appendChild(M)}),o.appendChild(h)}if(t.path.length>1){const h=document.createElement("button");h.className="scope-up-btn",h.textContent=" Up",h.onclick=()=>{const v=sr(t);v&&r(v)},o.appendChild(h)}return o}function Ur(f,t,r,o){const i=document.createElement("div");i.className="group-management";const d=f.groups,h=d.getGroup(t);if(!d.isInGroup(t)){const D=d.getPendingInvites().find(R=>R.groupId===t);return D?(i.innerHTML=`
        <div class="group-invite">
          <p>You've been invited to group "${D.groupName}" by ${D.from.slice(0,8)}...</p>
          <p>Members: ${D.members.map(R=>R.slice(0,8)).join(", ")}</p>
          <div class="group-invite-actions">
            <button class="accept-invite">Accept</button>
            <button class="reject-invite">Reject</button>
          </div>
        </div>
      `,i.querySelector(".accept-invite").addEventListener("click",()=>{d.respondToInvite(t,!0)}),i.querySelector(".reject-invite").addEventListener("click",()=>{d.respondToInvite(t,!1)})):(i.innerHTML=`
        <div class="group-create">
          <p>Create group "${r}"</p>
          <button class="create-group-btn">Create Group</button>
        </div>
      `,i.querySelector(".create-group-btn").addEventListener("click",()=>{d.createGroup(t,r)})),i}const S=h.members,M=f.getPeers(),A=d.getProposals(t);i.innerHTML=`
    <div class="group-info">
      <h4>Group: ${r}</h4>
      <p class="group-members">Members: ${S.map(I=>I.slice(0,8)+(I===o?" (you)":"")).join(", ")}</p>
      <p class="group-consensus">Consensus: ${typeof h.consensus=="string"?h.consensus:`threshold(${h.consensus.threshold})`}</p>
    </div>
    <div class="group-invite-peers">
      <h5>Invite Peer</h5>
      <select class="peer-select">
        <option value="">Select a connected peer...</option>
        ${M.filter(I=>!S.includes(I.nodeId)).map(I=>`<option value="${I.nodeId}">${I.nodeId.slice(0,8)}...</option>`).join("")}
      </select>
      <button class="invite-peer-btn" disabled>Invite</button>
    </div>
    ${A.length>0?`
    <div class="group-proposals">
      <h5>Pending Proposals (${A.length})</h5>
      <div class="proposals-list"></div>
    </div>
    `:""}
  `;const B=i.querySelector(".peer-select"),_=i.querySelector(".invite-peer-btn");if(B.onchange=()=>{_.disabled=!B.value},_.onclick=()=>{B.value&&(d.invitePeer(t,B.value),B.value="",_.disabled=!0)},A.length>0){const I=i.querySelector(".proposals-list");for(const D of A){const R=D.votes.has(o),W=D.votes.get(o),ie=document.createElement("div");ie.className="proposal-item",ie.innerHTML=`
        <div class="proposal-fact">[${D.fact.fact[0]}, ${JSON.stringify(D.fact.fact[1])}]</div>
        <div class="proposal-from">From: ${D.from.slice(0,8)}...</div>
        <div class="proposal-votes">Votes: ${Array.from(D.votes.entries()).map(([fe,xe])=>`${fe.slice(0,8)}:${xe?"Y":"N"}`).join(", ")}</div>
        ${R?`<div class="voted">You voted: ${W?"Yes":"No"}</div>`:`
        <div class="proposal-actions">
          <button class="vote-yes">Approve</button>
          <button class="vote-no">Reject</button>
        </div>
        `}
      `,R||(ie.querySelector(".vote-yes").addEventListener("click",()=>{d.vote(D.id,!0)}),ie.querySelector(".vote-no").addEventListener("click",()=>{d.vote(D.id,!1)})),I.appendChild(ie)}}return i}function jt(f){const t=f.trim();return t==="true"?!0:t==="false"?!1:t==="null"?null:/^-?\d+(\.\d+)?$/.test(t)?parseFloat(t):t.startsWith('"')&&t.endsWith('"')||t.startsWith("'")&&t.endsWith("'")?t.slice(1,-1):t}function Or(f,t,r){const o=document.createElement("div"),i=f.findByScope(t);if(i.length===0)return o.innerHTML='<p class="empty-state">No facts in this scope. Add some below.</p>',o;const d=document.createElement("ul");d.className="fact-list";for(const h of i){const v=document.createElement("li");v.className="fact-item";const S=document.createElement("span");S.className="key",S.textContent=h.fact[0];const M=document.createTextNode(": "),A=document.createElement("span");A.className="value editable",A.textContent=Br(h.fact[1]),A.title="Click to edit",A.onclick=()=>{const B=document.createElement("input");B.type="text",B.className="fact-edit-input",B.value=typeof h.fact[1]=="string"?h.fact[1]:String(h.fact[1]);const _=()=>{const I=jt(B.value),D=h.fact;f.retract(D,t),f.add([D[0],I],r,t)};B.onblur=_,B.onkeydown=I=>{I.key==="Enter"?_():I.key==="Escape"&&f.add(h.fact,r,h.scope)},A.replaceWith(B),B.focus(),B.select()},v.appendChild(S),v.appendChild(M),v.appendChild(A),d.appendChild(v)}return o.appendChild(d),o}function Kr(f,t,r,o){const i=document.createElement("div");i.className="add-fact-form";let d="";const h=Kt({store:f,scope:t,type:"key",placeholder:"key (e.g., name, eq(x))",parentConstructor:o,onChange:_=>{d=_}}),v=Kt({store:f,scope:t,type:"value",placeholder:"value",forKey:d}),S=document.createElement("button");S.id="add-fact-btn",S.textContent="Add";const M=()=>{const _=un(h).trim(),I=un(v).trim();if(!_)return;const D=xr(_),R=D!==null&&Sn(D)?Cn(D):_;let W=I;I==="true"?W=!0:I==="false"?W=!1:I==="null"?W=null:/^-?\d+(\.\d+)?$/.test(I)&&(W=parseFloat(I)),f.add([R,W],r,t),pn(h),pn(v),$t(h)};S.onclick=M;const A=hn(v);if(A){const _=A.onkeydown;A.onkeydown=I=>{I.key==="Enter"&&!I.defaultPrevented&&v.querySelector(".autocomplete-dropdown")?.classList.contains("hidden")&&(M(),I.preventDefault()),_?.call(A,I)}}const B=hn(h);if(B){const _=B.onkeydown;B.onkeydown=I=>{I.key==="Tab"&&!I.shiftKey&&h.querySelector(".autocomplete-dropdown")?.classList.contains("hidden")&&(I.preventDefault(),$t(v)),_?.call(B,I)}}return i.appendChild(h),i.appendChild(v),i.appendChild(S),i}function $r(f,t){const r=document.createElement("div");r.className="query-builder";const o=document.createElement("h4");o.textContent="Query",r.appendChild(o);const i=document.createElement("div");i.className="query-pattern";const d={key:{type:"any",value:""},value:{type:"any",value:""}},h=document.createElement("div");h.className="query-results empty",h.textContent="Enter a pattern to query";const v=document.createElement("div");v.className="query-preview";const S=document.createElement("code");S.className="pattern-text",v.appendChild(S);function M(){const _=d.key.type==="any"?"?key":d.key.value||"?key",I=d.value.type==="any"?"?val":d.value.value||"?val";S.textContent=`[${_}, ${I}]`}function A(){try{const _=d.key.type==="any"?an("key"):jt(d.key.value),I=d.value.type==="any"?an("val"):jt(d.value.value),R=Xn(f,[[_,I]],{scope:t});R.length===0?(h.className="query-results empty",h.textContent="No matches"):(h.className="query-results",h.innerHTML=R.map(W=>`<div class="result-row">${JSON.stringify(er(W))}</div>`).join(""))}catch(_){h.className="query-results empty",h.textContent=`Error: ${_}`}}function B(_,I,D){const R=document.createElement("div");R.className="pattern-slot";const W=document.createElement("label");W.textContent=I,R.appendChild(W);const ie=document.createElement("div");ie.className="slot-options";const fe=document.createElement("button");fe.className="slot-btn active",fe.textContent=`Any (?${_[0]})`,fe.dataset.type="any";const xe=document.createElement("button");xe.className="slot-btn",xe.textContent="Specific",xe.dataset.type="specific",ie.appendChild(fe),ie.appendChild(xe),R.appendChild(ie);const ve=Kt({store:f,scope:t,type:D,placeholder:_,onChange:be=>{d[_].value=be,M(),A()}});return ve.classList.add("hidden"),R.appendChild(ve),[fe,xe].forEach(be=>{be.onclick=()=>{fe.classList.toggle("active",be===fe),xe.classList.toggle("active",be===xe),d[_].type=be.dataset.type,be.dataset.type==="specific"?(ve.classList.remove("hidden"),$t(ve)):ve.classList.add("hidden"),M(),A()}}),R}return i.appendChild(B("key","Key","key")),i.appendChild(B("value","Value","value")),r.appendChild(i),r.appendChild(v),r.appendChild(h),M(),A(),r}function jr(f,t,r){const o=t.findByScope(f).find(i=>i.fact[0]==="name");return o?String(o.fact[1]):r}function Rr(f,t,r){const o=document.createElement("div");o.className="actor-switcher";const i=t.getActors();o.innerHTML=`
    <div class="actor-switcher-row">
      <select class="actor-select">
        ${i.map(fe=>`<option value="${fe.id}" ${fe.id===f?"selected":""}>${jr(fe.id,r,fe.name)}</option>`).join("")}
      </select>
      <button class="actor-btn" title="New Actor">+</button>
      <button class="actor-btn" title="Import Actor">Import</button>
      <button class="actor-btn" title="Export Actor">Export</button>
      <button class="actor-btn actor-btn-danger" title="Delete Actor">Delete</button>
    </div>
    <div class="actor-import-row hidden">
      <input type="text" class="actor-import-input" placeholder="Paste actor data..." />
      <button class="actor-import-btn">Import</button>
      <button class="actor-import-cancel">Cancel</button>
    </div>
    <div class="actor-export-row hidden">
      <textarea class="actor-export-output" readonly></textarea>
      <button class="actor-export-copy">Copy</button>
      <button class="actor-export-close">Close</button>
    </div>
  `;const d=o.querySelector(".actor-select"),h=o.querySelectorAll(".actor-btn")[0],v=o.querySelectorAll(".actor-btn")[1],S=o.querySelectorAll(".actor-btn")[2],M=o.querySelectorAll(".actor-btn")[3],A=o.querySelector(".actor-import-row"),B=o.querySelector(".actor-import-input"),_=o.querySelector(".actor-import-btn"),I=o.querySelector(".actor-import-cancel"),D=o.querySelector(".actor-export-row"),R=o.querySelector(".actor-export-output"),W=o.querySelector(".actor-export-copy"),ie=o.querySelector(".actor-export-close");return d.onchange=()=>{t.onSwitchActor(d.value)},h.onclick=()=>{const fe=prompt("Enter a name for the new actor:",`Actor ${new Date().toLocaleString()}`);fe!==null&&t.onCreateActor(fe||void 0)},v.onclick=()=>{A.classList.remove("hidden"),B.focus()},I.onclick=()=>{A.classList.add("hidden"),B.value=""},_.onclick=()=>{const fe=B.value.trim();if(!fe)return;t.onImportActor(fe)?(A.classList.add("hidden"),B.value=""):alert("Invalid actor data")},S.onclick=()=>{const fe=t.onExportActor(f);fe&&(R.value=fe,D.classList.remove("hidden"))},W.onclick=async()=>{await navigator.clipboard.writeText(R.value),W.textContent="Copied!",setTimeout(()=>W.textContent="Copy",2e3)},ie.onclick=()=>{D.classList.add("hidden"),R.value=""},M.onclick=()=>{if(i.length<=1){alert("Cannot delete the last actor");return}confirm("Are you sure you want to delete this actor?")&&t.onDeleteActor(f)},o}function it(f,t,r){const{identity:o,store:i,mesh:d}=t;let h=t.navigation||cr(o.nodeId);function v(M){h=M,S()}function S(){const M=d.getPeerCount(),A=h.currentScope,B=i.findByScope(A);f.innerHTML="";const _=document.createElement("div");_.className="header";const I=document.createElement("div");I.className="header-info",I.innerHTML=`
      <div class="node-id">Node: ${o.nodeId}</div>
      <div class="peer-count ${M>0?"connected":""}">
        ${M} peer${M!==1?"s":""} connected
      </div>
    `,_.appendChild(I),_.appendChild(Rr(o.nodeId,r,i)),f.appendChild(_);const D=document.createElement("div");D.className="section",D.innerHTML=`
      <div class="section-header">
        <h2>Scope</h2>
      </div>
    `;const R=document.createElement("div");R.className="section-content",R.appendChild(Pr(i,h,v)),D.appendChild(R),f.appendChild(D);const W=Lr(i,h),ie=document.createElement("div");ie.className="section",ie.innerHTML=`
      <div class="section-header">
        <h2>Facts</h2>
        <span>${B.length} in scope${W?` (${W} context)`:""}</span>
      </div>
    `;const fe=document.createElement("div");fe.className="section-content",fe.appendChild(Or(i,A,o.nodeId)),fe.appendChild(Kr(i,A,o.nodeId,W)),ie.appendChild(fe),f.appendChild(ie);const xe=document.createElement("div");xe.className="section",xe.innerHTML=`
      <div class="section-header">
        <h2>Query</h2>
      </div>
    `;const ve=document.createElement("div");ve.className="section-content",ve.appendChild($r(i,A)),xe.appendChild(ve),f.appendChild(xe);const be=Tr(i,h);if(be.isPeer){const Ae=document.createElement("div");Ae.className="section",Ae.innerHTML=`
        <div class="section-header">
          <h2>Peer Connection</h2>
          <span>peer(${be.peerId?.slice(0,8)}...)</span>
        </div>
      `;const Ne=document.createElement("div");Ne.className="section-content",tr(Ne,d),Ae.appendChild(Ne),f.appendChild(Ae)}const we=Mr(i,h);if(we.isGroup&&we.groupId&&we.groupName){const Ae=document.createElement("div");Ae.className="section",Ae.innerHTML=`
        <div class="section-header">
          <h2>Group</h2>
          <span>group("${we.groupName}")</span>
        </div>
      `;const Ne=document.createElement("div");Ne.className="section-content",Ne.appendChild(Ur(d,we.groupId,we.groupName,o.nodeId)),Ae.appendChild(Ne),f.appendChild(Ae)}}S(),i.onAdd(()=>S()),d.onChange(()=>S()),d.groups.onChange(()=>S())}let Ce=null;function lt(f){const t=new Gn,r=new Wn(f,t);return{identity:f,store:t,mesh:r}}function Je(f){const t=kn(f);if(!t)return!1;Ce=lt(t),yt(t,Ce.store),console.log("Switched to Node ID:",t.nodeId);const r=document.getElementById("app");return r&&it(r,Ce,{onSwitchActor:Je,onCreateActor:dt,onImportActor:ut,onExportActor:pt,onDeleteActor:ht,onRenameActor:xt,getActors:Ue,getCurrentActorId:ct}),!0}function dt(f){const t=wn(f);Ce=lt(t),yt(t,Ce.store);const r=document.getElementById("app");return r&&it(r,Ce,{onSwitchActor:Je,onCreateActor:dt,onImportActor:ut,onExportActor:pt,onDeleteActor:ht,onRenameActor:xt,getActors:Ue,getCurrentActorId:ct}),t}function ut(f){const t=Yn(f);if(!t)return null;Ce=lt(t),yt(t,Ce.store);const r=document.getElementById("app");return r&&it(r,Ce,{onSwitchActor:Je,onCreateActor:dt,onImportActor:ut,onExportActor:pt,onDeleteActor:ht,onRenameActor:xt,getActors:Ue,getCurrentActorId:ct}),t}function pt(f){return Vn(f)}function ht(f){if(Ue().length<=1)return alert("Cannot delete the last actor"),!1;if(Rn(f),Ce?.identity.nodeId===f){const r=Ue();r.length>0&&Je(r[0].id)}return!0}function xt(f,t){qn(f,t)}function yt(f,t){if(!t.findByScope(f.nodeId).find(o=>o.fact[0]==="name")){const i=Ue().find(d=>d.id===f.nodeId)?.name||f.nodeId;t.add(["name",i],f.nodeId,f.nodeId)}}function qr(){const f=Hn();console.log("Node ID:",f.nodeId),Ce=lt(f),yt(f,Ce.store),it(document.getElementById("app"),Ce,{onSwitchActor:Je,onCreateActor:dt,onImportActor:ut,onExportActor:pt,onDeleteActor:ht,onRenameActor:xt,getActors:Ue,getCurrentActorId:ct})}qr();
